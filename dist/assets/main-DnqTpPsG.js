(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&i(o)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function i(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();class Hn{constructor(){this.easing="cubic-bezier(0.4, 0.0, 0.2, 1)",this.durations={micro:200,macro:400,cinematic:600},this.patterns={"MI-01":{name:"Button: Hover",duration:200,properties:["transform","box-shadow"],reducedMotion:{properties:["background-color"]}},"MI-02":{name:"Button: Focus",duration:200,properties:["box-shadow"],reducedMotion:{properties:[]}},"MI-03":{name:"Tooltip: Reveal",duration:200,properties:["opacity","transform"],reducedMotion:{properties:["opacity"]}},"MI-04":{name:"Data Point: Hover",duration:200,properties:["transform","stroke-width"],reducedMotion:{properties:["fill"]}},"MI-05":{name:"Chart: Data Update",duration:400,properties:["transform","opacity"],reducedMotion:{properties:["opacity"]}},"MI-06":{name:"Chart: Staggered Entrance",duration:400,properties:["opacity","transform"],reducedMotion:{properties:["opacity"]}},"MI-07":{name:"Panel: Reveal",duration:400,properties:["opacity","transform"],reducedMotion:{properties:["opacity"]}},"MI-08":{name:"Stopwatch: Needle Tick",duration:200,easing:"linear",properties:["transform"],reducedMotion:{properties:[]}},"MI-09":{name:"Planet: Orbit",duration:null,easing:"linear",properties:["transform"],reducedMotion:{properties:[]}},"MI-10":{name:"Section: Cinematic Handoff",duration:600,properties:["opacity","transform"],reducedMotion:{properties:["opacity"]}},"MI-11":{name:"Link: Hover",duration:200,properties:["color","text-shadow"],reducedMotion:{properties:["color"]}},"MI-12":{name:"Filter: State Change",duration:200,properties:["background-color","border-color"],reducedMotion:{properties:[]}}}}getPattern(t){return this.patterns[t]||null}getDuration(t){return this.durations[t]||this.durations.macro}applyPattern(t,n,i={}){const r=this.getPattern(n);if(!r)return;const o=this.prefersReducedMotion()?r.reducedMotion.properties:r.properties,a=r.duration||this.getDuration("macro"),c=r.easing||this.easing;t.style.transition=o.map(l=>`${l} ${a}ms ${c}`).join(", "),i.styles&&Object.assign(t.style,i.styles),a&&setTimeout(()=>{t.style.transition=""},a)}animateStagger(t,n,i=50){this.getPattern(n)&&t.forEach((s,o)=>{setTimeout(()=>{this.applyPattern(s,n)},o*i)})}prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}applyTransition(t,n,i){const s=this.getPattern("MI-10").duration||this.getDuration("cinematic");if(this.prefersReducedMotion()){t&&(t.style.opacity="0"),n&&(n.style.opacity="1"),i&&i();return}t&&(t.style.transition=`opacity ${s}ms ${this.easing}, transform ${s}ms ${this.easing}`,t.style.opacity="0",t.style.transform="translateY(-20px)"),n&&(n.style.transition=`opacity ${s}ms ${this.easing}, transform ${s}ms ${this.easing}`,n.style.opacity="1",n.style.transform="translateY(0)"),i&&setTimeout(i,s)}}class pt{constructor(){this.events=new Map}on(t,n){this.events.has(t)||this.events.set(t,new Set),this.events.get(t).add(n)}off(t,n){this.events.has(t)&&this.events.get(t).delete(n)}emit(t,n={}){this.events.has(t)&&this.events.get(t).forEach(i=>{i({type:t,data:n})})}}function rn(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}const N={DATA_READY:"dataReady",ENTER_COMPLETE:"enterComplete",UPDATE_COMPLETE:"updateComplete",EXIT_COMPLETE:"exitComplete",ERROR:"error",RESIZE:"resize",STATE_CHANGE:"stateChange"},mt={width:800,height:600,colorScheme:"default",animationSpeed:1,reducedMotion:!1,language:"en",debugMode:!1};class On extends pt{constructor(){super(),this.container=null,this.data=null,this.rawData=null,this.state={currentStep:0,filters:{},highlights:[],animationPaused:!1,interactionMode:"explore"},this.options={...mt,reducedMotion:rn()},this.mounted=!1,this.svg=null,this.g=null,this.paths=null,this.buttonRect=null,this.crownRect=null,this.angleScale=null,this.rScale=null,this._geom={width:0,height:0,ringOuter:0,ringInner:0,btnY:0,crownY:0,R:0,margin:42},this.tooltip=null}async init(t,n={}){if(this.container=typeof t=="string"?document.querySelector(t):t,!this.container)throw new Error(`Container not found: ${t}`);this.options={...this.options,...n},await this.loadData(),this.emit(N.DATA_READY)}async loadData(){try{const[t]=await Promise.all([d3.csv("/data/cleaned_tiktok_data.csv",d3.autoType)]);this.rawData=t;const n=t.filter(r=>Number.isFinite(r==null?void 0:r["videoMeta/duration"])&&Number.isFinite(r==null?void 0:r.playCount)&&+r["videoMeta/duration"]<=60);let i=d3.rollups(n,r=>d3.mean(r,s=>+s.playCount),r=>+r["videoMeta/duration"]).filter(r=>Number.isFinite(r[0])&&Number.isFinite(r[1]));i.sort((r,s)=>d3.ascending(r[0],s[0])),this.data=i}catch(t){throw console.error("Error loading CSV data:",t),t}}mount(){this.mounted||(this.render(),this.mounted=!0,this.emit(N.ENTER_COMPLETE))}unmount(){this.mounted&&(this.container&&(this.container.innerHTML=""),this.tooltip&&(this.tooltip.remove(),this.tooltip=null),this.svg=null,this.g=null,this.paths=null,this.buttonRect=null,this.crownRect=null,this.mounted=!1,this.emit(N.EXIT_COMPLETE))}destroy(){this.unmount(),this.data=null,this.rawData=null,this.state=null,this.events.clear()}update(t,n={}){switch(this.state.currentStep=t,t){case 1:this.highlightDurationRange(15,30);break;case 2:this.showVelocityMetrics();break;default:this.highlightDurationRange(-1/0,1/0);break}this.emit(N.UPDATE_COMPLETE)}resize(t,n){this.options.width=t,this.options.height=n,this.mounted&&this.render(),this.emit(N.RESIZE)}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},this.emit(N.STATE_CHANGE)}isDataReady(){return Array.isArray(this.data)&&this.data.length>0}render(){if(!this.isDataReady())return;this.container.innerHTML="";const t=this.container.getBoundingClientRect(),n=Math.min(t.width||800,t.height||800)||800,i=n,r=n,s=this._geom.margin;this.svg=d3.select(this.container).append("svg").attr("viewBox",`0 0 ${i} ${r}`).attr("role","img").attr("aria-label","Stopwatch visualization showing video duration impact on engagement"),this.g=this.svg.append("g").attr("transform",`translate(${i/2}, ${r/2})`);const o=Math.min(i,r)/2-s,a=o,c=o*.9,l=o*.78,u=Math.max(12,o*.12);Object.assign(this._geom,{width:i,height:r,R:o,ringOuter:a,ringInner:c}),this.g.append("circle").attr("r",a).attr("class","stopwatch-ring"),this.g.append("circle").attr("r",c).attr("class","stopwatch-inner");const d=o*.25,h=o*.1,p=8,m=-a-h-10;this._geom.btnY=m,this.buttonRect=this.g.append("rect").attr("x",-d/2).attr("y",m).attr("width",d).attr("height",h).attr("rx",p).attr("class","stopwatch-button clickable").attr("tabindex",0).attr("role","button").attr("aria-label","Replay animation"),this.buttonRect.append("title").text("Replay animation");const g=o*.08,b=o*.12,f=5,y=-a-b/2+2;this._geom.crownY=y,this.crownRect=this.g.append("rect").attr("x",-g/2).attr("y",y).attr("width",g).attr("height",b).attr("rx",f).attr("class","stopwatch-button");const v=this.g.append("g").attr("aria-hidden",!0);for(let x=0;x<60;x++){const C=x/60*2*Math.PI-Math.PI/2,q=x%5===0,R=c-(q?10:6),E=c-2;v.append("line").attr("x1",R*Math.cos(C)).attr("y1",R*Math.sin(C)).attr("x2",E*Math.cos(C)).attr("y2",E*Math.sin(C)).attr("class",q?"tick-major":"tick-minor")}this.tooltip=d3.select("body").append("div").attr("class","tooltip").style("opacity",0),this.angleScale=d3.scaleLinear().domain([0,60]).range([0,2*Math.PI]);const M=d3.extent(this.data,x=>x[1])||[0,1];this.rScale=d3.scaleSqrt().domain(M).range([u,l]).nice();const w=d3.scaleOrdinal().domain(this.data.map(x=>x[0])).range(d3.schemeTableau10.concat(d3.schemeSet2).slice(0,this.data.length)),A=this.g.append("g").attr("aria-label","sectors");this.paths=A.selectAll("path.sector").data(this.data).join("path").attr("class","sector").attr("fill",x=>w(x[0])).style("opacity",.55),this.paths.on("pointerenter",(x,C)=>{const[q,R]=C;this.tooltip.style("opacity",1).html(`<strong>Duration:</strong> ${q}s<br><strong>Avg playCount:</strong> ${d3.format(",.2f")(R)}`).style("left",`${x.pageX}px`).style("top",`${x.pageY-18}px`),d3.select(x.currentTarget).transition().duration(120).style("opacity",.85)}).on("pointermove",x=>{this.tooltip.style("left",`${x.pageX}px`).style("top",`${x.pageY-18}px`)}).on("pointerleave",x=>{this.tooltip.style("opacity",0),d3.select(x.currentTarget).transition().duration(120).style("opacity",.55)}).append("title").text(x=>`Duration: ${x[0]}s
Avg playCount: ${d3.format(",.2f")(x[1])}`),this.g.append("circle").attr("r",4.5).attr("class","center-dot"),[15,30,45].forEach(x=>{const C=this.angleScale(x)-Math.PI/2,q=a-14;this.g.append("text").attr("class","time-label").attr("x",q*Math.cos(C)).attr("y",q*Math.sin(C)).text(`${x}s`)}),this.buttonRect.on("click",()=>{this._pressAnimation(),this.runAnimation(!0)}).on("keydown",x=>{(x.key==="Enter"||x.key===" ")&&(this._pressAnimation(),this.runAnimation(!0))}),this.options.reducedMotion||this.runAnimation(!1)}runAnimation(t=!1){if(!this.paths||this.options.reducedMotion)return;const n=300,i=40,r=s=>d3.arc().innerRadius(0).outerRadius(s).cornerRadius(6).startAngle(0);this.paths.interrupt(),this.paths.attr("d",s=>r(this.rScale(s[1])).endAngle(0)(s)),this.paths.transition().delay((s,o)=>o*(n+i)).duration(n).ease(d3.easeCubicOut).attrTween("d",s=>{const o=this.rScale(s[1]),a=this.angleScale(s[0]),c=d3.interpolateNumber(0,a),l=r(o);return u=>l.endAngle(c(u))(s)}),t&&this.emit(N.INTERACTION)}_pressAnimation(){if(!this.buttonRect||!this.crownRect)return;const{btnY:t,crownY:n}=this._geom,i=10,r=5;this.buttonRect.interrupt().transition().duration(80).attr("y",t+i).transition().duration(280).ease(d3.easeElastic.period(.3)).attr("y",t),this.crownRect.interrupt().transition().duration(80).attr("y",n+r).transition().duration(280).ease(d3.easeElastic.period(.3)).attr("y",n)}highlightDurationRange(t,n){this.paths&&this.paths.interrupt().transition().duration(180).style("opacity",i=>{const r=i[0];return r>=t&&r<=n?.9:.25}).attr("stroke",i=>{const r=i[0];return r>=t&&r<=n?"var(--color-accent-cyan)":"none"}).attr("stroke-width",i=>{const r=i[0];return r>=t&&r<=n?2:0})}showVelocityMetrics(){console.log("Velocity metrics overlay (placeholder)")}playGlowSweep(){if(!this.g||this.options.reducedMotion)return;const t=this.g.append("line").attr("x1",0).attr("y1",0).attr("x2",0).attr("y2",-this._geom.R*.8).attr("stroke","var(--color-accent-cyan)").attr("stroke-width",3).attr("opacity",.8);t.transition().duration(2e3).ease(d3.easeLinear).attrTween("transform",()=>n=>`rotate(${n*360})`).on("end",()=>t.remove())}}class Gn extends pt{constructor(){super(),this.container=null,this.data=null,this.currentYear="2019",this.state={currentStep:0,filters:{},highlights:[],animationPaused:!1,interactionMode:"explore"},this.options={...mt},this.mounted=!1,this.svg=null,this.tooltip=null,this.animationRunning=!0,this.startTime=Date.now()}async init(t,n={}){if(this.container=typeof t=="string"?document.querySelector(t):t,!this.container)throw new Error(`Container not found: ${t}`);this.options={...this.options,...n},await this.loadData(),this.emit(N.DATA_READY)}async loadData(){try{const[t,n,i,r]=await Promise.all([d3.csv("/data/TikTok_songs_2019.csv"),d3.csv("/data/TikTok_songs_2020.csv"),d3.csv("/data/TikTok_songs_2021.csv"),d3.csv("/data/TikTok_songs_2022.csv")]);this.data={2019:this.processData(t),2020:this.processData(n),2021:this.processData(i),2022:this.processData(r)}}catch(t){throw console.error("Error loading CSV data:",t),t}}processData(t){const n=new Map;return t.forEach(i=>{const r=i.artist_name,s=parseFloat(i.danceability),o=parseFloat(i.energy);n.has(r)||n.set(r,{name:r,songs:[],danceabilities:[],energies:[]});const a=n.get(r);a.songs.push(i.track_name),a.danceabilities.push(s),a.energies.push(o)}),Array.from(n.values()).map(i=>({name:i.name,songCount:i.songs.length,avgDanceability:d3.mean(i.danceabilities),avgEnergy:d3.mean(i.energies),songs:i.songs}))}danceabilityToColor(t){const n=[{value:0,color:"#FF0000"},{value:.15,color:"#FF7F00"},{value:.3,color:"#FFFF00"},{value:.45,color:"#00FF00"},{value:.6,color:"#00FFFF"},{value:.75,color:"#0000FF"},{value:.9,color:"#8B00FF"},{value:1,color:"#FF00FF"}];for(let i=0;i<n.length-1;i++)if(t>=n[i].value&&t<=n[i+1].value){const r=(t-n[i].value)/(n[i+1].value-n[i].value);return d3.interpolateRgb(n[i].color,n[i+1].color)(r)}return n[n.length-1].color}mount(){this.mounted||(this.createSolarSystem(),this.updateVisualization(),this.setupYearButtons(),this.mounted=!0,this.emit(N.ENTER_COMPLETE))}unmount(){this.mounted&&(this.animationRunning=!1,this.container.innerHTML="",this.mounted=!1,this.emit(N.EXIT_COMPLETE))}destroy(){this.unmount(),this.data=null,this.state=null,this.events.clear()}update(t,n={}){switch(this.state.currentStep=t,t){case 3:this.highlightTopArtists();break;case 4:this.switchYear("2022");break}this.emit(N.UPDATE_COMPLETE)}resize(t,n){this.options.width=t,this.options.height=n,this.mounted&&this.render(),this.emit(N.RESIZE)}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},t.reducedMotion!==void 0&&(this.animationRunning=!t.reducedMotion),this.emit(N.STATE_CHANGE)}isDataReady(){return this.data!==null}createSolarSystem(){this.container.innerHTML="";const t=this.container.getBoundingClientRect(),n=t.width||1200,i=t.height||800;this.svg=d3.select(this.container).append("svg").attr("width","100%").attr("height","100%").attr("viewBox",`0 0 ${n} ${i}`).attr("preserveAspectRatio","xMidYMid meet").attr("role","img").attr("aria-label","Planet system visualization showing artists as gravitational centers"),this.svg.append("g").attr("id","orbits"),this.svg.append("g").attr("id","planets");const s=this.svg.append("defs").append("radialGradient").attr("id","sunGradient");s.append("stop").attr("offset","0%").attr("stop-color","#FFD700"),s.append("stop").attr("offset","50%").attr("stop-color","#FFA500"),s.append("stop").attr("offset","100%").attr("stop-color","#FF8C00"),this.svg.append("circle").attr("class","sun").attr("cx",n/2).attr("cy",i/2).attr("r",40).attr("fill","url(#sunGradient)"),this.tooltip=d3.select("body").append("div").attr("class","tooltip-planet").style("opacity",0).style("display","none").style("position","absolute").style("background","rgba(0, 0, 0, 0.9)").style("color","#fff").style("padding","10px").style("border-radius","8px").style("border","1px solid var(--color-accent-cyan)").style("pointer-events","none").style("z-index","1000").style("font-size","0.9rem")}updateVisualization(){const t=this.data[this.currentYear];if(!t)return;const n=this.container.getBoundingClientRect(),i=n.width||1200,r=n.height||800,s=i/2,o=r/2,a=80,c=350,l=d3.scaleSqrt().domain([1,d3.max(t,f=>f.songCount)]).range([8,40]),u=d3.scaleLinear().domain([0,1]).range([a,c]),d=2*Math.PI/t.length,h=t.map((f,y)=>{const v=y*d,M=u(f.avgEnergy),w=5e-5/(M/100);return{...f,baseAngle:v,distance:M,orbitalSpeed:w,x:s+M*Math.cos(v),y:o+M*Math.sin(v)}}),p=this.svg.select("#orbits").selectAll(".planet-orbit").data(h,f=>f.name);p.enter().append("circle").attr("class","planet-orbit").attr("cx",s).attr("cy",o).attr("r",0).attr("fill","none").attr("stroke","var(--color-border-primary)").attr("stroke-width",1).attr("opacity",.3).merge(p).transition().duration(1e3).attr("r",f=>f.distance),p.exit().transition().duration(500).attr("r",0).remove();const m=this.svg.select("#planets").selectAll(".planet").data(h,f=>f.name),g=this.tooltip;m.enter().append("circle").attr("class","planet").attr("cx",s).attr("cy",o).attr("r",0).attr("fill",f=>this.danceabilityToColor(f.avgDanceability)).attr("stroke","#fff").attr("stroke-width",2).on("mouseenter",function(f,y){d3.select(this).attr("data-original-r",l(y.songCount)),d3.select(this).transition().duration(200).attr("stroke-width",4).attr("r",l(y.songCount)*1.2),g.style("display","block").transition().duration(200).style("opacity",1)}).on("mousemove",function(f,y){g.html(`
            <strong>${y.name}</strong>
            <div>Songs: ${y.songCount}</div>
            <div>Avg Danceability: ${y.avgDanceability.toFixed(2)}</div>
            <div>Avg Energy: ${y.avgEnergy.toFixed(2)}</div>
            <div style="margin-top: 5px; font-size: 0.8rem; color: #aaa;">
              ${y.songs.slice(0,3).join(", ")}${y.songs.length>3?"...":""}
            </div>
          `).style("left",f.pageX+15+"px").style("top",f.pageY-15+"px")}).on("mouseleave",function(f,y){const v=d3.select(this).attr("data-original-r")||l(y.songCount);d3.select(this).transition().duration(200).attr("stroke-width",2).attr("r",v),g.transition().duration(200).style("opacity",0).on("end",function(){d3.select(this).style("display","none")})}).merge(m).transition().duration(1e3).attr("cx",f=>f.x).attr("cy",f=>f.y).attr("r",f=>l(f.songCount)).attr("fill",f=>this.danceabilityToColor(f.avgDanceability)),m.exit().transition().duration(500).attr("r",0).attr("cx",s).attr("cy",o).remove(),this.animationRunning&&!this.options.reducedMotion&&this.animatePlanets(h,s,o,l)}animatePlanets(t,n,i,r){const s=()=>{if(!this.animationRunning)return;const o=Date.now()-this.startTime;this.svg.select("#planets").selectAll(".planet").data(t,a=>a.name).attr("cx",a=>{const c=a.baseAngle+o*a.orbitalSpeed;return n+a.distance*Math.cos(c)}).attr("cy",a=>{const c=a.baseAngle+o*a.orbitalSpeed;return i+a.distance*Math.sin(c)}),requestAnimationFrame(s)};s()}setupYearButtons(){document.querySelectorAll(".year-btn").forEach(t=>{t.addEventListener("click",n=>{const i=n.target.dataset.year;this.switchYear(i),document.querySelectorAll(".year-btn").forEach(r=>{r.classList.remove("active")}),n.target.classList.add("active")})})}switchYear(t){this.data[t]&&(this.currentYear=t,this.startTime=Date.now(),this.updateVisualization())}highlightTopArtists(){const t=this.data[this.currentYear];if(!t)return;const i=[...t].sort((r,s)=>s.songCount-r.songCount).slice(0,2).map(r=>r.name);this.svg.selectAll(".planet").transition().duration(400).attr("opacity",r=>i.includes(r.name)?1:.3)}fadeOrbits(){this.svg.selectAll(".planet-orbit").transition().duration(600).attr("opacity",0)}}class Bn extends pt{constructor(){super(),this.container=null,this.data=null,this.state={currentStep:0,filters:{topN:10},highlights:[],animationPaused:!1,interactionMode:"explore"},this.options={...mt},this.mounted=!1,this.svg=null,this.simulation=null}async init(t,n={}){if(this.container=typeof t=="string"?document.querySelector(t):t,!this.container)throw new Error(`Container not found: ${t}`);this.options={...this.options,...n},await this.loadData(),this.emit(N.DATA_READY)}async loadData(){this.data={nodes:[{id:"BookTok",type:"community",size:450230},{id:"FoodTok",type:"community",size:382190},{id:"CleanTok",type:"community",size:234560},{id:"FitTok",type:"community",size:567230},{id:"sound1",type:"sound",name:"Trending Audio 1",duration_weeks:8},{id:"sound2",type:"sound",name:"Viral Beat",duration_weeks:12},{id:"sound3",type:"sound",name:"Dance Track",duration_weeks:6}],links:[{source:"BookTok",target:"sound1",value:.8},{source:"FoodTok",target:"sound2",value:.6},{source:"CleanTok",target:"sound3",value:.7},{source:"FitTok",target:"sound1",value:.5},{source:"BookTok",target:"sound2",value:.4}]}}mount(){this.mounted||(this.render(),this.mounted=!0,this.emit(N.ENTER_COMPLETE))}unmount(){this.mounted&&(this.simulation&&this.simulation.stop(),this.container.innerHTML="",this.mounted=!1,this.emit(N.EXIT_COMPLETE))}destroy(){this.unmount(),this.data=null,this.state=null,this.events.clear()}update(t,n={}){switch(this.state.currentStep=t,t){case 5:this.filterByCommunity("BookTok");break;case 6:this.highlightTrendingSounds();break}this.emit(N.UPDATE_COMPLETE)}resize(t,n){this.options.width=t,this.options.height=n,this.mounted&&this.render(),this.emit(N.RESIZE)}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},this.emit(N.STATE_CHANGE)}isDataReady(){return this.data!==null}render(){if(!this.data)return;this.container.innerHTML="";const t=this.container.getBoundingClientRect(),n=t.width||800,i=t.height||600;this.svg=d3.select(this.container).append("svg").attr("viewBox",`0 0 ${n} ${i}`).attr("role","img").attr("aria-label","Network visualization showing community and sound connections");const r=this.svg.append("g"),s=r.append("g").attr("class","links"),o=r.append("g").attr("class","nodes"),a=d3.scaleSqrt().domain([0,d3.max(this.data.nodes.filter(d=>d.type==="community"),d=>d.size)]).range([20,60]),c=d3.scaleLinear().domain([0,1]).range([1,5]);this.simulation=d3.forceSimulation(this.data.nodes).force("link",d3.forceLink(this.data.links).id(d=>d.id).distance(100)).force("charge",d3.forceManyBody().strength(-300)).force("center",d3.forceCenter(n/2,i/2)).force("collision",d3.forceCollide().radius(d=>d.type==="community"?a(d.size)+10:20));const l=s.selectAll("line").data(this.data.links).join("line").attr("stroke","var(--color-border-interactive)").attr("stroke-width",d=>c(d.value)).attr("opacity",.3),u=o.selectAll("g").data(this.data.nodes).join("g").attr("class",d=>`node ${d.type}`);u.filter(d=>d.type==="community").append("circle").attr("r",d=>a(d.size)).attr("fill","var(--color-background-secondary)").attr("stroke","var(--color-accent-cyan)").attr("stroke-width",2),u.filter(d=>d.type==="sound").append("rect").attr("width",30).attr("height",30).attr("x",-15).attr("y",-15).attr("rx",6).attr("fill","var(--color-accent-magenta)").attr("opacity",.8),u.append("text").text(d=>d.id.substring(0,10)).attr("text-anchor","middle").attr("dy",d=>d.type==="community"?0:40).style("fill","var(--color-text-primary)").style("font-size","var(--font-size-caption)"),this.addInteractions(u),this.simulation.on("tick",()=>{l.attr("x1",d=>d.source.x).attr("y1",d=>d.source.y).attr("x2",d=>d.target.x).attr("y2",d=>d.target.y),u.attr("transform",d=>`translate(${d.x}, ${d.y})`)})}addInteractions(t){const n=d3.drag().on("start",(i,r)=>{i.active||this.simulation.alphaTarget(.3).restart(),r.fx=r.x,r.fy=r.y}).on("drag",(i,r)=>{r.fx=i.x,r.fy=i.y}).on("end",(i,r)=>{i.active||this.simulation.alphaTarget(0),r.fx=null,r.fy=null});t.call(n),t.on("mouseenter",(i,r)=>{this.highlightConnected(r)}).on("mouseleave",()=>{this.resetHighlights()})}filterByCommunity(t){if(!this.svg)return;const n=new Set([t]);this.data.links.forEach(i=>{(i.source.id===t||i.source===t)&&n.add(typeof i.target=="object"?i.target.id:i.target),(i.target.id===t||i.target===t)&&n.add(typeof i.source=="object"?i.source.id:i.source)}),this.svg.selectAll(".node").transition().duration(400).attr("opacity",i=>n.has(i.id)?1:.2)}highlightTrendingSounds(){this.svg&&this.svg.selectAll(".node.sound rect").transition().duration(300).attr("opacity",1).style("filter","var(--shadow-glow-magenta)")}highlightConnected(t){const n=new Set([t.id]);this.data.links.forEach(i=>{(i.source.id===t.id||i.source===t.id)&&n.add(typeof i.target=="object"?i.target.id:i.target),(i.target.id===t.id||i.target===t.id)&&n.add(typeof i.source=="object"?i.source.id:i.source)}),this.svg.selectAll(".node").transition().duration(200).attr("opacity",i=>n.has(i.id)?1:.3)}resetHighlights(){this.svg.selectAll(".node").transition().duration(200).attr("opacity",1)}showCityLine(){console.log("Showing city line transition")}growStems(){console.log("Growing stems transition")}}class Yn{constructor(t,n,i,r,s={}){if(this.parentElement=d3.select(t),this.parentElement.empty())throw new Error(`RankingBubbleChart: container "${t}" not found.`);this.category=n,this.categoryColor=i||"var(--color-accent)",this.gifUrl=r||null,this.options={maxAuthors:18,margin:{top:40,right:24,bottom:32,left:24},minRadius:14,maxRadius:60,dataPath:"/data/youtube_shorts_tiktok_trends_2025.csv",...s},this.width=this.parentElement.node().clientWidth||480,this.height=this.parentElement.node().clientHeight||360,this.rawData=[],this.authorStats=[],this.svg=null,this.chartG=null,this.tooltip=null,this.initVis(),this.loadData()}initVis(){this.parentElement.selectAll("*").remove(),d3.selectAll("#rankingBubbleTooltip").remove(),this.tooltip&&(this.tooltip.remove(),this.tooltip=null),this.svg=this.parentElement.append("svg").attr("class","ranking-bubble-chart").attr("width",this.width).attr("height",this.height).attr("role","img").attr("aria-label",`Top creators in ${this.category} community`);const t=20,n=20;this.svg.append("defs").append("clipPath").attr("id","bubbleChartRoundedClip").append("rect").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height).attr("rx",t).attr("ry",n),this.svg.append("rect").attr("class","bubble-bg").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height).attr("fill","#ffffff").attr("stroke","#ff0050").attr("stroke-width",0).attr("rx",t).attr("ry",n),this.gifUrl&&this.svg.append("image").attr("class","bubble-gif").attr("href",this.gifUrl).attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height).attr("opacity",.75).attr("preserveAspectRatio","xMidYMid slice").attr("clip-path","url(#bubbleChartRoundedClip)"),this.svg.append("rect").attr("class","bubble-frame").attr("x",0).attr("y",0).attr("width",this.width).attr("height",this.height).attr("fill","none").attr("rx",t).attr("ry",n),this.chartG=this.svg.append("g").attr("transform",`translate(${this.options.margin.left},${this.options.margin.top})`),this.innerWidth=this.width-this.options.margin.left-this.options.margin.right,this.innerHeight=this.height-this.options.margin.top-this.options.margin.bottom,this.title=this.chartG.append("text").attr("class","bubble-title").attr("x",this.innerWidth/2).attr("y",-16).attr("text-anchor","middle").text(this.category?`${this.category}Tok`:"Creators").style("font-size","25px").style("font-weight","600"),this.subtitle=this.chartG.append("text").attr("class","bubble-subtitle").attr("x",this.innerWidth/2).attr("y",5).attr("text-anchor","middle").style("fill","var(--color-text-secondary)").style("font-size","15px").style("fill","#515151ff").text("Top Creators In This Community"),this.tooltip=d3.select("body").append("div").attr("class","tooltip ranking-bubble-tooltip").attr("id","rankingBubbleTooltip").style("position","absolute").style("pointer-events","none").style("z-index","9999").style("opacity",0).style("width","350px").style("max-width","350px").style("white-space","normal").style("word-wrap","break-word").style("overflow","hidden")}async loadData(){this.rawData.length||(this.rawData=await d3.csv(this.options.dataPath,d3.autoType)),this.wrangleData(),this.updateVis()}setData(t){this.rawData=t||[],this.wrangleData(),this.updateVis()}wrangleData(){if(!this.rawData.length||!this.category){this.authorStats=[];return}const t=this.rawData.filter(o=>(o.category||o.Category)===this.category);let i=d3.rollups(t,o=>{const a=d3.sum(o,g=>g.views??g.playCount??0),c=d3.sum(o,g=>g.likes??0),l=d3.sum(o,g=>g.comments??0),u=d3.sum(o,g=>g.shares??0),d=d3.sum(o,g=>g.saves??0),h=new Set,p=new Set,m=new Set;return o.forEach(g=>{g.hashtag&&String(g.hashtag).split(/[,\s]+/).filter(Boolean).forEach(y=>h.add(y.startsWith("#")?y:`#${y}`)),g.hashtags&&String(g.hashtags).split(/[,\s]+/).filter(Boolean).forEach(y=>h.add(y.startsWith("#")?y:`#${y}`));const b=g.genre||g.Genre;b&&String(b).split(/[,\s]+/).filter(Boolean).forEach(y=>p.add(y));const f=g.music_track||g.soundtrack||g.sound||g.audio;f&&m.add(String(f))}),{totalViews:a,totalLikes:c,totalComments:l,totalShares:u,totalSaves:d,hashtags:Array.from(h).slice(0,15),genres:Array.from(p).slice(0,10),sounds:Array.from(m).slice(0,10)}},o=>o.authorHandle||o.author_handle||o.creator||"Unknown").map(([o,a])=>({author:o,...a})).filter(o=>o.totalViews>0);i=i.slice(0,25);const r=d3.max(i,o=>o.totalViews)||1,s=d3.scaleSqrt().domain([0,r]).range([this.options.minRadius,this.options.maxRadius]);i.forEach(o=>{o.r=s(o.totalViews)}),this.authorStats=i}updateVis(){if(!this.chartG)return;const t=this.authorStats;if(!t.length){this.chartG.selectAll(".author-node").remove();return}const n=this.innerWidth/2,i=this.innerHeight/2,r=t.map(u=>({...u})),s=d3.forceSimulation(r).force("x",d3.forceX(n).strength(.08)).force("y",d3.forceY(i).strength(.08)).force("collide",d3.forceCollide(u=>u.r+4)).stop(),o=260;for(let u=0;u<o;u++)s.tick(),r.forEach(d=>{d.x=Math.max(d.r,Math.min(this.innerWidth-d.r,d.x)),d.y=Math.max(d.r+30,Math.min(this.innerHeight-d.r,d.y))});s.stop();const a=this.chartG.selectAll(".author-node").data(r,u=>u.author);a.exit().transition().duration(200).attr("opacity",0).remove();const c=a.enter().append("g").attr("class","author-node").attr("transform",`translate(${n},${i})`).attr("opacity",0);c.append("circle").attr("class","author-circle").attr("r",0).attr("fill",this.categoryColor).attr("fill-opacity",.9),c.append("text").attr("class","author-label").attr("text-anchor","middle").attr("dy","0.35em").style("pointer-events","none").text(u=>u.author);const l=c.merge(a);l.transition().duration(400).attr("opacity",1).attr("transform",u=>`translate(${u.x},${u.y})`),l.select(".author-circle").transition().duration(400).attr("r",u=>u.r).attr("fill",this.categoryColor),l.select(".author-label").each(function(u){const d=d3.select(this);let h=u.author||"";d.text(h);const m=u.r*2-6;let g=Math.min(16,u.r*.6);if(g<8){d.text("");return}d.style("font-size",`${g}px`);let b=this.getBBox();for(;b.width>m&&g>7;)g-=1,d.style("font-size",`${g}px`),b=this.getBBox();if(b.width>m){let f=h;for(;f.length>3&&(f=f.slice(0,-2),d.text(f+"…"),b=this.getBBox(),!(b.width<=m)););b.width>m&&d.text("")}}),l.on("mouseover",(u,d)=>{d3.select(u.currentTarget).select(".author-circle").attr("fill-opacity",1).attr("stroke","#484848ff").attr("stroke-width",5),this.tooltip.style("opacity",1).html(this.getTooltipHtml(d)),this.moveTooltip(u)}).on("mousemove",u=>{this.moveTooltip(u)}).on("mouseleave",()=>{d3.select(event.currentTarget).select(".author-circle").attr("fill-opacity",.9).attr("stroke",null).attr("stroke-width",null),this.tooltip.transition().duration(.1).style("opacity",0)})}moveTooltip(t){if(!this.tooltip)return;const n=-40,i=20;let r=t.pageX+n,s=t.pageY+i;this.tooltip.style("left",`${r}px`).style("top",`${s}px`)}getTooltipHtml(t){const n=d3.format(",d");return`
      <div class="tooltip-title">@${t.author}</div>
      <div class="tooltip-metric"><span>Views:</span> ${n(t.totalViews)}</div>
      <div class="tooltip-metric"><span>Likes:</span> ${n(t.totalLikes)}</div>
      <div class="tooltip-metric"><span>Comments:</span> ${n(t.totalComments)}</div>
      <div class="tooltip-metric"><span>Shares:</span> ${n(t.totalShares)}</div>
      <div class="tooltip-metric"><span>Saves:</span> ${n(t.totalSaves)}</div>
      ${t.hashtags&&t.hashtags.length?`<div class="tooltip-list"><span>Hashtags:</span> ${t.hashtags.join(", ")}</div>`:""}
      ${t.sounds&&t.sounds.length?`<div class="tooltip-list"><span>Sounds:</span> ${t.sounds.join(", ")}</div>`:""}
    `}resize(t,n){this.width=t,this.height=n,this.initVis(),this.wrangleData(),this.updateVis()}destroy(){this.svg&&(this.svg.remove(),this.svg=null,this.chartG=null),this.tooltip&&(this.tooltip.remove(),this.tooltip=null),this.authorStats=[]}}class Vn extends pt{constructor(){super(),this.container=null,this.data=null,this.state={currentStep:0,filters:{topN:6},highlights:[],animationPaused:!1,interactionMode:"explore"},this.options={...mt},this.mounted=!1,this.svg=null,this.simulation=null,this.popup=null}async init(t,n={}){if(this.container=typeof t=="string"?document.querySelector(t):t,!this.container)throw new Error(`Container not found: ${t}`);this.options={...this.options,...n},await this.loadData(),this.emit(N.DATA_READY)}async loadData(){try{const t=await d3.csv("/data/youtube_shorts_tiktok_trends_2025.csv"),n={};t.forEach(s=>{const o=s.category,a=parseInt(s.views,10);o in n?n[o]+=a:n[o]=a});const r=Object.keys(n).map(s=>({category:s,views:n[s]})).sort((s,o)=>o.views-s.views).slice(0,6);this.data={categories:r.map((s,o)=>({rank:o+1,category:s.category,color:this.getCategoryColor(s.category),views:s.views}))},this.emit(N.DATA_READY)}catch(t){console.error("Error loading or processing data:",t)}}getCategoryColor(){const t=Math.floor(Math.random()*128+128),n=Math.floor(Math.random()*128+128),i=Math.floor(Math.random()*128+128);return((s,o,a)=>`#${(1<<24|s<<16|o<<8|a).toString(16).slice(1).toUpperCase()}`)(t,n,i)}mount(){this.mounted||(this.render(),this.mounted=!0,this.emit(N.ENTER_COMPLETE))}unmount(){this.mounted&&(this.container.innerHTML="",this.mounted=!1,this.emit(N.EXIT_COMPLETE))}destroy(){this.unmount(),this.data=null,this.state=null,this.events.clear()}update(t,n={}){this.state.currentStep=t,this.emit(N.UPDATE_COMPLETE)}resize(t,n){this.options.width=t,this.options.height=n,this.mounted&&this.render(),this.emit(N.RESIZE)}render(){if(!this.data)return;this.container.innerHTML="";const t=1e3,n=800;this.svg=d3.select(this.container).append("svg").attr("viewBox",`0 0 ${t} ${n}`).attr("role","img").attr("aria-label","Category visualization showing ranking and interaction");const i=this.svg.append("g").attr("transform",`translate(${t/2}, ${n/2}) translate(${-t/2}, ${-n/2})`),r=this.data.categories.map((w,A)=>{let x,C;A===0?(x=0,C=0):A<=2?(x=1,C=A-1):(x=2,C=A-3);const R=100+x*200;return{...w,row:x,column:C,y:R,coverFallen:!1}}),s=200,o=150,a=40,c=20,l=w=>{switch(w){case 0:return[(t-s)/2];case 1:return[(t-s*2-a)/2,(t-s*2-a)/2+s+a];case 2:return[(t-s*3-a*2)/2,(t-s*3-a*2)/2+s+a,(t-s*3-a*2)/2+(s+a)*2];default:return[]}};r.sort((w,A)=>w.row!==A.row?A.row-w.row:A.column-w.column);const u=i.selectAll("g.page").data(r).enter().append("g").attr("class","page").attr("transform",w=>`translate(${l(w.row)[w.column]}, ${w.y})`).style("cursor","pointer"),d={Pets:"https://hips.hearstapps.com/toc.h-cdn.co/assets/16/23/640x320/landscape-1465404255-tc-060816-dog-breeds.gif?resize=640:*",Fitness:"https://cdn.prod.website-files.com/66c501d753ae2a8c705375b6/67ed6a2da06e77b57e4fd380_Chest-Press-Throw.gif",Music:"https://cdn.merriammusic.com/2015/07/5CuqBlN.gif",Art:"https://images.squarespace-cdn.com/content/v1/54ecfc32e4b0866fef096797/1627925527930-83LG5C1EZEV3BZGMJU9R/Angled+Stroke+3.gif",Tech:"https://media.giphy.com/media/v1.Y2lkPWVjZjA1ZTQ3b2t2dGN1MTJsNjFsd2pzOGt5M3d4OHAxeW94Zjhkendob3Bwd3RzdCZlcD12MV9naWZzX3JlbGF0ZWQmY3Q9Zw/WTcJBZROKjmSf5prBl/giphy.gif",Food:"https://studentlife.dal.ca/article/2019/5-tips-for-your-next--or-first--meatless-monday/_jcr_content/root/maincontent/main/article-body/center/contentfragment/par17/image.coreimg.gif/1572312628676/veggie-food.gif"};this.svg.append("defs").append("clipPath").attr("id","roundedClip").append("rect").attr("width",s).attr("height",o).attr("rx",c).attr("ry",c),u.append("g").attr("class","page-bg").each(function(w){const A=d3.select(this);A.append("image").attr("href",d[w.category]||"fallback.gif").attr("width",s).attr("height",o).attr("preserveAspectRatio","xMidYMid slice").attr("clip-path","url(#roundedClip)"),A.append("rect").attr("width",s).attr("height",o).attr("rx",c).attr("fill","rgba(0, 0, 0, 0.2)"),A.append("text").attr("x",s/2).attr("y",o/2).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill","white").style("font-size","30px").style("font-weight","bold").text(w.category)});const p=this.svg.append("defs");p.append("linearGradient").attr("id","paperGradient").attr("x1","0%").attr("y1","0%").attr("x2","100%").attr("y2","100%").selectAll("stop").data([{offset:"0%",color:"#ffffff"},{offset:"100%",color:"#d5cfbd"}]).enter().append("stop").attr("offset",w=>w.offset).attr("stop-color",w=>w.color),p.append("filter").attr("id","paperShadow").attr("x","-30%").attr("y","-30%").attr("width","160%").attr("height","160%").append("feDropShadow").attr("dx",3).attr("dy",4).attr("stdDeviation",15).attr("flood-color","#000").attr("flood-opacity",.6);const b=u.append("g").attr("class","cover-group");b.append("rect").attr("width",s).attr("height",o).attr("rx",20).attr("fill","white").attr("filter","url(#paperShadow)").style("pointer-events","none"),b.append("rect").attr("width",s).attr("height",o).attr("rx",20).attr("fill","url(#paperGradient)").style("pointer-events","none"),b.append("text").attr("x",s/2).attr("y",o/2).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("fill","black").style("font-size","60px").style("font-weight","bold").style("pointer-events","none").text(w=>w.rank),b.append("rect").attr("class","tape").attr("x",s/2-40).attr("y",-10).attr("width",80).attr("height",25).attr("fill","#edebb9ff").attr("opacity",.8).attr("transform",w=>`rotate(${(Math.random()*10-5).toFixed(1)}, ${s/2}, 0)`).style("pointer-events","none");const f=new Set;let y=0;const v=new Map(r.map((w,A)=>[w.category,A]));let M=!1;u.on("mouseenter",function(w,A){if(M)return;const x=d3.select(this).select(".cover-group");d3.select(this).select("rect").transition().duration(300).style("filter","brightness(1.5)"),A.coverFallen||d3.select(this).select(".cover-group text").transition().duration(300).style("fill","#999999");const C=y;if(v.get(A.category)!==C)return;const R=1.1,E=s/2;x.transition().duration(300).ease(d3.easeCubicOut).attr("transform",`scale(${R}) translate(${E*(1-R)/R}, ${0*(1-R)/R})`),f.add(A.category),y++;const K=100+2*200+o+50,U=[1e3,1e3,1100,2e3,2e3,6e3][C]||1e3,I=`/assets/audio/ranking${C}.mp3`,S=new Audio(I);S.volume=1,M=!0,S.addEventListener("ended",()=>{M=!1}),S.addEventListener("loadedmetadata",()=>{setTimeout(()=>{const B=Math.random()*40-20,F=Math.random()*80-40,V=1+Math.random()*.05;x.transition().duration(400+Math.random()*400).ease(d3.easeCubicIn).attr("transform",`
                  translate(${F}, ${K-A.y})
                  rotate(${B}, ${s/2}, ${o/2})
                  scale(${V}, 0.6)
              `),A.coverFallen=!0},U),S.play().catch(B=>{console.error("Error playing audio:",B)});const G=S.duration-500/1e3;setTimeout(()=>{const B=setInterval(()=>{S.volume>0?S.volume=Math.max(0,S.volume-.05):(S.volume=0,clearInterval(B))},50)},G*1e3)}),S.onerror=G=>{console.error("Error playing audio:",G)}}),u.on("mouseleave",function(w,A){d3.select(this).select("rect").transition().duration(300).style("filter","brightness(1)"),d3.select(this).select(".cover-group text").transition().duration(300).style("fill","black")}),u.on("click",(w,A)=>{if(w.stopPropagation(),!A.coverFallen)return;this.popup&&(this.popup.remove(),d3.select(this.container).select(".overlay").remove(),this.popup=null,window.removeEventListener("resize",this._popupResizeHandler));const x=d3.select(this.container).append("div").attr("class","overlay").style("position","absolute").style("top",0).style("left",0).style("width","100%").style("height","100%").style("background","rgba(0,0,0,0.3)").style("backdrop-filter","blur(0px)").style("z-index",999).style("opacity",0).style("transition","opacity 0.4s ease-out, backdrop-filter 0.4s ease-out");setTimeout(()=>{x.style("opacity",1).style("backdrop-filter","blur(5px)")},10);const C=()=>({width:Math.min(window.innerWidth*.8,700),height:Math.min(window.innerHeight*.8,500)}),{width:q,height:R}=C();this.popup=d3.select(this.container).append("div").attr("class","bubble-popup").style("position","absolute").style("top","50%").style("left","50%").style("transform","translate(-50%, -50%) scale(0.7)").style("opacity",0).style("background","white").style("border-radius","30px").style("z-index",1e3).style("width",q+"px").style("height",R+"px").style("transition","transform 0.4s ease-out, opacity 0.4s ease-out, width 0.3s ease, height 0.3s ease"),setTimeout(()=>{this.popup.style("transform","translate(-50%, -50%) scale(1)").style("opacity",1)},10),new Yn(this.popup.node(),A.category,A.color,d[A.category]||"",{maxAuthors:18}),this._popupResizeHandler=()=>{if(!this.popup)return;const{width:E,height:P}=C();this.popup.style("width",E+"px").style("height",P+"px")},window.addEventListener("resize",this._popupResizeHandler),x.on("click",()=>{this.popup.style("transform","translate(-50%, -50%) scale(0.7)").style("opacity",0),x.style("opacity",0).style("backdrop-filter","blur(0px)"),setTimeout(()=>{this.popup&&(this.popup.remove(),this.popup=null,window.removeEventListener("resize",this._popupResizeHandler)),x.remove()},400)})})}}const Xn="modulepreload",Un=function(e){return"/tiktok-tides/"+e},Ce={},Kn=function(t,n,i){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),a=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));r=Promise.allSettled(n.map(c=>{if(c=Un(c),c in Ce)return;Ce[c]=!0;const l=c.endsWith(".css"),u=l?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${u}`))return;const d=document.createElement("link");if(d.rel=l?"stylesheet":Xn,l||(d.as="script"),d.crossOrigin="",d.href=c,a&&d.setAttribute("nonce",a),document.head.appendChild(d),l)return new Promise((h,p)=>{d.addEventListener("load",h),d.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${c}`)))})}))}function s(o){const a=new Event("vite:preloadError",{cancelable:!0});if(a.payload=o,window.dispatchEvent(a),!a.defaultPrevented)throw o}return r.then(o=>{for(const a of o||[])a.status==="rejected"&&s(a.reason);return t().catch(s)})};class Wn extends pt{constructor(){super(),this.container=null,this.rawData=null,this.data=null,this.state={currentStep:0,filters:{layer:"emotion"},highlights:[],animationPaused:!1,interactionMode:"explore"},this.options={...mt,reducedMotion:rn()},this.mounted=!1,this.svg=null,this.linkLayer=null,this.sentiment=null,this.embedder=null,this.activeEmotions=null,this.manualLexicon={"+3":new Set(["amazing","awesome","love","loving","perfect","incredible","best","beautiful"]),"+2":new Set(["good","great","nice","cool","funny","fun","popular","viral","trend","trendy","fyp","foryou","foryoupage","dance","cute","enjoy","wow","happy","smile"]),"-2":new Set(["bad","sad","angry","hate","cringe","boring","worst","tired","alone","upset","cry","crying"])}}async init(t,n={}){if(this.container=typeof t=="string"?document.querySelector(t):t,!this.container)throw new Error(`Container not found: ${t}`);this.options={...this.options,...n},await this.loadData(),this.emit(N.DATA_READY)}async initNLP(){this.sentiment||(window.Sentiment?this.sentiment=new window.Sentiment:console.warn('Sentiment library not found; using manual lexicon for emotions. Include it via <script src="https://cdn.jsdelivr.net/npm/sentiment@5.0.1/dist/sentiment.min.js"><\/script>'))}lexiconScore(t){const n=t.toLowerCase();return this.manualLexicon["+3"].has(n)?3:this.manualLexicon["+2"].has(n)?2:this.manualLexicon[-2].has(n)?-2:0}mapSentimentToEmotion(t){const n=t;return n<=-1.8?"anger":n<=-1?"sadness":n<-.25?"disappointment":n<=.25?"neutral":n<.9?"hope":n<1.6?"joy":"excitement"}async initEmbedder(){if(this.embedder)return;const{pipeline:t,env:n}=await Kn(async()=>{const{pipeline:i,env:r}=await import("./transformers-DNqGmKY2.js");return{pipeline:i,env:r}},[]);n.allowLocalModels=!1,this.embedder=await t("feature-extraction","Xenova/all-MiniLM-L6-v2")}async computeEmbeddings(t){await this.initEmbedder();const n=await this.embedder(t,{pooling:"mean",normalize:!0});return n.tolist?n.tolist():n.data}cosineSimilarity(t,n){if(!t||!n||t.length!==n.length)return 0;let i=0,r=0,s=0;for(let a=0;a<t.length;a++){const c=t[a],l=n[a];i+=c*l,r+=c*c,s+=l*l}const o=Math.sqrt(r)*Math.sqrt(s);return o?i/o:0}projectEmbeddingsTo2D(t){if(!t.length||!t[0].embedding)return;const n=t[0].embedding.length,i=new Array(n),r=new Array(n);for(let s=0;s<n;s++)i[s]=Math.random()-.5,r[s]=Math.random()-.5;t.forEach(s=>{const o=s.embedding;let a=0,c=0;for(let l=0;l<n;l++)a+=o[l]*i[l],c+=o[l]*r[l];s.projX=a,s.projY=c})}async loadData(){try{await this.initNLP();const[t]=await Promise.all([d3.csv("/data/cleaned_tiktok_data.csv",d3.autoType)]);this.rawData=t;const n=t.filter(b=>typeof(b==null?void 0:b.text)=="string"&&b.text.trim().length>0),i=new Set(["the","and","for","that","this","with","have","has","was","are","but","not","just","you","your","they","them","their","its","it's","ive","i've","cant","can't","didnt","didn't","im","i'm","like","get","got","tiktok","http","https","www","com"]),r=new Set(["omg","lol","lmao","lmfao","wtf","idk","tbh","btw","ikr","rn","tho","bruh","bro","sis","omfg","pls","plz","yall","ya","yea","yeah","ok","okay","kinda","sorta","really","literally","actually","gonna","wanna","gotta","haha","hahaha","ahah","hehe","heh","ugh","smh","fr","lowkey","highkey","how","many","our","back","try","keep","now","these","who","one","what","think","part","never","can"]),s=/^[a-z]+$/,o=new Set(["the","and","for","that","this","with","have","has","was","were","are","is","on","in","of","to","from","it","its","as","at","by","or","if","but","so","just","not","no","yes","you","your","yours","me","my","we","our","ours","they","them","their","what","when","where","why","how","who","which","can","could","do","did","done","will","would","all","any","some","more","most","very","too","also","only","new","now","one","two","make","made","get","got","see","look","watch","video","music","song","dance","trend","trending","viral","fyp","foryou","foryoupage","love","like","good","great","best","fun","funny","cool","nice","happy","sad","bad","girl","boy","girls","boys","school","day","time","life","people","friend","friends"]),a=new Map;n.forEach(b=>{const v=(String(b.text).toLowerCase().match(/\b[\p{L}\p{N}'’]+\b/gu)||[]).map(A=>A.replace(/['’]/g,"")).filter(A=>A&&s.test(A));!v.length||v.filter(A=>o.has(A)).length/v.length<.3||v.forEach(A=>{if(i.has(A)||r.has(A)||A.length<=2)return;let x=a.get(A);x||(x={word:A,count:0},a.set(A,x)),x.count+=1})});let c=Array.from(a.values()).sort((b,f)=>f.count-b.count).slice(0,120);const l={anger:"#dc2626",sadness:"#2563eb",disappointment:"#7c3aed",neutral:"#6b7280",hope:"#22c55e",joy:"#a3e635",excitement:"#f97316"},u=new Set;c.forEach(b=>{let f=0;if(this.sentiment&&(f=this.sentiment.analyze(b.word).score||0),f===0){const v=this.lexiconScore(b.word);v!==0&&(f=v)}if(f===0){let v=(Math.random()-.5)*2;Math.abs(v)<.3&&(v=v<0?-.3:.3),f=v}let y=f;Math.abs(f)>=1&&(y=Math.sign(f)*Math.sqrt(Math.abs(f))),b.sentiment=y,b.emotion=this.mapSentimentToEmotion(y),u.add(b.emotion)});const d=c.map(b=>b.word),h=await this.computeEmbeddings(d);if(!h||h.length!==c.length){console.warn("Embeddings missing or wrong size; falling back to no semantic links"),this.data={tokens:c,links:[],emotionCategories:Array.from(u),emotionColors:l},this.activeEmotions=new Set(this.data.emotionCategories);return}c.forEach((b,f)=>{b.embedding=h[f]}),this.projectEmbeddingsTo2D(c);const p=[],m=.25,g=8;for(let b=0;b<c.length;b++){const f=[];for(let y=0;y<c.length;y++){if(b===y)continue;const v=this.cosineSimilarity(c[b].embedding,c[y].embedding);f.push({j:y,sim:v})}f.sort((y,v)=>v.sim-y.sim).slice(0,g).forEach(({j:y,sim:v})=>{v>=m&&p.push({source:b,target:y,similarity:v})})}this.data={tokens:c,links:p,emotionCategories:Array.from(u),emotionColors:l},this.activeEmotions=new Set(this.data.emotionCategories)}catch(t){console.error("Error loading TikTok data for EmotionViz:",t)}}mount(){this.mounted||!this.data||(this.render(),this.setupLegend(),this.mounted=!0,this.emit(N.ENTER_COMPLETE))}unmount(){this.mounted&&(this.container.innerHTML="",this.mounted=!1,this.emit(N.EXIT_COMPLETE))}destroy(){this.unmount(),this.data=null,this.state=null,this.events.clear()}update(t,n={}){switch(this.state.currentStep=t,t){case 9:this.toggleLayer("sentiment");break;case 10:this.highlightHighEngagement();break}this.emit(N.UPDATE_COMPLETE)}resize(t,n){this.options.width=t,this.options.height=n,this.mounted&&(this.render(),this.applyEmotionFilter()),this.emit(N.RESIZE)}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},this.emit(N.STATE_CHANGE)}isDataReady(){return this.data!==null}render(){if(!this.data)return;const{tokens:t,links:n,emotionColors:i}=this.data;this.container.innerHTML="";const r=this.container.getBoundingClientRect(),s=this.options.width||r.width||800,o=this.options.height||r.height||600,a=40;this.svg=d3.select(this.container).append("svg").attr("viewBox",`0 0 ${s} ${o}`).attr("role","img").attr("aria-label","Word cloud showing sentiment-colored speech bubbles for TikTok caption words"),this.linkLayer=this.svg.append("g").attr("class","semantic-links");const c=d3.scaleSqrt().domain(d3.extent(t,f=>f.count)).range([12,42]),l=10,u=6;t.forEach(f=>{const y=c(f.count),v=f.word.length*y*.6;f.fontSize=y,f.boxWidth=v+l*2,f.boxHeight=y+u*2});const d=d3.extent(t,f=>f.projX),h=d3.extent(t,f=>f.projY),p=d3.scaleLinear().domain(d).range([a,s-a]),m=d3.scaleLinear().domain(h).range([a,o-a]);t.forEach(f=>{const y=p(f.projX),v=m(f.projY);f.x=y,f.y=v,f.anchorX=y,f.anchorY=v});const g=d3.forceSimulation(t).alphaDecay(.12).velocityDecay(.4).force("x",d3.forceX(f=>f.anchorX).strength(.2)).force("y",d3.forceY(f=>f.anchorY).strength(.2)).force("link",d3.forceLink(n).id((f,y)=>y).distance(f=>30+(1-(f.similarity||0))*120).strength(f=>.12*(f.similarity||0))).force("collision",d3.forceCollide(f=>Math.max(f.boxWidth,f.boxHeight)/2+6)).stop();for(let f=0;f<150;f++)g.tick();const b=this.svg.selectAll(".word-bubble").data(t).join("g").attr("class","word-bubble").attr("transform",f=>`translate(${f.x}, ${f.y})`);b.append("rect").attr("class","bubble-body").attr("x",f=>-f.boxWidth/2).attr("y",f=>-f.boxHeight/2).attr("width",f=>f.boxWidth).attr("height",f=>f.boxHeight).attr("rx",16).attr("ry",16).attr("fill",f=>i[f.emotion]||"#e5e7eb").attr("stroke","transparent").attr("opacity",.95),b.append("path").attr("class","bubble-tail").attr("d",f=>{const M=f.boxHeight/2-1,w=f.boxWidth/2-12-12,A=w+12,x=(w+A)/2,C=M+9;return`M ${w} ${M}
                L ${A} ${M}
                L ${x} ${C}
                Z`}).attr("fill",f=>i[f.emotion]||"#e5e7eb").attr("stroke","transparent").attr("opacity",.95),b.append("text").text(f=>f.word).attr("text-anchor","middle").attr("dominant-baseline","middle").style("font-size",f=>`${f.fontSize}px`).style("fill","var(--color-text-primary, #020617)").style("pointer-events","none"),this.addBubbleInteractions(b),this.options.reducedMotion||b.attr("opacity",0).transition().duration(700).delay((f,y)=>y*20).attr("opacity",1),this.applyEmotionFilter()}updateHoverLinks(t){if(!this.linkLayer||!this.data)return;const{links:n}=this.data;if(!n||!n.length){this.clearHoverLinks();return}const i=t.index,r=this.activeEmotions||new Set(this.data.emotionCategories||[]),s=n.filter(u=>(u.source.index??u.source)===i||(u.target.index??u.target)===i);if(!s.length){this.clearHoverLinks();return}s.sort((u,d)=>d.similarity-u.similarity);const c=s.slice(0,6).map(u=>{const d=u.source.index??u.source;u.target.index??u.target;const h=d===i?u.target:u.source;return!h||!r.has(h.emotion)?null:{x1:t.x,y1:t.y,x2:h.x,y2:h.y,similarity:u.similarity}}).filter(Boolean);if(this.linkLayer.selectAll("line.semantic-link").remove(),!c.length)return;const l=this.linkLayer.selectAll("line.semantic-link").data(c).enter().append("line").attr("class","semantic-link").attr("x1",u=>u.x1).attr("y1",u=>u.y1).attr("x2",u=>u.x1).attr("y2",u=>u.y1).attr("stroke-opacity",0).attr("pointer-events","none");this.options.reducedMotion?l.attr("x2",u=>u.x2).attr("y2",u=>u.y2).attr("stroke-opacity",.9):l.transition().duration(200).attr("x2",u=>u.x2).attr("y2",u=>u.y2).attr("stroke-opacity",.9)}clearHoverLinks(){if(!this.linkLayer)return;const t=this.linkLayer.selectAll("line.semantic-link");this.options.reducedMotion?t.remove():t.transition().duration(150).attr("stroke-opacity",0).remove()}setupLegend(){const t=document.querySelector(".emotion-legend");if(!t||!this.data)return;t.innerHTML="";const n=this;this.data.emotionCategories.forEach(i=>{const r=document.createElement("li");r.className="emotion-legend-item";const s=this.data.emotionColors[i];r.innerHTML=`
      <label class="emotion-legend-label-wrapper">
        <input
          type="checkbox"
          class="emotion-legend-checkbox"
          data-emotion="${i}"
          checked
        />
        <span class="emotion-legend-chip" style="--emotion-color:${s}">
          <span class="emotion-legend-checkmark"></span>
          <span class="emotion-legend-color-dot"></span>
          <span class="emotion-legend-text">${i}</span>
        </span>
      </label>
    `,t.appendChild(r);const o=r.querySelector(".emotion-legend-checkbox");o&&o.addEventListener("change",a=>{const c=a.target.dataset.emotion;n.activeEmotions||(n.activeEmotions=new Set(n.data.emotionCategories)),a.target.checked?n.activeEmotions.add(c):n.activeEmotions.delete(c),n.applyEmotionFilter()})})}applyEmotionFilter(){if(!this.svg||!this.data||!this.activeEmotions)return;const t=this.activeEmotions;this.svg.selectAll(".word-bubble").attr("display",n=>t.has(n.emotion)?null:"none"),this.clearHoverLinks()}addBubbleInteractions(t){t.on("mouseenter",(n,i)=>{const r=d3.select(n.currentTarget);this.options.reducedMotion?r.raise().attr("transform",`translate(${i.x}, ${i.y}) scale(1.08)`):r.raise().transition().duration(160).attr("transform",`translate(${i.x}, ${i.y}) scale(1.08)`),this.showBubbleDetail(i),this.updateHoverLinks(i)}).on("mouseleave",(n,i)=>{const r=d3.select(n.currentTarget);this.options.reducedMotion?r.attr("transform",`translate(${i.x}, ${i.y}) scale(1)`):r.transition().duration(160).attr("transform",`translate(${i.x}, ${i.y}) scale(1)`),this.clearHoverLinks()})}showBubbleDetail(t){var i;const n=document.querySelector(".drawer-content");n&&(n.innerHTML=`
        <h3>${t.word}</h3>
        <p>Emotion bucket: <strong>${t.emotion}</strong></p>
        <p>Sentiment score: ${(i=t.sentiment)!=null&&i.toFixed?t.sentiment.toFixed(2):t.sentiment}</p>
        <p>Frequency (word count): ${t.count}</p>
      `)}openDetailDrawer(t){const n=document.querySelector(".detail-drawer");n&&(n.setAttribute("aria-hidden","false"),this.showBubbleDetail(t));const i=document.querySelector(".drawer-close");i&&n&&(i.onclick=()=>{n.setAttribute("aria-hidden","true")})}toggleLayer(t){console.log(`Toggling to "${t}" layer`)}highlightHighEngagement(){if(!this.svg||!this.data)return;const n=(d3.max(this.data.tokens,i=>i.count)||1)*.6;this.svg.selectAll(".word-bubble").transition().duration(400).attr("opacity",i=>i.count>=n?1:.25)}emphasizeOutlines(){this.svg&&this.svg.selectAll(".word-bubble rect").attr("stroke-width",3)}}class Zn extends pt{constructor(){super(),this.container=null,this.data=null,this.state={currentStep:0,selectedIngredient:null,quizActive:!1,userGuesses:{},filters:{},highlights:[],animationPaused:!1,interactionMode:"explore"},this.options={...mt},this.mounted=!1}async init(t,n={}){if(this.container=typeof t=="string"?document.querySelector(t):t,!this.container)throw new Error(`Container not found: ${t}`);this.options={...this.options,...n},await this.loadData(),this.emit(N.DATA_READY)}async loadData(){try{const t=await fetch("/data/ingredients_sample.json");if(t.ok)this.data=await t.json();else throw new Error("File not found")}catch{this.data=[{ingredient:"video_length_bucket",label:"Video Duration",icon:"⏱️",description:"Optimal length for engagement",with:{views:"PLACEHOLDER_892K",shares:"PLACEHOLDER_45K"},without:{views:"PLACEHOLDER_234K",shares:"PLACEHOLDER_12K"},examples:["15-30 sec sweet spot","60 sec for tutorials"]},{ingredient:"sound_reuse",label:"Trending Audio",icon:"🎵",description:"Using viral sounds",with:{views:"PLACEHOLDER_1.2M",shares:"PLACEHOLDER_89K"},without:{views:"PLACEHOLDER_156K",shares:"PLACEHOLDER_8K"},examples:["Original sounds","Remixes"]},{ingredient:"hashtag_count",label:"Hashtag Strategy",icon:"#️⃣",description:"3-5 targeted hashtags",with:{views:"PLACEHOLDER_678K",shares:"PLACEHOLDER_34K"},without:{views:"PLACEHOLDER_234K",shares:"PLACEHOLDER_11K"},examples:["#ForYou","#Viral","Niche tags"]},{ingredient:"duet_stitch",label:"Duet/Stitch",icon:"🔄",description:"Collaborative features",with:{views:"PLACEHOLDER_934K",shares:"PLACEHOLDER_67K"},without:{views:"PLACEHOLDER_445K",shares:"PLACEHOLDER_23K"},examples:["React videos","Challenges"]},{ingredient:"posting_time_bucket",label:"Timing",icon:"🕐",description:"Peak hours posting",with:{views:"PLACEHOLDER_789K",shares:"PLACEHOLDER_56K"},without:{views:"PLACEHOLDER_345K",shares:"PLACEHOLDER_19K"},examples:["6-10 AM","7-11 PM"]},{ingredient:"caption_emotion_family",label:"Emotional Hook",icon:"💭",description:"Caption sentiment",with:{views:"PLACEHOLDER_823K",shares:"PLACEHOLDER_61K"},without:{views:"PLACEHOLDER_412K",shares:"PLACEHOLDER_28K"},examples:["Joy","Surprise","Nostalgia"]},{ingredient:"creator_reach",label:"Creator Base",icon:"👥",description:"Follower count impact",with:{views:"PLACEHOLDER_1.5M",shares:"PLACEHOLDER_112K"},without:{views:"PLACEHOLDER_89K",shares:"PLACEHOLDER_4K"},examples:["Micro-influencer","Rising creator"]},{ingredient:"effects_used",label:"Visual Effects",icon:"✨",description:"Filters and transitions",with:{views:"PLACEHOLDER_934K",shares:"PLACEHOLDER_72K"},without:{views:"PLACEHOLDER_567K",shares:"PLACEHOLDER_31K"},examples:["Green screen","Time warp"]},{ingredient:"sound_age",label:"Sound Freshness",icon:"📈",description:"Timing the trend wave",with:{views:"PLACEHOLDER_1.1M",shares:"PLACEHOLDER_95K"},without:{views:"PLACEHOLDER_234K",shares:"PLACEHOLDER_15K"},examples:["First 48 hours","Peak week"]}]}}mount(){this.mounted||(this.render(),this.mounted=!0,this.emit(N.ENTER_COMPLETE))}unmount(){this.mounted&&(this.container.innerHTML="",this.mounted=!1,this.emit(N.EXIT_COMPLETE))}destroy(){this.unmount(),this.data=null,this.state=null,this.events.clear()}update(t,n={}){switch(this.state.currentStep=t,t){case 11:this.highlightKeyIngredients();break;case 12:this.showQuizPrompt();break}this.emit(N.UPDATE_COMPLETE)}resize(t,n){this.options.width=t,this.options.height=n,this.mounted&&this.render(),this.emit(N.RESIZE)}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},this.emit(N.STATE_CHANGE)}isDataReady(){return this.data!==null}render(){if(!this.data)return;this.container.innerHTML="";const t=document.createElement("div");t.className="ingredients-grid",t.setAttribute("role","list"),t.setAttribute("aria-label","Viral recipe ingredients"),this.data.forEach((i,r)=>{const s=this.createCard(i,r);t.appendChild(s)}),this.container.appendChild(t);const n=this.createQuizModal();this.container.appendChild(n),this.options.reducedMotion||t.querySelectorAll(".ingredient-card").forEach((r,s)=>{r.style.opacity="0",r.style.transform="translateY(20px)",setTimeout(()=>{r.style.transition="all 400ms cubic-bezier(0.4, 0.0, 0.2, 1)",r.style.opacity="1",r.style.transform="translateY(0)"},s*50)})}createCard(t,n){const i=document.createElement("div");return i.className="ingredient-card",i.setAttribute("role","listitem"),i.setAttribute("tabindex","0"),i.setAttribute("data-ingredient",t.ingredient),i.setAttribute("aria-label",`${t.label}: ${t.description}`),i.innerHTML=`
      <div class="card-icon">${t.icon}</div>
      <h3 class="card-title">${t.label}</h3>
      <p class="card-description">${t.description}</p>
      <button class="card-action" aria-label="Test ${t.label} impact">
        <span>Test Impact</span>
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
          <path d="M9 18l6-6-6-6" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    `,i.addEventListener("click",()=>this.openQuiz(t)),i.addEventListener("keydown",r=>{(r.key==="Enter"||r.key===" ")&&(r.preventDefault(),this.openQuiz(t))}),i}createQuizModal(){const t=document.createElement("div");return t.className="quiz-modal",t.setAttribute("role","dialog"),t.setAttribute("aria-hidden","true"),t.setAttribute("aria-labelledby","quiz-title"),t.setAttribute("aria-describedby","quiz-description"),t.innerHTML=`
      <div class="quiz-content">
        <button class="quiz-close" aria-label="Close quiz">×</button>
        <h2 id="quiz-title">Test Your Intuition</h2>
        <p id="quiz-description">Compare performance with and without this ingredient</p>

        <div class="quiz-ingredient-info">
          <span class="quiz-icon"></span>
          <h3 class="quiz-ingredient-name"></h3>
        </div>

        <div class="quiz-comparison">
          <div class="comparison-with">
            <h4>With <span class="ingredient-name"></span></h4>
            <div class="metric-bars">
              <div class="metric-row">
                <span class="metric-label">Views</span>
                <div class="metric-bar">
                  <div class="bar-fill with-fill" style="width: 75%"></div>
                  <span class="metric-value"></span>
                </div>
              </div>
              <div class="metric-row">
                <span class="metric-label">Shares</span>
                <div class="metric-bar">
                  <div class="bar-fill with-fill" style="width: 70%"></div>
                  <span class="metric-value"></span>
                </div>
              </div>
            </div>
            <div class="example-thumbnails">
              <div class="thumbnail-placeholder"></div>
              <div class="thumbnail-placeholder"></div>
            </div>
          </div>

          <div class="comparison-without">
            <h4>Without <span class="ingredient-name"></span></h4>
            <div class="metric-bars">
              <div class="metric-row">
                <span class="metric-label">Views</span>
                <div class="metric-bar">
                  <div class="bar-fill without-fill" style="width: 35%"></div>
                  <span class="metric-value"></span>
                </div>
              </div>
              <div class="metric-row">
                <span class="metric-label">Shares</span>
                <div class="metric-bar">
                  <div class="bar-fill without-fill" style="width: 30%"></div>
                  <span class="metric-value"></span>
                </div>
              </div>
            </div>
            <div class="example-thumbnails">
              <div class="thumbnail-placeholder"></div>
              <div class="thumbnail-placeholder"></div>
            </div>
          </div>
        </div>

        <div class="quiz-examples">
          <h4>Pro Tips</h4>
          <ul class="example-list"></ul>
        </div>

        <div class="quiz-actions">
          <button class="btn-secondary quiz-guess">Make Your Guess First</button>
          <button class="btn-primary quiz-reveal">Reveal Impact</button>
        </div>
      </div>
    `,t.querySelector(".quiz-close").addEventListener("click",()=>this.closeQuiz()),t.querySelector(".quiz-guess").addEventListener("click",()=>this.recordGuess()),t.querySelector(".quiz-reveal").addEventListener("click",()=>this.revealAnswer()),t.addEventListener("click",s=>{s.target===t&&this.closeQuiz()}),document.addEventListener("keydown",s=>{s.key==="Escape"&&this.state.quizActive&&this.closeQuiz()}),t}openQuiz(t){this.state.selectedIngredient=t,this.state.quizActive=!0;const n=this.container.querySelector(".quiz-modal");if(!n)return;n.querySelector(".quiz-icon").textContent=t.icon,n.querySelector(".quiz-ingredient-name").textContent=t.label,n.querySelectorAll(".ingredient-name").forEach(o=>{o.textContent=t.label});const i=n.querySelector(".comparison-with");i.querySelector(".metric-row:nth-child(1) .metric-value").textContent=t.with.views,i.querySelector(".metric-row:nth-child(2) .metric-value").textContent=t.with.shares;const r=n.querySelector(".comparison-without");r.querySelector(".metric-row:nth-child(1) .metric-value").textContent=t.without.views,r.querySelector(".metric-row:nth-child(2) .metric-value").textContent=t.without.shares;const s=n.querySelector(".example-list");if(s.innerHTML=t.examples.map(o=>`<li>${o}</li>`).join(""),n.setAttribute("aria-hidden","false"),n.classList.add("active"),!this.options.reducedMotion){const o=n.querySelector(".quiz-content");o.style.opacity="0",o.style.transform="scale(0.95)",setTimeout(()=>{o.style.transition="all 400ms cubic-bezier(0.4, 0.0, 0.2, 1)",o.style.opacity="1",o.style.transform="scale(1)"},10)}n.querySelector(".quiz-close").focus(),this.emit("quizOpened",{ingredient:t.label})}closeQuiz(){const t=this.container.querySelector(".quiz-modal");if(t){if(this.state.quizActive=!1,this.options.reducedMotion)t.classList.remove("active"),t.setAttribute("aria-hidden","true");else{const n=t.querySelector(".quiz-content");n.style.transition="all 300ms cubic-bezier(0.4, 0.0, 0.2, 1)",n.style.opacity="0",n.style.transform="scale(0.95)",setTimeout(()=>{t.classList.remove("active"),t.setAttribute("aria-hidden","true")},300)}if(this.state.selectedIngredient){const n=this.container.querySelector(`[data-ingredient="${this.state.selectedIngredient.ingredient}"]`);n&&n.focus()}this.emit("quizClosed")}}recordGuess(){if(this.state.selectedIngredient){this.state.userGuesses[this.state.selectedIngredient.ingredient]=Date.now(),localStorage.setItem("tiktok-tides-guesses",JSON.stringify(this.state.userGuesses));const t=this.container.querySelector(".quiz-guess");t.textContent="Guess Recorded ✓",t.disabled=!0}}revealAnswer(){var i;this.container.querySelectorAll(".bar-fill").forEach(r=>{r.style.transition="width 800ms cubic-bezier(0.4, 0.0, 0.2, 1)"}),this.container.querySelector(".comparison-with").classList.add("winner"),this.emit("answerRevealed",{ingredient:(i=this.state.selectedIngredient)==null?void 0:i.label})}highlightKeyIngredients(){["sound_reuse","video_length_bucket","caption_emotion_family"].forEach(n=>{const i=this.container.querySelector(`[data-ingredient="${n}"]`);i&&i.classList.add("highlighted")})}showQuizPrompt(){const t=document.createElement("div");t.className="quiz-prompt",t.innerHTML=`
      <p>🎯 Ready to build your viral recipe? Click any ingredient to test your intuition!</p>
    `,this.container.insertBefore(t,this.container.firstChild),setTimeout(()=>{t.style.opacity="0",setTimeout(()=>t.remove(),400)},5e3)}}function zt(e,t){return e==null||t==null?NaN:e<t?-1:e>t?1:e>=t?0:NaN}function jn(e,t){return e==null||t==null?NaN:t<e?-1:t>e?1:t>=e?0:NaN}function sn(e){let t,n,i;e.length!==2?(t=zt,n=(a,c)=>zt(e(a),c),i=(a,c)=>e(a)-c):(t=e===zt||e===jn?e:Qn,n=e,i=e);function r(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{const d=l+u>>>1;n(a[d],c)<0?l=d+1:u=d}while(l<u)}return l}function s(a,c,l=0,u=a.length){if(l<u){if(t(c,c)!==0)return u;do{const d=l+u>>>1;n(a[d],c)<=0?l=d+1:u=d}while(l<u)}return l}function o(a,c,l=0,u=a.length){const d=r(a,c,l,u-1);return d>l&&i(a[d-1],c)>-i(a[d],c)?d-1:d}return{left:r,center:o,right:s}}function Qn(){return 0}function Jn(e){return e===null?NaN:+e}const ti=sn(zt),ei=ti.right;sn(Jn).center;const ni=Math.sqrt(50),ii=Math.sqrt(10),ri=Math.sqrt(2);function Gt(e,t,n){const i=(t-e)/Math.max(0,n),r=Math.floor(Math.log10(i)),s=i/Math.pow(10,r),o=s>=ni?10:s>=ii?5:s>=ri?2:1;let a,c,l;return r<0?(l=Math.pow(10,-r)/o,a=Math.round(e*l),c=Math.round(t*l),a/l<e&&++a,c/l>t&&--c,l=-l):(l=Math.pow(10,r)*o,a=Math.round(e/l),c=Math.round(t/l),a*l<e&&++a,c*l>t&&--c),c<a&&.5<=n&&n<2?Gt(e,t,n*2):[a,c,l]}function si(e,t,n){if(t=+t,e=+e,n=+n,!(n>0))return[];if(e===t)return[e];const i=t<e,[r,s,o]=i?Gt(t,e,n):Gt(e,t,n);if(!(s>=r))return[];const a=s-r+1,c=new Array(a);if(i)if(o<0)for(let l=0;l<a;++l)c[l]=(s-l)/-o;else for(let l=0;l<a;++l)c[l]=(s-l)*o;else if(o<0)for(let l=0;l<a;++l)c[l]=(r+l)/-o;else for(let l=0;l<a;++l)c[l]=(r+l)*o;return c}function ae(e,t,n){return t=+t,e=+e,n=+n,Gt(e,t,n)[2]}function oi(e,t,n){t=+t,e=+e,n=+n;const i=t<e,r=i?ae(t,e,n):ae(e,t,n);return(i?-1:1)*(r<0?1/-r:r)}var ai={value:()=>{}};function on(){for(var e=0,t=arguments.length,n={},i;e<t;++e){if(!(i=arguments[e]+"")||i in n||/[\s.]/.test(i))throw new Error("illegal type: "+i);n[i]=[]}return new Ft(n)}function Ft(e){this._=e}function ci(e,t){return e.trim().split(/^|\s+/).map(function(n){var i="",r=n.indexOf(".");if(r>=0&&(i=n.slice(r+1),n=n.slice(0,r)),n&&!t.hasOwnProperty(n))throw new Error("unknown type: "+n);return{type:n,name:i}})}Ft.prototype=on.prototype={constructor:Ft,on:function(e,t){var n=this._,i=ci(e+"",n),r,s=-1,o=i.length;if(arguments.length<2){for(;++s<o;)if((r=(e=i[s]).type)&&(r=li(n[r],e.name)))return r;return}if(t!=null&&typeof t!="function")throw new Error("invalid callback: "+t);for(;++s<o;)if(r=(e=i[s]).type)n[r]=Me(n[r],e.name,t);else if(t==null)for(r in n)n[r]=Me(n[r],e.name,null);return this},copy:function(){var e={},t=this._;for(var n in t)e[n]=t[n].slice();return new Ft(e)},call:function(e,t){if((r=arguments.length-2)>0)for(var n=new Array(r),i=0,r,s;i<r;++i)n[i]=arguments[i+2];if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(s=this._[e],i=0,r=s.length;i<r;++i)s[i].value.apply(t,n)},apply:function(e,t,n){if(!this._.hasOwnProperty(e))throw new Error("unknown type: "+e);for(var i=this._[e],r=0,s=i.length;r<s;++r)i[r].value.apply(t,n)}};function li(e,t){for(var n=0,i=e.length,r;n<i;++n)if((r=e[n]).name===t)return r.value}function Me(e,t,n){for(var i=0,r=e.length;i<r;++i)if(e[i].name===t){e[i]=ai,e=e.slice(0,i).concat(e.slice(i+1));break}return n!=null&&e.push({name:t,value:n}),e}var ce="http://www.w3.org/1999/xhtml";const $e={svg:"http://www.w3.org/2000/svg",xhtml:ce,xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"};function Qt(e){var t=e+="",n=t.indexOf(":");return n>=0&&(t=e.slice(0,n))!=="xmlns"&&(e=e.slice(n+1)),$e.hasOwnProperty(t)?{space:$e[t],local:e}:e}function ui(e){return function(){var t=this.ownerDocument,n=this.namespaceURI;return n===ce&&t.documentElement.namespaceURI===ce?t.createElement(e):t.createElementNS(n,e)}}function di(e){return function(){return this.ownerDocument.createElementNS(e.space,e.local)}}function an(e){var t=Qt(e);return(t.local?di:ui)(t)}function hi(){}function be(e){return e==null?hi:function(){return this.querySelector(e)}}function fi(e){typeof e!="function"&&(e=be(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=new Array(o),c,l,u=0;u<o;++u)(c=s[u])&&(l=e.call(c,c.__data__,u,s))&&("__data__"in c&&(l.__data__=c.__data__),a[u]=l);return new Q(i,this._parents)}function pi(e){return e==null?[]:Array.isArray(e)?e:Array.from(e)}function mi(){return[]}function cn(e){return e==null?mi:function(){return this.querySelectorAll(e)}}function gi(e){return function(){return pi(e.apply(this,arguments))}}function yi(e){typeof e=="function"?e=gi(e):e=cn(e);for(var t=this._groups,n=t.length,i=[],r=[],s=0;s<n;++s)for(var o=t[s],a=o.length,c,l=0;l<a;++l)(c=o[l])&&(i.push(e.call(c,c.__data__,l,o)),r.push(c));return new Q(i,r)}function ln(e){return function(){return this.matches(e)}}function un(e){return function(t){return t.matches(e)}}var bi=Array.prototype.find;function vi(e){return function(){return bi.call(this.children,e)}}function wi(){return this.firstElementChild}function Ai(e){return this.select(e==null?wi:vi(typeof e=="function"?e:un(e)))}var xi=Array.prototype.filter;function Si(){return Array.from(this.children)}function Ei(e){return function(){return xi.call(this.children,e)}}function _i(e){return this.selectAll(e==null?Si:Ei(typeof e=="function"?e:un(e)))}function ki(e){typeof e!="function"&&(e=ln(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],c,l=0;l<o;++l)(c=s[l])&&e.call(c,c.__data__,l,s)&&a.push(c);return new Q(i,this._parents)}function dn(e){return new Array(e.length)}function Ci(){return new Q(this._enter||this._groups.map(dn),this._parents)}function Bt(e,t){this.ownerDocument=e.ownerDocument,this.namespaceURI=e.namespaceURI,this._next=null,this._parent=e,this.__data__=t}Bt.prototype={constructor:Bt,appendChild:function(e){return this._parent.insertBefore(e,this._next)},insertBefore:function(e,t){return this._parent.insertBefore(e,t)},querySelector:function(e){return this._parent.querySelector(e)},querySelectorAll:function(e){return this._parent.querySelectorAll(e)}};function Mi(e){return function(){return e}}function $i(e,t,n,i,r,s){for(var o=0,a,c=t.length,l=s.length;o<l;++o)(a=t[o])?(a.__data__=s[o],i[o]=a):n[o]=new Bt(e,s[o]);for(;o<c;++o)(a=t[o])&&(r[o]=a)}function Ti(e,t,n,i,r,s,o){var a,c,l=new Map,u=t.length,d=s.length,h=new Array(u),p;for(a=0;a<u;++a)(c=t[a])&&(h[a]=p=o.call(c,c.__data__,a,t)+"",l.has(p)?r[a]=c:l.set(p,c));for(a=0;a<d;++a)p=o.call(e,s[a],a,s)+"",(c=l.get(p))?(i[a]=c,c.__data__=s[a],l.delete(p)):n[a]=new Bt(e,s[a]);for(a=0;a<u;++a)(c=t[a])&&l.get(h[a])===c&&(r[a]=c)}function Ni(e){return e.__data__}function Li(e,t){if(!arguments.length)return Array.from(this,Ni);var n=t?Ti:$i,i=this._parents,r=this._groups;typeof e!="function"&&(e=Mi(e));for(var s=r.length,o=new Array(s),a=new Array(s),c=new Array(s),l=0;l<s;++l){var u=i[l],d=r[l],h=d.length,p=Ri(e.call(u,u&&u.__data__,l,i)),m=p.length,g=a[l]=new Array(m),b=o[l]=new Array(m),f=c[l]=new Array(h);n(u,d,g,b,f,p,t);for(var y=0,v=0,M,w;y<m;++y)if(M=g[y]){for(y>=v&&(v=y+1);!(w=b[v])&&++v<m;);M._next=w||null}}return o=new Q(o,i),o._enter=a,o._exit=c,o}function Ri(e){return typeof e=="object"&&"length"in e?e:Array.from(e)}function Ii(){return new Q(this._exit||this._groups.map(dn),this._parents)}function qi(e,t,n){var i=this.enter(),r=this,s=this.exit();return typeof e=="function"?(i=e(i),i&&(i=i.selection())):i=i.append(e+""),t!=null&&(r=t(r),r&&(r=r.selection())),n==null?s.remove():n(s),i&&r?i.merge(r).order():r}function Di(e){for(var t=e.selection?e.selection():e,n=this._groups,i=t._groups,r=n.length,s=i.length,o=Math.min(r,s),a=new Array(r),c=0;c<o;++c)for(var l=n[c],u=i[c],d=l.length,h=a[c]=new Array(d),p,m=0;m<d;++m)(p=l[m]||u[m])&&(h[m]=p);for(;c<r;++c)a[c]=n[c];return new Q(a,this._parents)}function Pi(){for(var e=this._groups,t=-1,n=e.length;++t<n;)for(var i=e[t],r=i.length-1,s=i[r],o;--r>=0;)(o=i[r])&&(s&&o.compareDocumentPosition(s)^4&&s.parentNode.insertBefore(o,s),s=o);return this}function zi(e){e||(e=Fi);function t(d,h){return d&&h?e(d.__data__,h.__data__):!d-!h}for(var n=this._groups,i=n.length,r=new Array(i),s=0;s<i;++s){for(var o=n[s],a=o.length,c=r[s]=new Array(a),l,u=0;u<a;++u)(l=o[u])&&(c[u]=l);c.sort(t)}return new Q(r,this._parents).order()}function Fi(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}function Hi(){var e=arguments[0];return arguments[0]=this,e.apply(null,arguments),this}function Oi(){return Array.from(this)}function Gi(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length;r<s;++r){var o=i[r];if(o)return o}return null}function Bi(){let e=0;for(const t of this)++e;return e}function Yi(){return!this.node()}function Vi(e){for(var t=this._groups,n=0,i=t.length;n<i;++n)for(var r=t[n],s=0,o=r.length,a;s<o;++s)(a=r[s])&&e.call(a,a.__data__,s,r);return this}function Xi(e){return function(){this.removeAttribute(e)}}function Ui(e){return function(){this.removeAttributeNS(e.space,e.local)}}function Ki(e,t){return function(){this.setAttribute(e,t)}}function Wi(e,t){return function(){this.setAttributeNS(e.space,e.local,t)}}function Zi(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttribute(e):this.setAttribute(e,n)}}function ji(e,t){return function(){var n=t.apply(this,arguments);n==null?this.removeAttributeNS(e.space,e.local):this.setAttributeNS(e.space,e.local,n)}}function Qi(e,t){var n=Qt(e);if(arguments.length<2){var i=this.node();return n.local?i.getAttributeNS(n.space,n.local):i.getAttribute(n)}return this.each((t==null?n.local?Ui:Xi:typeof t=="function"?n.local?ji:Zi:n.local?Wi:Ki)(n,t))}function hn(e){return e.ownerDocument&&e.ownerDocument.defaultView||e.document&&e||e.defaultView}function Ji(e){return function(){this.style.removeProperty(e)}}function tr(e,t,n){return function(){this.style.setProperty(e,t,n)}}function er(e,t,n){return function(){var i=t.apply(this,arguments);i==null?this.style.removeProperty(e):this.style.setProperty(e,i,n)}}function nr(e,t,n){return arguments.length>1?this.each((t==null?Ji:typeof t=="function"?er:tr)(e,t,n??"")):vt(this.node(),e)}function vt(e,t){return e.style.getPropertyValue(t)||hn(e).getComputedStyle(e,null).getPropertyValue(t)}function ir(e){return function(){delete this[e]}}function rr(e,t){return function(){this[e]=t}}function sr(e,t){return function(){var n=t.apply(this,arguments);n==null?delete this[e]:this[e]=n}}function or(e,t){return arguments.length>1?this.each((t==null?ir:typeof t=="function"?sr:rr)(e,t)):this.node()[e]}function fn(e){return e.trim().split(/^|\s+/)}function ve(e){return e.classList||new pn(e)}function pn(e){this._node=e,this._names=fn(e.getAttribute("class")||"")}pn.prototype={add:function(e){var t=this._names.indexOf(e);t<0&&(this._names.push(e),this._node.setAttribute("class",this._names.join(" ")))},remove:function(e){var t=this._names.indexOf(e);t>=0&&(this._names.splice(t,1),this._node.setAttribute("class",this._names.join(" ")))},contains:function(e){return this._names.indexOf(e)>=0}};function mn(e,t){for(var n=ve(e),i=-1,r=t.length;++i<r;)n.add(t[i])}function gn(e,t){for(var n=ve(e),i=-1,r=t.length;++i<r;)n.remove(t[i])}function ar(e){return function(){mn(this,e)}}function cr(e){return function(){gn(this,e)}}function lr(e,t){return function(){(t.apply(this,arguments)?mn:gn)(this,e)}}function ur(e,t){var n=fn(e+"");if(arguments.length<2){for(var i=ve(this.node()),r=-1,s=n.length;++r<s;)if(!i.contains(n[r]))return!1;return!0}return this.each((typeof t=="function"?lr:t?ar:cr)(n,t))}function dr(){this.textContent=""}function hr(e){return function(){this.textContent=e}}function fr(e){return function(){var t=e.apply(this,arguments);this.textContent=t??""}}function pr(e){return arguments.length?this.each(e==null?dr:(typeof e=="function"?fr:hr)(e)):this.node().textContent}function mr(){this.innerHTML=""}function gr(e){return function(){this.innerHTML=e}}function yr(e){return function(){var t=e.apply(this,arguments);this.innerHTML=t??""}}function br(e){return arguments.length?this.each(e==null?mr:(typeof e=="function"?yr:gr)(e)):this.node().innerHTML}function vr(){this.nextSibling&&this.parentNode.appendChild(this)}function wr(){return this.each(vr)}function Ar(){this.previousSibling&&this.parentNode.insertBefore(this,this.parentNode.firstChild)}function xr(){return this.each(Ar)}function Sr(e){var t=typeof e=="function"?e:an(e);return this.select(function(){return this.appendChild(t.apply(this,arguments))})}function Er(){return null}function _r(e,t){var n=typeof e=="function"?e:an(e),i=t==null?Er:typeof t=="function"?t:be(t);return this.select(function(){return this.insertBefore(n.apply(this,arguments),i.apply(this,arguments)||null)})}function kr(){var e=this.parentNode;e&&e.removeChild(this)}function Cr(){return this.each(kr)}function Mr(){var e=this.cloneNode(!1),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function $r(){var e=this.cloneNode(!0),t=this.parentNode;return t?t.insertBefore(e,this.nextSibling):e}function Tr(e){return this.select(e?$r:Mr)}function Nr(e){return arguments.length?this.property("__data__",e):this.node().__data__}function Lr(e){return function(t){e.call(this,t,this.__data__)}}function Rr(e){return e.trim().split(/^|\s+/).map(function(t){var n="",i=t.indexOf(".");return i>=0&&(n=t.slice(i+1),t=t.slice(0,i)),{type:t,name:n}})}function Ir(e){return function(){var t=this.__on;if(t){for(var n=0,i=-1,r=t.length,s;n<r;++n)s=t[n],(!e.type||s.type===e.type)&&s.name===e.name?this.removeEventListener(s.type,s.listener,s.options):t[++i]=s;++i?t.length=i:delete this.__on}}}function qr(e,t,n){return function(){var i=this.__on,r,s=Lr(t);if(i){for(var o=0,a=i.length;o<a;++o)if((r=i[o]).type===e.type&&r.name===e.name){this.removeEventListener(r.type,r.listener,r.options),this.addEventListener(r.type,r.listener=s,r.options=n),r.value=t;return}}this.addEventListener(e.type,s,n),r={type:e.type,name:e.name,value:t,listener:s,options:n},i?i.push(r):this.__on=[r]}}function Dr(e,t,n){var i=Rr(e+""),r,s=i.length,o;if(arguments.length<2){var a=this.node().__on;if(a){for(var c=0,l=a.length,u;c<l;++c)for(r=0,u=a[c];r<s;++r)if((o=i[r]).type===u.type&&o.name===u.name)return u.value}return}for(a=t?qr:Ir,r=0;r<s;++r)this.each(a(i[r],t,n));return this}function yn(e,t,n){var i=hn(e),r=i.CustomEvent;typeof r=="function"?r=new r(t,n):(r=i.document.createEvent("Event"),n?(r.initEvent(t,n.bubbles,n.cancelable),r.detail=n.detail):r.initEvent(t,!1,!1)),e.dispatchEvent(r)}function Pr(e,t){return function(){return yn(this,e,t)}}function zr(e,t){return function(){return yn(this,e,t.apply(this,arguments))}}function Fr(e,t){return this.each((typeof t=="function"?zr:Pr)(e,t))}function*Hr(){for(var e=this._groups,t=0,n=e.length;t<n;++t)for(var i=e[t],r=0,s=i.length,o;r<s;++r)(o=i[r])&&(yield o)}var bn=[null];function Q(e,t){this._groups=e,this._parents=t}function Tt(){return new Q([[document.documentElement]],bn)}function Or(){return this}Q.prototype=Tt.prototype={constructor:Q,select:fi,selectAll:yi,selectChild:Ai,selectChildren:_i,filter:ki,data:Li,enter:Ci,exit:Ii,join:qi,merge:Di,selection:Or,order:Pi,sort:zi,call:Hi,nodes:Oi,node:Gi,size:Bi,empty:Yi,each:Vi,attr:Qi,style:nr,property:or,classed:ur,text:pr,html:br,raise:wr,lower:xr,append:Sr,insert:_r,remove:Cr,clone:Tr,datum:Nr,on:Dr,dispatch:Fr,[Symbol.iterator]:Hr};function Te(e){return typeof e=="string"?new Q([[document.querySelector(e)]],[document.documentElement]):new Q([[e]],bn)}function we(e,t,n){e.prototype=t.prototype=n,n.constructor=e}function vn(e,t){var n=Object.create(e.prototype);for(var i in t)n[i]=t[i];return n}function Nt(){}var Ct=.7,Yt=1/Ct,bt="\\s*([+-]?\\d+)\\s*",Mt="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)\\s*",it="\\s*([+-]?(?:\\d*\\.)?\\d+(?:[eE][+-]?\\d+)?)%\\s*",Gr=/^#([0-9a-f]{3,8})$/,Br=new RegExp(`^rgb\\(${bt},${bt},${bt}\\)$`),Yr=new RegExp(`^rgb\\(${it},${it},${it}\\)$`),Vr=new RegExp(`^rgba\\(${bt},${bt},${bt},${Mt}\\)$`),Xr=new RegExp(`^rgba\\(${it},${it},${it},${Mt}\\)$`),Ur=new RegExp(`^hsl\\(${Mt},${it},${it}\\)$`),Kr=new RegExp(`^hsla\\(${Mt},${it},${it},${Mt}\\)$`),Ne={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074};we(Nt,ht,{copy(e){return Object.assign(new this.constructor,this,e)},displayable(){return this.rgb().displayable()},hex:Le,formatHex:Le,formatHex8:Wr,formatHsl:Zr,formatRgb:Re,toString:Re});function Le(){return this.rgb().formatHex()}function Wr(){return this.rgb().formatHex8()}function Zr(){return wn(this).formatHsl()}function Re(){return this.rgb().formatRgb()}function ht(e){var t,n;return e=(e+"").trim().toLowerCase(),(t=Gr.exec(e))?(n=t[1].length,t=parseInt(t[1],16),n===6?Ie(t):n===3?new j(t>>8&15|t>>4&240,t>>4&15|t&240,(t&15)<<4|t&15,1):n===8?It(t>>24&255,t>>16&255,t>>8&255,(t&255)/255):n===4?It(t>>12&15|t>>8&240,t>>8&15|t>>4&240,t>>4&15|t&240,((t&15)<<4|t&15)/255):null):(t=Br.exec(e))?new j(t[1],t[2],t[3],1):(t=Yr.exec(e))?new j(t[1]*255/100,t[2]*255/100,t[3]*255/100,1):(t=Vr.exec(e))?It(t[1],t[2],t[3],t[4]):(t=Xr.exec(e))?It(t[1]*255/100,t[2]*255/100,t[3]*255/100,t[4]):(t=Ur.exec(e))?Pe(t[1],t[2]/100,t[3]/100,1):(t=Kr.exec(e))?Pe(t[1],t[2]/100,t[3]/100,t[4]):Ne.hasOwnProperty(e)?Ie(Ne[e]):e==="transparent"?new j(NaN,NaN,NaN,0):null}function Ie(e){return new j(e>>16&255,e>>8&255,e&255,1)}function It(e,t,n,i){return i<=0&&(e=t=n=NaN),new j(e,t,n,i)}function jr(e){return e instanceof Nt||(e=ht(e)),e?(e=e.rgb(),new j(e.r,e.g,e.b,e.opacity)):new j}function le(e,t,n,i){return arguments.length===1?jr(e):new j(e,t,n,i??1)}function j(e,t,n,i){this.r=+e,this.g=+t,this.b=+n,this.opacity=+i}we(j,le,vn(Nt,{brighter(e){return e=e==null?Yt:Math.pow(Yt,e),new j(this.r*e,this.g*e,this.b*e,this.opacity)},darker(e){return e=e==null?Ct:Math.pow(Ct,e),new j(this.r*e,this.g*e,this.b*e,this.opacity)},rgb(){return this},clamp(){return new j(dt(this.r),dt(this.g),dt(this.b),Vt(this.opacity))},displayable(){return-.5<=this.r&&this.r<255.5&&-.5<=this.g&&this.g<255.5&&-.5<=this.b&&this.b<255.5&&0<=this.opacity&&this.opacity<=1},hex:qe,formatHex:qe,formatHex8:Qr,formatRgb:De,toString:De}));function qe(){return`#${ut(this.r)}${ut(this.g)}${ut(this.b)}`}function Qr(){return`#${ut(this.r)}${ut(this.g)}${ut(this.b)}${ut((isNaN(this.opacity)?1:this.opacity)*255)}`}function De(){const e=Vt(this.opacity);return`${e===1?"rgb(":"rgba("}${dt(this.r)}, ${dt(this.g)}, ${dt(this.b)}${e===1?")":`, ${e})`}`}function Vt(e){return isNaN(e)?1:Math.max(0,Math.min(1,e))}function dt(e){return Math.max(0,Math.min(255,Math.round(e)||0))}function ut(e){return e=dt(e),(e<16?"0":"")+e.toString(16)}function Pe(e,t,n,i){return i<=0?e=t=n=NaN:n<=0||n>=1?e=t=NaN:t<=0&&(e=NaN),new et(e,t,n,i)}function wn(e){if(e instanceof et)return new et(e.h,e.s,e.l,e.opacity);if(e instanceof Nt||(e=ht(e)),!e)return new et;if(e instanceof et)return e;e=e.rgb();var t=e.r/255,n=e.g/255,i=e.b/255,r=Math.min(t,n,i),s=Math.max(t,n,i),o=NaN,a=s-r,c=(s+r)/2;return a?(t===s?o=(n-i)/a+(n<i)*6:n===s?o=(i-t)/a+2:o=(t-n)/a+4,a/=c<.5?s+r:2-s-r,o*=60):a=c>0&&c<1?0:o,new et(o,a,c,e.opacity)}function Jr(e,t,n,i){return arguments.length===1?wn(e):new et(e,t,n,i??1)}function et(e,t,n,i){this.h=+e,this.s=+t,this.l=+n,this.opacity=+i}we(et,Jr,vn(Nt,{brighter(e){return e=e==null?Yt:Math.pow(Yt,e),new et(this.h,this.s,this.l*e,this.opacity)},darker(e){return e=e==null?Ct:Math.pow(Ct,e),new et(this.h,this.s,this.l*e,this.opacity)},rgb(){var e=this.h%360+(this.h<0)*360,t=isNaN(e)||isNaN(this.s)?0:this.s,n=this.l,i=n+(n<.5?n:1-n)*t,r=2*n-i;return new j(ee(e>=240?e-240:e+120,r,i),ee(e,r,i),ee(e<120?e+240:e-120,r,i),this.opacity)},clamp(){return new et(ze(this.h),qt(this.s),qt(this.l),Vt(this.opacity))},displayable(){return(0<=this.s&&this.s<=1||isNaN(this.s))&&0<=this.l&&this.l<=1&&0<=this.opacity&&this.opacity<=1},formatHsl(){const e=Vt(this.opacity);return`${e===1?"hsl(":"hsla("}${ze(this.h)}, ${qt(this.s)*100}%, ${qt(this.l)*100}%${e===1?")":`, ${e})`}`}}));function ze(e){return e=(e||0)%360,e<0?e+360:e}function qt(e){return Math.max(0,Math.min(1,e||0))}function ee(e,t,n){return(e<60?t+(n-t)*e/60:e<180?n:e<240?t+(n-t)*(240-e)/60:t)*255}const Ae=e=>()=>e;function ts(e,t){return function(n){return e+n*t}}function es(e,t,n){return e=Math.pow(e,n),t=Math.pow(t,n)-e,n=1/n,function(i){return Math.pow(e+i*t,n)}}function ns(e){return(e=+e)==1?An:function(t,n){return n-t?es(t,n,e):Ae(isNaN(t)?n:t)}}function An(e,t){var n=t-e;return n?ts(e,n):Ae(isNaN(e)?t:e)}const Xt=function e(t){var n=ns(t);function i(r,s){var o=n((r=le(r)).r,(s=le(s)).r),a=n(r.g,s.g),c=n(r.b,s.b),l=An(r.opacity,s.opacity);return function(u){return r.r=o(u),r.g=a(u),r.b=c(u),r.opacity=l(u),r+""}}return i.gamma=e,i}(1);function is(e,t){t||(t=[]);var n=e?Math.min(t.length,e.length):0,i=t.slice(),r;return function(s){for(r=0;r<n;++r)i[r]=e[r]*(1-s)+t[r]*s;return i}}function rs(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function ss(e,t){var n=t?t.length:0,i=e?Math.min(n,e.length):0,r=new Array(i),s=new Array(n),o;for(o=0;o<i;++o)r[o]=xe(e[o],t[o]);for(;o<n;++o)s[o]=t[o];return function(a){for(o=0;o<i;++o)s[o]=r[o](a);return s}}function os(e,t){var n=new Date;return e=+e,t=+t,function(i){return n.setTime(e*(1-i)+t*i),n}}function tt(e,t){return e=+e,t=+t,function(n){return e*(1-n)+t*n}}function as(e,t){var n={},i={},r;(e===null||typeof e!="object")&&(e={}),(t===null||typeof t!="object")&&(t={});for(r in t)r in e?n[r]=xe(e[r],t[r]):i[r]=t[r];return function(s){for(r in n)i[r]=n[r](s);return i}}var ue=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,ne=new RegExp(ue.source,"g");function cs(e){return function(){return e}}function ls(e){return function(t){return e(t)+""}}function xn(e,t){var n=ue.lastIndex=ne.lastIndex=0,i,r,s,o=-1,a=[],c=[];for(e=e+"",t=t+"";(i=ue.exec(e))&&(r=ne.exec(t));)(s=r.index)>n&&(s=t.slice(n,s),a[o]?a[o]+=s:a[++o]=s),(i=i[0])===(r=r[0])?a[o]?a[o]+=r:a[++o]=r:(a[++o]=null,c.push({i:o,x:tt(i,r)})),n=ne.lastIndex;return n<t.length&&(s=t.slice(n),a[o]?a[o]+=s:a[++o]=s),a.length<2?c[0]?ls(c[0].x):cs(t):(t=c.length,function(l){for(var u=0,d;u<t;++u)a[(d=c[u]).i]=d.x(l);return a.join("")})}function xe(e,t){var n=typeof t,i;return t==null||n==="boolean"?Ae(t):(n==="number"?tt:n==="string"?(i=ht(t))?(t=i,Xt):xn:t instanceof ht?Xt:t instanceof Date?os:rs(t)?is:Array.isArray(t)?ss:typeof t.valueOf!="function"&&typeof t.toString!="function"||isNaN(t)?as:tt)(e,t)}function us(e,t){return e=+e,t=+t,function(n){return Math.round(e*(1-n)+t*n)}}var Fe=180/Math.PI,de={translateX:0,translateY:0,rotate:0,skewX:0,scaleX:1,scaleY:1};function Sn(e,t,n,i,r,s){var o,a,c;return(o=Math.sqrt(e*e+t*t))&&(e/=o,t/=o),(c=e*n+t*i)&&(n-=e*c,i-=t*c),(a=Math.sqrt(n*n+i*i))&&(n/=a,i/=a,c/=a),e*i<t*n&&(e=-e,t=-t,c=-c,o=-o),{translateX:r,translateY:s,rotate:Math.atan2(t,e)*Fe,skewX:Math.atan(c)*Fe,scaleX:o,scaleY:a}}var Dt;function ds(e){const t=new(typeof DOMMatrix=="function"?DOMMatrix:WebKitCSSMatrix)(e+"");return t.isIdentity?de:Sn(t.a,t.b,t.c,t.d,t.e,t.f)}function hs(e){return e==null||(Dt||(Dt=document.createElementNS("http://www.w3.org/2000/svg","g")),Dt.setAttribute("transform",e),!(e=Dt.transform.baseVal.consolidate()))?de:(e=e.matrix,Sn(e.a,e.b,e.c,e.d,e.e,e.f))}function En(e,t,n,i){function r(l){return l.length?l.pop()+" ":""}function s(l,u,d,h,p,m){if(l!==d||u!==h){var g=p.push("translate(",null,t,null,n);m.push({i:g-4,x:tt(l,d)},{i:g-2,x:tt(u,h)})}else(d||h)&&p.push("translate("+d+t+h+n)}function o(l,u,d,h){l!==u?(l-u>180?u+=360:u-l>180&&(l+=360),h.push({i:d.push(r(d)+"rotate(",null,i)-2,x:tt(l,u)})):u&&d.push(r(d)+"rotate("+u+i)}function a(l,u,d,h){l!==u?h.push({i:d.push(r(d)+"skewX(",null,i)-2,x:tt(l,u)}):u&&d.push(r(d)+"skewX("+u+i)}function c(l,u,d,h,p,m){if(l!==d||u!==h){var g=p.push(r(p)+"scale(",null,",",null,")");m.push({i:g-4,x:tt(l,d)},{i:g-2,x:tt(u,h)})}else(d!==1||h!==1)&&p.push(r(p)+"scale("+d+","+h+")")}return function(l,u){var d=[],h=[];return l=e(l),u=e(u),s(l.translateX,l.translateY,u.translateX,u.translateY,d,h),o(l.rotate,u.rotate,d,h),a(l.skewX,u.skewX,d,h),c(l.scaleX,l.scaleY,u.scaleX,u.scaleY,d,h),l=u=null,function(p){for(var m=-1,g=h.length,b;++m<g;)d[(b=h[m]).i]=b.x(p);return d.join("")}}}var fs=En(ds,"px, ","px)","deg)"),ps=En(hs,", ",")",")"),wt=0,Et=0,xt=0,_n=1e3,Ut,_t,Kt=0,ft=0,Jt=0,$t=typeof performance=="object"&&performance.now?performance:Date,kn=typeof window=="object"&&window.requestAnimationFrame?window.requestAnimationFrame.bind(window):function(e){setTimeout(e,17)};function Se(){return ft||(kn(ms),ft=$t.now()+Jt)}function ms(){ft=0}function Wt(){this._call=this._time=this._next=null}Wt.prototype=Cn.prototype={constructor:Wt,restart:function(e,t,n){if(typeof e!="function")throw new TypeError("callback is not a function");n=(n==null?Se():+n)+(t==null?0:+t),!this._next&&_t!==this&&(_t?_t._next=this:Ut=this,_t=this),this._call=e,this._time=n,he()},stop:function(){this._call&&(this._call=null,this._time=1/0,he())}};function Cn(e,t,n){var i=new Wt;return i.restart(e,t,n),i}function gs(){Se(),++wt;for(var e=Ut,t;e;)(t=ft-e._time)>=0&&e._call.call(void 0,t),e=e._next;--wt}function He(){ft=(Kt=$t.now())+Jt,wt=Et=0;try{gs()}finally{wt=0,bs(),ft=0}}function ys(){var e=$t.now(),t=e-Kt;t>_n&&(Jt-=t,Kt=e)}function bs(){for(var e,t=Ut,n,i=1/0;t;)t._call?(i>t._time&&(i=t._time),e=t,t=t._next):(n=t._next,t._next=null,t=e?e._next=n:Ut=n);_t=e,he(i)}function he(e){if(!wt){Et&&(Et=clearTimeout(Et));var t=e-ft;t>24?(e<1/0&&(Et=setTimeout(He,e-$t.now()-Jt)),xt&&(xt=clearInterval(xt))):(xt||(Kt=$t.now(),xt=setInterval(ys,_n)),wt=1,kn(He))}}function Oe(e,t,n){var i=new Wt;return t=t==null?0:+t,i.restart(r=>{i.stop(),e(r+t)},t,n),i}var vs=on("start","end","cancel","interrupt"),ws=[],Mn=0,Ge=1,fe=2,Ht=3,Be=4,pe=5,Ot=6;function te(e,t,n,i,r,s){var o=e.__transition;if(!o)e.__transition={};else if(n in o)return;As(e,n,{name:t,index:i,group:r,on:vs,tween:ws,time:s.time,delay:s.delay,duration:s.duration,ease:s.ease,timer:null,state:Mn})}function Ee(e,t){var n=nt(e,t);if(n.state>Mn)throw new Error("too late; already scheduled");return n}function rt(e,t){var n=nt(e,t);if(n.state>Ht)throw new Error("too late; already running");return n}function nt(e,t){var n=e.__transition;if(!n||!(n=n[t]))throw new Error("transition not found");return n}function As(e,t,n){var i=e.__transition,r;i[t]=n,n.timer=Cn(s,0,n.time);function s(l){n.state=Ge,n.timer.restart(o,n.delay,n.time),n.delay<=l&&o(l-n.delay)}function o(l){var u,d,h,p;if(n.state!==Ge)return c();for(u in i)if(p=i[u],p.name===n.name){if(p.state===Ht)return Oe(o);p.state===Be?(p.state=Ot,p.timer.stop(),p.on.call("interrupt",e,e.__data__,p.index,p.group),delete i[u]):+u<t&&(p.state=Ot,p.timer.stop(),p.on.call("cancel",e,e.__data__,p.index,p.group),delete i[u])}if(Oe(function(){n.state===Ht&&(n.state=Be,n.timer.restart(a,n.delay,n.time),a(l))}),n.state=fe,n.on.call("start",e,e.__data__,n.index,n.group),n.state===fe){for(n.state=Ht,r=new Array(h=n.tween.length),u=0,d=-1;u<h;++u)(p=n.tween[u].value.call(e,e.__data__,n.index,n.group))&&(r[++d]=p);r.length=d+1}}function a(l){for(var u=l<n.duration?n.ease.call(null,l/n.duration):(n.timer.restart(c),n.state=pe,1),d=-1,h=r.length;++d<h;)r[d].call(e,u);n.state===pe&&(n.on.call("end",e,e.__data__,n.index,n.group),c())}function c(){n.state=Ot,n.timer.stop(),delete i[t];for(var l in i)return;delete e.__transition}}function xs(e,t){var n=e.__transition,i,r,s=!0,o;if(n){t=t==null?null:t+"";for(o in n){if((i=n[o]).name!==t){s=!1;continue}r=i.state>fe&&i.state<pe,i.state=Ot,i.timer.stop(),i.on.call(r?"interrupt":"cancel",e,e.__data__,i.index,i.group),delete n[o]}s&&delete e.__transition}}function Ss(e){return this.each(function(){xs(this,e)})}function Es(e,t){var n,i;return function(){var r=rt(this,e),s=r.tween;if(s!==n){i=n=s;for(var o=0,a=i.length;o<a;++o)if(i[o].name===t){i=i.slice(),i.splice(o,1);break}}r.tween=i}}function _s(e,t,n){var i,r;if(typeof n!="function")throw new Error;return function(){var s=rt(this,e),o=s.tween;if(o!==i){r=(i=o).slice();for(var a={name:t,value:n},c=0,l=r.length;c<l;++c)if(r[c].name===t){r[c]=a;break}c===l&&r.push(a)}s.tween=r}}function ks(e,t){var n=this._id;if(e+="",arguments.length<2){for(var i=nt(this.node(),n).tween,r=0,s=i.length,o;r<s;++r)if((o=i[r]).name===e)return o.value;return null}return this.each((t==null?Es:_s)(n,e,t))}function _e(e,t,n){var i=e._id;return e.each(function(){var r=rt(this,i);(r.value||(r.value={}))[t]=n.apply(this,arguments)}),function(r){return nt(r,i).value[t]}}function $n(e,t){var n;return(typeof t=="number"?tt:t instanceof ht?Xt:(n=ht(t))?(t=n,Xt):xn)(e,t)}function Cs(e){return function(){this.removeAttribute(e)}}function Ms(e){return function(){this.removeAttributeNS(e.space,e.local)}}function $s(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttribute(e);return o===r?null:o===i?s:s=t(i=o,n)}}function Ts(e,t,n){var i,r=n+"",s;return function(){var o=this.getAttributeNS(e.space,e.local);return o===r?null:o===i?s:s=t(i=o,n)}}function Ns(e,t,n){var i,r,s;return function(){var o,a=n(this),c;return a==null?void this.removeAttribute(e):(o=this.getAttribute(e),c=a+"",o===c?null:o===i&&c===r?s:(r=c,s=t(i=o,a)))}}function Ls(e,t,n){var i,r,s;return function(){var o,a=n(this),c;return a==null?void this.removeAttributeNS(e.space,e.local):(o=this.getAttributeNS(e.space,e.local),c=a+"",o===c?null:o===i&&c===r?s:(r=c,s=t(i=o,a)))}}function Rs(e,t){var n=Qt(e),i=n==="transform"?ps:$n;return this.attrTween(e,typeof t=="function"?(n.local?Ls:Ns)(n,i,_e(this,"attr."+e,t)):t==null?(n.local?Ms:Cs)(n):(n.local?Ts:$s)(n,i,t))}function Is(e,t){return function(n){this.setAttribute(e,t.call(this,n))}}function qs(e,t){return function(n){this.setAttributeNS(e.space,e.local,t.call(this,n))}}function Ds(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&qs(e,s)),n}return r._value=t,r}function Ps(e,t){var n,i;function r(){var s=t.apply(this,arguments);return s!==i&&(n=(i=s)&&Is(e,s)),n}return r._value=t,r}function zs(e,t){var n="attr."+e;if(arguments.length<2)return(n=this.tween(n))&&n._value;if(t==null)return this.tween(n,null);if(typeof t!="function")throw new Error;var i=Qt(e);return this.tween(n,(i.local?Ds:Ps)(i,t))}function Fs(e,t){return function(){Ee(this,e).delay=+t.apply(this,arguments)}}function Hs(e,t){return t=+t,function(){Ee(this,e).delay=t}}function Os(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Fs:Hs)(t,e)):nt(this.node(),t).delay}function Gs(e,t){return function(){rt(this,e).duration=+t.apply(this,arguments)}}function Bs(e,t){return t=+t,function(){rt(this,e).duration=t}}function Ys(e){var t=this._id;return arguments.length?this.each((typeof e=="function"?Gs:Bs)(t,e)):nt(this.node(),t).duration}function Vs(e,t){if(typeof t!="function")throw new Error;return function(){rt(this,e).ease=t}}function Xs(e){var t=this._id;return arguments.length?this.each(Vs(t,e)):nt(this.node(),t).ease}function Us(e,t){return function(){var n=t.apply(this,arguments);if(typeof n!="function")throw new Error;rt(this,e).ease=n}}function Ks(e){if(typeof e!="function")throw new Error;return this.each(Us(this._id,e))}function Ws(e){typeof e!="function"&&(e=ln(e));for(var t=this._groups,n=t.length,i=new Array(n),r=0;r<n;++r)for(var s=t[r],o=s.length,a=i[r]=[],c,l=0;l<o;++l)(c=s[l])&&e.call(c,c.__data__,l,s)&&a.push(c);return new ot(i,this._parents,this._name,this._id)}function Zs(e){if(e._id!==this._id)throw new Error;for(var t=this._groups,n=e._groups,i=t.length,r=n.length,s=Math.min(i,r),o=new Array(i),a=0;a<s;++a)for(var c=t[a],l=n[a],u=c.length,d=o[a]=new Array(u),h,p=0;p<u;++p)(h=c[p]||l[p])&&(d[p]=h);for(;a<i;++a)o[a]=t[a];return new ot(o,this._parents,this._name,this._id)}function js(e){return(e+"").trim().split(/^|\s+/).every(function(t){var n=t.indexOf(".");return n>=0&&(t=t.slice(0,n)),!t||t==="start"})}function Qs(e,t,n){var i,r,s=js(t)?Ee:rt;return function(){var o=s(this,e),a=o.on;a!==i&&(r=(i=a).copy()).on(t,n),o.on=r}}function Js(e,t){var n=this._id;return arguments.length<2?nt(this.node(),n).on.on(e):this.each(Qs(n,e,t))}function to(e){return function(){var t=this.parentNode;for(var n in this.__transition)if(+n!==e)return;t&&t.removeChild(this)}}function eo(){return this.on("end.remove",to(this._id))}function no(e){var t=this._name,n=this._id;typeof e!="function"&&(e=be(e));for(var i=this._groups,r=i.length,s=new Array(r),o=0;o<r;++o)for(var a=i[o],c=a.length,l=s[o]=new Array(c),u,d,h=0;h<c;++h)(u=a[h])&&(d=e.call(u,u.__data__,h,a))&&("__data__"in u&&(d.__data__=u.__data__),l[h]=d,te(l[h],t,n,h,l,nt(u,n)));return new ot(s,this._parents,t,n)}function io(e){var t=this._name,n=this._id;typeof e!="function"&&(e=cn(e));for(var i=this._groups,r=i.length,s=[],o=[],a=0;a<r;++a)for(var c=i[a],l=c.length,u,d=0;d<l;++d)if(u=c[d]){for(var h=e.call(u,u.__data__,d,c),p,m=nt(u,n),g=0,b=h.length;g<b;++g)(p=h[g])&&te(p,t,n,g,h,m);s.push(h),o.push(u)}return new ot(s,o,t,n)}var ro=Tt.prototype.constructor;function so(){return new ro(this._groups,this._parents)}function oo(e,t){var n,i,r;return function(){var s=vt(this,e),o=(this.style.removeProperty(e),vt(this,e));return s===o?null:s===n&&o===i?r:r=t(n=s,i=o)}}function Tn(e){return function(){this.style.removeProperty(e)}}function ao(e,t,n){var i,r=n+"",s;return function(){var o=vt(this,e);return o===r?null:o===i?s:s=t(i=o,n)}}function co(e,t,n){var i,r,s;return function(){var o=vt(this,e),a=n(this),c=a+"";return a==null&&(c=a=(this.style.removeProperty(e),vt(this,e))),o===c?null:o===i&&c===r?s:(r=c,s=t(i=o,a))}}function lo(e,t){var n,i,r,s="style."+t,o="end."+s,a;return function(){var c=rt(this,e),l=c.on,u=c.value[s]==null?a||(a=Tn(t)):void 0;(l!==n||r!==u)&&(i=(n=l).copy()).on(o,r=u),c.on=i}}function uo(e,t,n){var i=(e+="")=="transform"?fs:$n;return t==null?this.styleTween(e,oo(e,i)).on("end.style."+e,Tn(e)):typeof t=="function"?this.styleTween(e,co(e,i,_e(this,"style."+e,t))).each(lo(this._id,e)):this.styleTween(e,ao(e,i,t),n).on("end.style."+e,null)}function ho(e,t,n){return function(i){this.style.setProperty(e,t.call(this,i),n)}}function fo(e,t,n){var i,r;function s(){var o=t.apply(this,arguments);return o!==r&&(i=(r=o)&&ho(e,o,n)),i}return s._value=t,s}function po(e,t,n){var i="style."+(e+="");if(arguments.length<2)return(i=this.tween(i))&&i._value;if(t==null)return this.tween(i,null);if(typeof t!="function")throw new Error;return this.tween(i,fo(e,t,n??""))}function mo(e){return function(){this.textContent=e}}function go(e){return function(){var t=e(this);this.textContent=t??""}}function yo(e){return this.tween("text",typeof e=="function"?go(_e(this,"text",e)):mo(e==null?"":e+""))}function bo(e){return function(t){this.textContent=e.call(this,t)}}function vo(e){var t,n;function i(){var r=e.apply(this,arguments);return r!==n&&(t=(n=r)&&bo(r)),t}return i._value=e,i}function wo(e){var t="text";if(arguments.length<1)return(t=this.tween(t))&&t._value;if(e==null)return this.tween(t,null);if(typeof e!="function")throw new Error;return this.tween(t,vo(e))}function Ao(){for(var e=this._name,t=this._id,n=Nn(),i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,c,l=0;l<a;++l)if(c=o[l]){var u=nt(c,t);te(c,e,n,l,o,{time:u.time+u.delay+u.duration,delay:0,duration:u.duration,ease:u.ease})}return new ot(i,this._parents,e,n)}function xo(){var e,t,n=this,i=n._id,r=n.size();return new Promise(function(s,o){var a={value:o},c={value:function(){--r===0&&s()}};n.each(function(){var l=rt(this,i),u=l.on;u!==e&&(t=(e=u).copy(),t._.cancel.push(a),t._.interrupt.push(a),t._.end.push(c)),l.on=t}),r===0&&s()})}var So=0;function ot(e,t,n,i){this._groups=e,this._parents=t,this._name=n,this._id=i}function Nn(){return++So}var st=Tt.prototype;ot.prototype={constructor:ot,select:no,selectAll:io,selectChild:st.selectChild,selectChildren:st.selectChildren,filter:Ws,merge:Zs,selection:so,transition:Ao,call:st.call,nodes:st.nodes,node:st.node,size:st.size,empty:st.empty,each:st.each,on:Js,attr:Rs,attrTween:zs,style:uo,styleTween:po,text:yo,textTween:wo,remove:eo,tween:ks,delay:Os,duration:Ys,ease:Xs,easeVarying:Ks,end:xo,[Symbol.iterator]:st[Symbol.iterator]};function Eo(e){return((e*=2)<=1?e*e*e:(e-=2)*e*e+2)/2}var _o={time:null,delay:0,duration:250,ease:Eo};function ko(e,t){for(var n;!(n=e.__transition)||!(n=n[t]);)if(!(e=e.parentNode))throw new Error(`transition ${t} not found`);return n}function Co(e){var t,n;e instanceof ot?(t=e._id,e=e._name):(t=Nn(),(n=_o).time=Se(),e=e==null?null:e+"");for(var i=this._groups,r=i.length,s=0;s<r;++s)for(var o=i[s],a=o.length,c,l=0;l<a;++l)(c=o[l])&&te(c,e,t,l,o,n||ko(c,t));return new ot(i,this._parents,e,t)}Tt.prototype.interrupt=Ss;Tt.prototype.transition=Co;const me=Math.PI,ge=2*me,ct=1e-6,Mo=ge-ct;function Ln(e){this._+=e[0];for(let t=1,n=e.length;t<n;++t)this._+=arguments[t]+e[t]}function $o(e){let t=Math.floor(e);if(!(t>=0))throw new Error(`invalid digits: ${e}`);if(t>15)return Ln;const n=10**t;return function(i){this._+=i[0];for(let r=1,s=i.length;r<s;++r)this._+=Math.round(arguments[r]*n)/n+i[r]}}class Rn{constructor(t){this._x0=this._y0=this._x1=this._y1=null,this._="",this._append=t==null?Ln:$o(t)}moveTo(t,n){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}`}closePath(){this._x1!==null&&(this._x1=this._x0,this._y1=this._y0,this._append`Z`)}lineTo(t,n){this._append`L${this._x1=+t},${this._y1=+n}`}quadraticCurveTo(t,n,i,r){this._append`Q${+t},${+n},${this._x1=+i},${this._y1=+r}`}bezierCurveTo(t,n,i,r,s,o){this._append`C${+t},${+n},${+i},${+r},${this._x1=+s},${this._y1=+o}`}arcTo(t,n,i,r,s){if(t=+t,n=+n,i=+i,r=+r,s=+s,s<0)throw new Error(`negative radius: ${s}`);let o=this._x1,a=this._y1,c=i-t,l=r-n,u=o-t,d=a-n,h=u*u+d*d;if(this._x1===null)this._append`M${this._x1=t},${this._y1=n}`;else if(h>ct)if(!(Math.abs(d*c-l*u)>ct)||!s)this._append`L${this._x1=t},${this._y1=n}`;else{let p=i-o,m=r-a,g=c*c+l*l,b=p*p+m*m,f=Math.sqrt(g),y=Math.sqrt(h),v=s*Math.tan((me-Math.acos((g+h-b)/(2*f*y)))/2),M=v/y,w=v/f;Math.abs(M-1)>ct&&this._append`L${t+M*u},${n+M*d}`,this._append`A${s},${s},0,0,${+(d*p>u*m)},${this._x1=t+w*c},${this._y1=n+w*l}`}}arc(t,n,i,r,s,o){if(t=+t,n=+n,i=+i,o=!!o,i<0)throw new Error(`negative radius: ${i}`);let a=i*Math.cos(r),c=i*Math.sin(r),l=t+a,u=n+c,d=1^o,h=o?r-s:s-r;this._x1===null?this._append`M${l},${u}`:(Math.abs(this._x1-l)>ct||Math.abs(this._y1-u)>ct)&&this._append`L${l},${u}`,i&&(h<0&&(h=h%ge+ge),h>Mo?this._append`A${i},${i},0,1,${d},${t-a},${n-c}A${i},${i},0,1,${d},${this._x1=l},${this._y1=u}`:h>ct&&this._append`A${i},${i},0,${+(h>=me)},${d},${this._x1=t+i*Math.cos(s)},${this._y1=n+i*Math.sin(s)}`)}rect(t,n,i,r){this._append`M${this._x0=this._x1=+t},${this._y0=this._y1=+n}h${i=+i}v${+r}h${-i}Z`}toString(){return this._}}function In(){return new Rn}In.prototype=Rn.prototype;var Ye={},ie={},re=34,St=10,se=13;function qn(e){return new Function("d","return {"+e.map(function(t,n){return JSON.stringify(t)+": d["+n+'] || ""'}).join(",")+"}")}function To(e,t){var n=qn(e);return function(i,r){return t(n(i),r,e)}}function Ve(e){var t=Object.create(null),n=[];return e.forEach(function(i){for(var r in i)r in t||n.push(t[r]=r)}),n}function Z(e,t){var n=e+"",i=n.length;return i<t?new Array(t-i+1).join(0)+n:n}function No(e){return e<0?"-"+Z(-e,6):e>9999?"+"+Z(e,6):Z(e,4)}function Lo(e){var t=e.getUTCHours(),n=e.getUTCMinutes(),i=e.getUTCSeconds(),r=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":No(e.getUTCFullYear())+"-"+Z(e.getUTCMonth()+1,2)+"-"+Z(e.getUTCDate(),2)+(r?"T"+Z(t,2)+":"+Z(n,2)+":"+Z(i,2)+"."+Z(r,3)+"Z":i?"T"+Z(t,2)+":"+Z(n,2)+":"+Z(i,2)+"Z":n||t?"T"+Z(t,2)+":"+Z(n,2)+"Z":"")}function Ro(e){var t=new RegExp('["'+e+`
\r]`),n=e.charCodeAt(0);function i(d,h){var p,m,g=r(d,function(b,f){if(p)return p(b,f-1);m=b,p=h?To(b,h):qn(b)});return g.columns=m||[],g}function r(d,h){var p=[],m=d.length,g=0,b=0,f,y=m<=0,v=!1;d.charCodeAt(m-1)===St&&--m,d.charCodeAt(m-1)===se&&--m;function M(){if(y)return ie;if(v)return v=!1,Ye;var A,x=g,C;if(d.charCodeAt(x)===re){for(;g++<m&&d.charCodeAt(g)!==re||d.charCodeAt(++g)===re;);return(A=g)>=m?y=!0:(C=d.charCodeAt(g++))===St?v=!0:C===se&&(v=!0,d.charCodeAt(g)===St&&++g),d.slice(x+1,A-1).replace(/""/g,'"')}for(;g<m;){if((C=d.charCodeAt(A=g++))===St)v=!0;else if(C===se)v=!0,d.charCodeAt(g)===St&&++g;else if(C!==n)continue;return d.slice(x,A)}return y=!0,d.slice(x,m)}for(;(f=M())!==ie;){for(var w=[];f!==Ye&&f!==ie;)w.push(f),f=M();h&&(w=h(w,b++))==null||p.push(w)}return p}function s(d,h){return d.map(function(p){return h.map(function(m){return u(p[m])}).join(e)})}function o(d,h){return h==null&&(h=Ve(d)),[h.map(u).join(e)].concat(s(d,h)).join(`
`)}function a(d,h){return h==null&&(h=Ve(d)),s(d,h).join(`
`)}function c(d){return d.map(l).join(`
`)}function l(d){return d.map(u).join(e)}function u(d){return d==null?"":d instanceof Date?Lo(d):t.test(d+="")?'"'+d.replace(/"/g,'""')+'"':d}return{parse:i,parseRows:r,format:o,formatBody:a,formatRows:c,formatRow:l,formatValue:u}}var Io=Ro(","),qo=Io.parse;function Do(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}function Po(e,t){return fetch(e,t).then(Do)}function zo(e){return function(t,n,i){return arguments.length===2&&typeof n=="function"&&(i=n,n=void 0),Po(t,n).then(function(r){return e(r,i)})}}var Fo=zo(qo);function Ho(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Zt(e,t){if((n=(e=t?e.toExponential(t-1):e.toExponential()).indexOf("e"))<0)return null;var n,i=e.slice(0,n);return[i.length>1?i[0]+i.slice(2):i,+e.slice(n+1)]}function At(e){return e=Zt(Math.abs(e)),e?e[1]:NaN}function Oo(e,t){return function(n,i){for(var r=n.length,s=[],o=0,a=e[0],c=0;r>0&&a>0&&(c+a+1>i&&(a=Math.max(1,i-c)),s.push(n.substring(r-=a,r+a)),!((c+=a+1)>i));)a=e[o=(o+1)%e.length];return s.reverse().join(t)}}function Go(e){return function(t){return t.replace(/[0-9]/g,function(n){return e[+n]})}}var Bo=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function jt(e){if(!(t=Bo.exec(e)))throw new Error("invalid format: "+e);var t;return new ke({fill:t[1],align:t[2],sign:t[3],symbol:t[4],zero:t[5],width:t[6],comma:t[7],precision:t[8]&&t[8].slice(1),trim:t[9],type:t[10]})}jt.prototype=ke.prototype;function ke(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}ke.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function Yo(e){t:for(var t=e.length,n=1,i=-1,r;n<t;++n)switch(e[n]){case".":i=r=n;break;case"0":i===0&&(i=n),r=n;break;default:if(!+e[n])break t;i>0&&(i=0);break}return i>0?e.slice(0,i)+e.slice(r+1):e}var Dn;function Vo(e,t){var n=Zt(e,t);if(!n)return e+"";var i=n[0],r=n[1],s=r-(Dn=Math.max(-8,Math.min(8,Math.floor(r/3)))*3)+1,o=i.length;return s===o?i:s>o?i+new Array(s-o+1).join("0"):s>0?i.slice(0,s)+"."+i.slice(s):"0."+new Array(1-s).join("0")+Zt(e,Math.max(0,t+s-1))[0]}function Xe(e,t){var n=Zt(e,t);if(!n)return e+"";var i=n[0],r=n[1];return r<0?"0."+new Array(-r).join("0")+i:i.length>r+1?i.slice(0,r+1)+"."+i.slice(r+1):i+new Array(r-i.length+2).join("0")}const Ue={"%":(e,t)=>(e*100).toFixed(t),b:e=>Math.round(e).toString(2),c:e=>e+"",d:Ho,e:(e,t)=>e.toExponential(t),f:(e,t)=>e.toFixed(t),g:(e,t)=>e.toPrecision(t),o:e=>Math.round(e).toString(8),p:(e,t)=>Xe(e*100,t),r:Xe,s:Vo,X:e=>Math.round(e).toString(16).toUpperCase(),x:e=>Math.round(e).toString(16)};function Ke(e){return e}var We=Array.prototype.map,Ze=["y","z","a","f","p","n","µ","m","","k","M","G","T","P","E","Z","Y"];function Xo(e){var t=e.grouping===void 0||e.thousands===void 0?Ke:Oo(We.call(e.grouping,Number),e.thousands+""),n=e.currency===void 0?"":e.currency[0]+"",i=e.currency===void 0?"":e.currency[1]+"",r=e.decimal===void 0?".":e.decimal+"",s=e.numerals===void 0?Ke:Go(We.call(e.numerals,String)),o=e.percent===void 0?"%":e.percent+"",a=e.minus===void 0?"−":e.minus+"",c=e.nan===void 0?"NaN":e.nan+"";function l(d){d=jt(d);var h=d.fill,p=d.align,m=d.sign,g=d.symbol,b=d.zero,f=d.width,y=d.comma,v=d.precision,M=d.trim,w=d.type;w==="n"?(y=!0,w="g"):Ue[w]||(v===void 0&&(v=12),M=!0,w="g"),(b||h==="0"&&p==="=")&&(b=!0,h="0",p="=");var A=g==="$"?n:g==="#"&&/[boxX]/.test(w)?"0"+w.toLowerCase():"",x=g==="$"?i:/[%p]/.test(w)?o:"",C=Ue[w],q=/[defgprs%]/.test(w);v=v===void 0?6:/[gprs]/.test(w)?Math.max(1,Math.min(21,v)):Math.max(0,Math.min(20,v));function R(E){var P=A,z=x,X,K,W;if(w==="c")z=C(E)+z,E="";else{E=+E;var U=E<0||1/E<0;if(E=isNaN(E)?c:C(Math.abs(E),v),M&&(E=Yo(E)),U&&+E==0&&m!=="+"&&(U=!1),P=(U?m==="("?m:a:m==="-"||m==="("?"":m)+P,z=(w==="s"?Ze[8+Dn/3]:"")+z+(U&&m==="("?")":""),q){for(X=-1,K=E.length;++X<K;)if(W=E.charCodeAt(X),48>W||W>57){z=(W===46?r+E.slice(X+1):E.slice(X))+z,E=E.slice(0,X);break}}}y&&!b&&(E=t(E,1/0));var I=P.length+E.length+z.length,S=I<f?new Array(f-I+1).join(h):"";switch(y&&b&&(E=t(S+E,S.length?f-z.length:1/0),S=""),p){case"<":E=P+E+z+S;break;case"=":E=P+S+E+z;break;case"^":E=S.slice(0,I=S.length>>1)+P+E+z+S.slice(I);break;default:E=S+P+E+z;break}return s(E)}return R.toString=function(){return d+""},R}function u(d,h){var p=l((d=jt(d),d.type="f",d)),m=Math.max(-8,Math.min(8,Math.floor(At(h)/3)))*3,g=Math.pow(10,-m),b=Ze[8+m/3];return function(f){return p(g*f)+b}}return{format:l,formatPrefix:u}}var Pt,Pn,zn;Uo({thousands:",",grouping:[3],currency:["$",""]});function Uo(e){return Pt=Xo(e),Pn=Pt.format,zn=Pt.formatPrefix,Pt}function Ko(e){return Math.max(0,-At(Math.abs(e)))}function Wo(e,t){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(At(t)/3)))*3-At(Math.abs(e)))}function Zo(e,t){return e=Math.abs(e),t=Math.abs(t)-e,Math.max(0,At(t)-At(e))+1}function jo(e,t){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(t).domain(e);break}return this}function Qo(e){return function(){return e}}function Jo(e){return+e}var je=[0,1];function yt(e){return e}function ye(e,t){return(t-=e=+e)?function(n){return(n-e)/t}:Qo(isNaN(t)?NaN:.5)}function ta(e,t){var n;return e>t&&(n=e,e=t,t=n),function(i){return Math.max(e,Math.min(t,i))}}function ea(e,t,n){var i=e[0],r=e[1],s=t[0],o=t[1];return r<i?(i=ye(r,i),s=n(o,s)):(i=ye(i,r),s=n(s,o)),function(a){return s(i(a))}}function na(e,t,n){var i=Math.min(e.length,t.length)-1,r=new Array(i),s=new Array(i),o=-1;for(e[i]<e[0]&&(e=e.slice().reverse(),t=t.slice().reverse());++o<i;)r[o]=ye(e[o],e[o+1]),s[o]=n(t[o],t[o+1]);return function(a){var c=ei(e,a,1,i)-1;return s[c](r[c](a))}}function ia(e,t){return t.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function ra(){var e=je,t=je,n=xe,i,r,s,o=yt,a,c,l;function u(){var h=Math.min(e.length,t.length);return o!==yt&&(o=ta(e[0],e[h-1])),a=h>2?na:ea,c=l=null,d}function d(h){return h==null||isNaN(h=+h)?s:(c||(c=a(e.map(i),t,n)))(i(o(h)))}return d.invert=function(h){return o(r((l||(l=a(t,e.map(i),tt)))(h)))},d.domain=function(h){return arguments.length?(e=Array.from(h,Jo),u()):e.slice()},d.range=function(h){return arguments.length?(t=Array.from(h),u()):t.slice()},d.rangeRound=function(h){return t=Array.from(h),n=us,u()},d.clamp=function(h){return arguments.length?(o=h?!0:yt,u()):o!==yt},d.interpolate=function(h){return arguments.length?(n=h,u()):n},d.unknown=function(h){return arguments.length?(s=h,d):s},function(h,p){return i=h,r=p,u()}}function sa(){return ra()(yt,yt)}function oa(e,t,n,i){var r=oi(e,t,n),s;switch(i=jt(i??",f"),i.type){case"s":{var o=Math.max(Math.abs(e),Math.abs(t));return i.precision==null&&!isNaN(s=Wo(r,o))&&(i.precision=s),zn(i,o)}case"":case"e":case"g":case"p":case"r":{i.precision==null&&!isNaN(s=Zo(r,Math.max(Math.abs(e),Math.abs(t))))&&(i.precision=s-(i.type==="e"));break}case"f":case"%":{i.precision==null&&!isNaN(s=Ko(r))&&(i.precision=s-(i.type==="%")*2);break}}return Pn(i)}function aa(e){var t=e.domain;return e.ticks=function(n){var i=t();return si(i[0],i[i.length-1],n??10)},e.tickFormat=function(n,i){var r=t();return oa(r[0],r[r.length-1],n??10,i)},e.nice=function(n){n==null&&(n=10);var i=t(),r=0,s=i.length-1,o=i[r],a=i[s],c,l,u=10;for(a<o&&(l=o,o=a,a=l,l=r,r=s,s=l);u-- >0;){if(l=ae(o,a,n),l===c)return i[r]=o,i[s]=a,t(i);if(l>0)o=Math.floor(o/l)*l,a=Math.ceil(a/l)*l;else if(l<0)o=Math.ceil(o*l)/l,a=Math.floor(a*l)/l;else break;c=l}return e},e}function Fn(){var e=sa();return e.copy=function(){return ia(e,Fn())},jo.apply(e,arguments),aa(e)}function kt(e,t,n){this.k=e,this.x=t,this.y=n}kt.prototype={constructor:kt,scale:function(e){return e===1?this:new kt(this.k*e,this.x,this.y)},translate:function(e,t){return e===0&t===0?this:new kt(this.k,this.x+this.k*e,this.y+this.k*t)},apply:function(e){return[e[0]*this.k+this.x,e[1]*this.k+this.y]},applyX:function(e){return e*this.k+this.x},applyY:function(e){return e*this.k+this.y},invert:function(e){return[(e[0]-this.x)/this.k,(e[1]-this.y)/this.k]},invertX:function(e){return(e-this.x)/this.k},invertY:function(e){return(e-this.y)/this.k},rescaleX:function(e){return e.copy().domain(e.range().map(this.invertX,this).map(e.invert,e))},rescaleY:function(e){return e.copy().domain(e.range().map(this.invertY,this).map(e.invert,e))},toString:function(){return"translate("+this.x+","+this.y+") scale("+this.k+")"}};kt.prototype;const ca=700,lt=ca/2,oe=lt-60,Qe=60,la=360/12e3;class ua{constructor(){this.container=null,this.svg=null,this.ringsGroup=null,this.wrapperEl=null,this.notesWrapper=null,this.tonearm=null,this.tonearmArm=null,this.tonearmHinge=null,this.tonearmHead=null,this.data=[],this.radiusScale=null,this.angleScale=null,this.activeIndex=null,this.lockedIndex=null,this.isDraggingTonearm=!1,this.activePointerElement=null,this.spinAngles=new Map,this.spinTimers=new Map,this.audioCache=new Map,this.currentAudio=null,this.currentAudioIndex=null,this.autoplayUnlocked=!1,this.pendingAudioIndex=null,this.handleFirstGesture=this.handleFirstGesture.bind(this)}async init(t,n={}){if(this.container=document.querySelector(t),!this.container)throw new Error(`RecordPlayerViz: container "${t}" not found.`);this.wrapperEl=this.container.querySelector(".record-player-wrapper"),this.notesWrapper=this.container.querySelector(".record-player-notes"),this.svg=Te(this.container.querySelector(".record-disc")),this.ringsGroup=this.svg.select("[data-record-rings]"),this.tonearm=this.container.querySelector(".tonearm"),this.tonearmArm=this.container.querySelector("[data-tonearm-arm]"),this.tonearmHinge=this.container.querySelector(".tonearm-hinge"),this.tonearmHead=this.container.querySelector(".tonearm-head"),await this.loadData(),this.setupScales(),this.renderRings(),this.bindInteractions(),document.addEventListener("pointerdown",this.handleFirstGesture,{once:!0}),this.setTonearmToIndex(0,{silent:!0})}async loadData(){const t=await Fo("/data/top10_music.csv",n=>({name:n["musicMeta/musicName"]??n["Music Name"],playUrl:n.music_playUrl??n["musicMeta/musicPlayUrl"]??"",totalPlayCount:+n.total_playCount||+n["Total Digg"]||0}));this.data=t.filter(n=>n.name&&Number.isFinite(n.totalPlayCount)).sort((n,i)=>i.totalPlayCount-n.totalPlayCount).slice(0,10),this.audioCache=new Map,this.data.forEach(n=>{const i=new Audio(n.playUrl);i.loop=!0,i.muted=!0,i.play().catch(()=>{}),this.audioCache.set(n.playUrl,i)}),this.totalRings=this.data.length}setupScales(){const t=(oe-Qe)/this.data.length;this.radiusScale=r=>oe-(r+.75)*t;const n=30,i=0;this.angleScale=Fn().domain([0,this.totalRings-1]).range([i,n])}renderRings(){this.stopAllRingRotation(),this.spinAngles.clear();const t=this.ensureDefs(),n=this.ringsGroup.selectAll(".record-ring").data(this.data,s=>s.name),i=n.enter().append("g").attr("class","record-ring").attr("data-song-index",(s,o)=>o).attr("transform",`translate(${lt}, ${lt})`);i.append("circle").attr("class","record-ring-arc"),i.append("text").attr("class","record-ring-label").append("textPath"),i.merge(n).attr("data-song-index",(s,o)=>o).each((s,o,a)=>{const c=Math.max(14,this.radiusScale(o)),l=Math.max(this.totalRings,1),d=(oe-Qe)/l*1,h=Te(a[o]);h.select(".record-ring-arc").attr("r",c).attr("stroke-width",d);const m=Math.max(12,c-d*.35),g=Math.PI*.72,f=-Math.PI/2-g/2+(o%2===0?-.05:.05),y=f+g,v=`record-ring-label-path-${o}`;let M=t.select(`#${v}`);M.empty()&&(M=t.append("path").attr("id",v));const w=In();w.arc(0,0,m,f,y),M.attr("d",w.toString());const A=h.select(".record-ring-label").select("textPath"),x=o>=this.data.length-2;A.attr("startOffset","50%").attr("href",`#${v}`).attr("text-anchor","middle").attr("dominant-baseline","middle").attr("method","stretch").attr("dy",0).classed("inner-label",x).attr("textLength",x?g*m*1:null).text(()=>{const C=s.totalPlayCount/1e6,q=C>=100?Math.round(C):C.toFixed(1);return`🎵 ${s.name} • ${q}M`}),this.spinAngles.set(o,this.spinAngles.get(o)??0),this.applyRingTransform(o)}),n.exit().remove()}ensureDefs(){let t=this.svg.select("defs");return t.empty()&&(t=this.svg.insert("defs",":first-child")),t}bindInteractions(){const t=this.container.querySelectorAll(".record-ring"),n=this.container.querySelector(".record-indicator-line--max"),i=()=>n==null?void 0:n.classList.remove("is-hidden"),r=()=>n==null?void 0:n.classList.add("is-hidden");i(),t.forEach(o=>{o.addEventListener("mouseenter",()=>{const a=Number(o.dataset.songIndex);this.activateRing(a,{locked:!1,source:"hover"}),r()}),o.addEventListener("mouseleave",()=>{const a=Number(o.dataset.songIndex);if(this.lockedIndex!==null&&this.lockedIndex!==a){this.activateRing(this.lockedIndex,{locked:!0,source:"tonearm"});return}this.stopRingRotation(a),o.classList.remove("is-hovered"),o.classList.remove("is-active"),this.lockedIndex===a&&(this.lockedIndex=null),this.activeIndex===a&&(this.activeIndex=null),this.stopSong(!0)}),o.addEventListener("click",()=>{const a=Number(o.dataset.songIndex);this.handleFirstGesture(),this.activateRing(a,{locked:!0,source:"click"}),r()})});const s=this.container.querySelector(".record-disc-area");s&&s.addEventListener("mouseleave",()=>{this.stopAllRingRotation(),this.clearActiveRing({preserveLocked:!1}),this.stopSong(!0),i()})}getRingSelection(t){return this.ringsGroup.select(`[data-song-index="${t}"]`)}getRingNode(t){return this.getRingSelection(t).node()}applyRingTransform(t){const n=this.getRingNode(t);if(!n)return;const i=this.spinAngles.get(t)||0;n.setAttribute("transform",`translate(${lt}, ${lt}) rotate(${i})`)}startRingRotation(t){if(this.spinTimers.has(t))return;const n=this.getRingNode(t);if(!n)return;let i=this.spinAngles.get(t)||0;const r={last:null,rafId:null},s=o=>{if(!this.spinTimers.has(t))return;r.last===null&&(r.last=o);const a=o-r.last;r.last=o,i=(i+a*la)%360,this.spinAngles.set(t,i),n.setAttribute("transform",`translate(${lt}, ${lt}) rotate(${i})`),r.rafId=requestAnimationFrame(s)};r.rafId=requestAnimationFrame(s),this.spinTimers.set(t,r)}stopRingRotation(t){const n=this.spinTimers.get(t);n&&(n.rafId&&cancelAnimationFrame(n.rafId),this.spinTimers.delete(t)),this.applyRingTransform(t)}stopAllRingRotation(){this.spinTimers.forEach(t=>{t.rafId&&cancelAnimationFrame(t.rafId)}),this.spinTimers.clear()}getRingRotation(t){return this.spinAngles.get(t)||0}activateRing(t,{locked:n=!1,source:i="hover"}={}){if(t<0||t>=this.data.length)return;const r=this.getRingSelection(t);if(!r.node())return;if(n&&this.lockedIndex!==t&&(this.lockedIndex!==null&&this.lockedIndex!==t&&(this.stopRingRotation(this.lockedIndex),this.getRingSelection(this.lockedIndex).classed("is-active",!1).classed("is-hovered",!1)),this.lockedIndex=t),this.activeIndex!==null&&this.activeIndex!==t){const o=this.getRingSelection(this.activeIndex);o.node()&&this.lockedIndex!==this.activeIndex&&(this.stopRingRotation(this.activeIndex),o.classed("is-active",!1).classed("is-hovered",!1))}const s=i==="hover";r.classed("is-hovered",s),r.classed("is-active",n||this.lockedIndex===t||!s),s?this.startRingRotation(t):!n&&this.lockedIndex!==t&&this.stopRingRotation(t),this.playSong(t,{autoplay:s||n}),s?this.setTonearmToIndex(t,{silent:!0}):this.setTonearmToIndex(t,{silent:!n})}clearActiveRing({preserveLocked:t=!0}={}){this.ringsGroup.selectAll(".record-ring").each((n,i,r)=>{const s=Number(r[i].dataset.songIndex);t&&s===this.lockedIndex||(this.stopRingRotation(s),r[i].classList.remove("is-active","is-hovered"),this.spinAngles.set(s,this.getRingRotation(s)),this.applyRingTransform(s))}),t||(this.lockedIndex=null),this.activeIndex=null}setTonearmToIndex(t,{silent:n=!1}={}){if(!this.tonearmArm||t==null||t<0||t>=this.data.length)return;const i=this.angleScale(t);console.log("angle",i),this.tonearmArm.style.transform=`rotate(${i}deg)`,n||(this.lockedIndex=t)}clampTonearmAngle(t){const n=this.angleScale.range(),i=Math.min(...n)-12,r=Math.max(...n)+8;return Math.max(i,Math.min(r,t))}playSong(t,{autoplay:n=!0,force:i=!1}={}){const r=this.data[t];if(!r||!r.playUrl){this.stopSong(!0);return}let s=this.audioCache.get(r.playUrl);if(s||(s=new Audio(r.playUrl),s.loop=!0,s.preload="auto",this.audioCache.set(r.playUrl,s)),s.muted=!1,n&&!i&&!this.autoplayUnlocked){this.currentAudio=s,this.currentAudioIndex=t,s.currentTime=0,s.muted=!0,s.play().then(()=>{s.muted=!1,s.currentTime=0,this.autoplayUnlocked=!0,s.play().then(()=>{this.toggleNotes(!0)}).catch(()=>{this.toggleNotes(!1)})}).catch(()=>{this.pendingAudioIndex=t,this.toggleNotes(!1),document.addEventListener("pointerdown",this.handleFirstGesture,{once:!0})});return}if(this.currentAudioIndex===t&&this.currentAudio){n&&this.currentAudio.paused&&this.currentAudio.play().catch(()=>this.toggleNotes(!1));return}this.currentAudio&&this.currentAudioIndex!==t&&(this.currentAudio.pause(),this.currentAudio.currentTime=0),this.currentAudio=s,this.currentAudioIndex=t,s.currentTime=0,n||i?(this.toggleNotes(!0),s.play().catch(()=>{this.pendingAudioIndex=t,this.toggleNotes(!1),this.autoplayUnlocked=!1,document.addEventListener("pointerdown",this.handleFirstGesture,{once:!0})})):this.toggleNotes(!1)}stopSong(t=!1){this.currentAudio&&(!t&&this.lockedIndex!==null||(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.currentAudio=null,this.currentAudioIndex=null,this.toggleNotes(!1)))}toggleNotes(t){this.wrapperEl&&(t?this.wrapperEl.classList.add("is-playing"):this.wrapperEl.classList.remove("is-playing"))}mount(){this.mounted=!0}update(){}destroy(){this.stopSong(!0),this.stopAllRingRotation()}handleFirstGesture(){if(!this.autoplayUnlocked&&(this.autoplayUnlocked=!0,this.pendingAudioIndex!=null)){const t=this.pendingAudioIndex;this.pendingAudioIndex=null,this.playSong(t,{autoplay:!0,force:!0})}}}class da extends pt{constructor(){super(),this.container=null,this.data=null,this.state={currentIndex:0,isMoving:!1,isPaused:!0,hasGuessed:!1,currentGuess:"",score:0,totalAttempts:0,revealed:!1},this.options={...mt},this.mounted=!1}async init(t,n={}){if(this.container=typeof t=="string"?document.querySelector(t):t,!this.container)throw new Error(`Container not found: ${t}`);this.options={...this.options,...n},await this.loadData(),this.emit(N.DATA_READY)}async loadData(){this.data=[{id:"duration",label:"Ideal Video Duration ⏱️",answer:"20-30 seconds",hint:"Keep it punchy to maximize completion and replays.",options:["10-15 seconds","45-60 seconds","20-30 seconds","2-3 minutes"]},{id:"popular_sound",label:"Most Popular Sound to Use 🎵",answer:"Anxiety by Doechii",hint:"This track topped the TikTok charts recently.",options:["Streets by Doja Cat","Cold Water by Justin Bieber","Anxiety by Doechii","Cruel Summer by Taylor Swift"]},{id:"danceability_avg",label:"Average Danceability for Sounds 💃",answer:"0.8",hint:"On a 0–1 scale, higher means more groove.",options:["0.4","0.6","0.8","0.2"]},{id:"energy_avg",label:"Average Energy for Sounds ⚡",answer:"0.7",hint:"0–1 scale; think intensity and activity.",options:["0.3","0.5","0.7","0.9"]},{id:"caption_word",label:"What Word to Include in the Caption ✍️",answer:"fyp",hint:"A classic tag to boost discoverability.",options:["pls","linkinbio","omg","fyp"]},{id:"community",label:"Popular TikTok Community 🐾",answer:"pets",hint:"Content that never goes out of style.",options:["finance","origami","pets","meteorology"]}]}mount(){this.mounted||(this.render(),this.setupEventListeners(),this.mounted=!0,this.emit(N.ENTER_COMPLETE))}unmount(){this.mounted&&(this.container.innerHTML="",this.mounted=!1,this.emit(N.EXIT_COMPLETE))}destroy(){this.unmount(),this.data=null,this.state=null,this.events.clear()}update(t,n={}){t===1&&this.startConveyor()}resize(t,n){this.options.width=t,this.options.height=n,this.emit(N.RESIZE)}getState(){return{...this.state}}setState(t){this.state={...this.state,...t},this.emit(N.STATE_CHANGE)}isDataReady(){return this.data!==null}render(){if(!this.data)return;this.container.innerHTML="",this.container.className="conveyor-container";const t=document.createElement("div");t.className="conveyor-header",t.innerHTML=`
      <h3>Guess the Ingredient!</h3>
      <div class="conveyor-score">
        <span class="score-label">Score:</span>
        <span class="score-value">${this.state.score}/${this.data?this.data.length:0}</span>
      </div>
    `,this.container.appendChild(t);const n=document.createElement("div");n.className="conveyor-belt-wrapper";const i=document.createElement("div");i.className="conveyor-belt",i.setAttribute("role","region"),i.setAttribute("aria-label","Conveyor belt with ingredient boxes"),this.data.forEach((o,a)=>{const c=this.createBox(o,a);i.appendChild(c)}),n.appendChild(i),this.container.appendChild(n);const r=this.createInteractionPanel();this.container.appendChild(r);const s=document.createElement("div");s.className="conveyor-controls",s.innerHTML=`
      <button class="btn-primary start-btn" aria-label="Start conveyor belt">
        Start Conveyor
      </button>
      <button class="btn-secondary restart-btn" aria-label="Restart from beginning" style="display:none;">
        Restart
      </button>
    `,this.container.appendChild(s),this.updateBeltPosition()}createBox(t,n){const i=document.createElement("div");i.className="conveyor-box",i.setAttribute("data-index",n),i.setAttribute("data-id",t.id);const r=document.createElement("div");r.className="box-face box-front",r.innerHTML=`
      <div class="box-label">${t.label}</div>
      <div class="box-hint">${t.hint}</div>
      <div class="box-number">#${n+1}</div>
    `;const s=document.createElement("div");return s.className="box-face box-back",s.innerHTML=`
      <div class="box-answer-label">Answer:</div>
      <div class="box-answer">${t.answer}</div>
      <div class="box-checkmark">✓</div>
    `,i.appendChild(r),i.appendChild(s),i}createInteractionPanel(){const t=document.createElement("div");return t.className="interaction-panel",t.style.display="none",t.innerHTML=`
      <div class="current-ingredient">
        <h4 class="ingredient-title"></h4>
        <p class="ingredient-hint"></p>
        <p class="attempts-remaining" aria-live="polite"></p>
      </div>
      
      <div class="options-grid" role="group" aria-label="Answer choices"></div>

      <div class="feedback-area" style="display:none;">
        <div class="feedback-message"></div>
        <button class="btn-secondary reveal-btn" aria-label="Reveal the answer">
          Reveal Answer
        </button>
        <button class="btn-primary next-btn" style="display:none;" aria-label="Move to next ingredient">
          Next →
        </button>
      </div>
    `,t}setupEventListeners(){const t=this.container.querySelector(".start-btn");t==null||t.addEventListener("click",()=>this.startConveyor());const n=this.container.querySelector(".restart-btn");n==null||n.addEventListener("click",()=>this.restart());const i=this.container.querySelector(".interaction-panel");i==null||i.addEventListener("click",o=>{var c;const a=o.target;if(a&&((c=a.classList)!=null&&c.contains("option-btn"))&&!a.disabled){const l=a.getAttribute("data-value");this.submitGuess(l,a)}});const r=this.container.querySelector(".reveal-btn");r==null||r.addEventListener("click",()=>this.revealAnswer());const s=this.container.querySelector(".next-btn");s==null||s.addEventListener("click",()=>this.moveToNext())}updateBeltPosition(){const t=this.container.querySelector(".conveyor-belt");if(!t)return;const n=this.container.querySelector(`.conveyor-box[data-index="${this.state.currentIndex}"]`);if(!n)return;const i=window.getComputedStyle(t),r=i.columnGap||i.gap||"0px",s=parseFloat(r)||0,o=n.getBoundingClientRect().width,a=o+s,c=o/2,l=-(this.state.currentIndex*a);t.style.transform=`translateX(calc(50% - ${c}px + ${l}px))`}startConveyor(){this.state.isPaused=!1,this.state.isMoving=!1;const t=this.container.querySelector(".start-btn");t.style.display="none";const n=this.container.querySelector(".interaction-panel");n.style.display="block",this.showCurrentIngredient();const i=this.container.querySelector(".conveyor-belt");i==null||i.classList.add("active")}showCurrentIngredient(){const t=this.data[this.state.currentIndex];if(!t)return;const n=this.container.querySelector(".ingredient-title"),i=this.container.querySelector(".ingredient-hint"),r=this.container.querySelector(".attempts-remaining");n&&(n.textContent=t.label),i&&(i.textContent=`Hint: ${t.hint}`),this.state.hasGuessed=!1,this.state.revealed=!1,this.state.currentGuess="",this.state.attemptsLeft=3,r&&(r.textContent=`Attempts left: ${this.state.attemptsLeft}`);const s=this.container.querySelector(".options-grid");if(s){s.innerHTML="";const d=t.options&&t.options.length?t.options.slice():this.generateOptions(t.answer);this.shuffle(d).forEach(p=>{const m=document.createElement("button");m.className="option-btn",m.type="button",m.setAttribute("data-value",p),m.textContent=p,s.appendChild(m)})}const o=this.container.querySelector(".feedback-area");o&&(o.style.display="none");const a=this.container.querySelector(".reveal-btn"),c=this.container.querySelector(".next-btn");a&&(a.style.display="none",a.disabled=!0),c&&(c.style.display="none"),this.container.querySelectorAll(".conveyor-box").forEach((d,h)=>{d.classList.toggle("active",h===this.state.currentIndex)});const u=this.container.querySelector(".option-btn");u==null||u.focus()}submitGuess(t,n){if(!t)return;this.state.hasGuessed=!0,this.state.currentGuess=t,n&&(n.disabled=!0);const i=this.data[this.state.currentIndex];if(this.checkAnswer(t,i.answer))this.state.score++,this.showFeedback(`🎉 Correct! "${i.answer}"`,"correct"),this.disableAllOptions(),setTimeout(()=>this.revealAnswer(),1e3);else{this.state.attemptsLeft=Math.max(0,(this.state.attemptsLeft||1)-1);const o=this.container.querySelector(".attempts-remaining");if(o&&(o.textContent=`Attempts left: ${this.state.attemptsLeft}`),this.state.attemptsLeft>0)this.showFeedback("Not quite! Try again.","incorrect");else{this.showFeedback("Out of attempts. You can reveal the answer.","warning"),this.disableAllOptions();const a=this.container.querySelector(".reveal-btn");a&&(a.style.display="inline-block",a.disabled=!1)}}this.updateScore();const s=this.container.querySelector(".feedback-area");s.style.display="block"}disableAllOptions(){this.container.querySelectorAll(".option-btn").forEach(n=>n.disabled=!0)}shuffle(t){for(let n=t.length-1;n>0;n--){const i=Math.floor(Math.random()*(n+1));[t[n],t[i]]=[t[i],t[n]]}return t}generateOptions(t){const n=this.data.map(r=>r.answer).filter(r=>r&&r!==t),i=this.shuffle(n).slice(0,3);return this.shuffle([t,...i])}checkAnswer(t,n){const i=o=>o.toLowerCase().replace(/[^a-z0-9]/g,""),r=i(t),s=i(n);return s.includes(r)||r.includes(s)||r===s}showFeedback(t,n){const i=this.container.querySelector(".feedback-message");i&&(i.textContent=t,i.className=`feedback-message feedback-${n}`)}revealAnswer(){if(this.state.revealed)return;const t=this.data[this.state.currentIndex];if(!this.checkAnswer(this.state.currentGuess||"",t.answer)&&(this.state.attemptsLeft??0)>0){this.showFeedback("Take up to 3 attempts before revealing.","warning");return}this.state.revealed=!0;const i=this.container.querySelector(`.conveyor-box[data-index="${this.state.currentIndex}"]`);i&&i.classList.add("flipped");const r=this.container.querySelector(".reveal-btn"),s=this.container.querySelector(".next-btn");r&&(r.style.display="none"),s&&(s.style.display="inline-block",this.state.currentIndex>=this.data.length-1?s.textContent="Finish":s.textContent="Next →")}moveToNext(){if(this.state.currentIndex>=this.data.length-1){this.finish();return}const t=this.container.querySelector(`.conveyor-box[data-index="${this.state.currentIndex}"]`);t&&t.classList.remove("active"),this.state.currentIndex++,this.state.isMoving=!0,this.updateBeltPosition(),setTimeout(()=>{this.state.isMoving=!1,this.showCurrentIngredient()},600)}finish(){const t=this.container.querySelector(".interaction-panel");t.innerHTML=`
      <div class="completion-message">
        <h3>🎊 Complete!</h3>
        <p class="final-score">Your Score: ${this.state.score}/${this.data?this.data.length:0}</p>
        <p class="score-message">${this.getScoreMessage()}</p>
      </div>
    `;const n=this.container.querySelector(".restart-btn");n&&(n.style.display="inline-block")}getScoreMessage(){const t=this.data?this.data.length:1,n=this.state.score/t*100;return n===100?"🌟 Perfect! You know your TikTok ingredients!":n>=80?"🔥 Excellent! You're ready to go viral!":n>=60?"👍 Good job! Keep learning!":n>=40?"💪 Not bad! Study the trends more!":"📚 Keep practicing! Every creator starts somewhere!"}updateScore(){const t=this.container.querySelector(".score-value");t&&(t.textContent=`${this.state.score}/${this.data?this.data.length:0}`)}restart(){this.state={currentIndex:0,isMoving:!1,isPaused:!0,hasGuessed:!1,currentGuess:"",score:0,totalAttempts:0,revealed:!1},this.container.querySelectorAll(".conveyor-box").forEach(n=>n.classList.remove("flipped","active")),this.render(),this.setupEventListeners()}}class ha{constructor(t){this.container=t,this.overlay=null,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.init()}init(){this.overlay=document.createElement("div"),this.overlay.className="comet-overlay",this.overlay.style.cssText="position:absolute;inset:0;pointer-events:none;overflow:hidden;",this.container.appendChild(this.overlay)}spawn(){if(this.prefersReducedMotion){this.container.style.transition="box-shadow 200ms ease-out",this.container.style.boxShadow="0 0 40px rgba(0, 255, 224, 0.5)",setTimeout(()=>{this.container.style.boxShadow=""},200);return}const t=document.createElement("div");t.className="comet",this.overlay.appendChild(t),requestAnimationFrame(()=>{t.style.transform="translate(-120%, 120%) rotate(-20deg)",t.style.opacity="0"}),setTimeout(()=>t.remove(),500)}}class fa{constructor(t,n){this.tray=t,this.network=n,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.init()}init(){if(!this.tray)return;this.tray.querySelectorAll(".audio-item").forEach(n=>{n.addEventListener("mouseenter",()=>this.onHover(n)),n.addEventListener("mouseleave",()=>this.onLeave(n))})}onHover(t){const n=t.querySelector(".sound-icon");n&&!this.prefersReducedMotion&&(n.style.transition="transform 200ms cubic-bezier(0.4, 0.0, 0.2, 1)",n.style.transform="rotate(-5deg)"),this.network&&this.network.classList.add("sound-active")}onLeave(t){const n=t.querySelector(".sound-icon");n&&!this.prefersReducedMotion&&(n.style.transform="rotate(0deg)"),this.network&&this.network.classList.remove("sound-active")}}class pa{constructor(t){this.container=t,this.hasTriggered=!1,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches}trigger(){if(!this.hasTriggered){if(this.hasTriggered=!0,this.prefersReducedMotion){const t=this.container.querySelector(".detail-panel");t&&(t.style.transition="opacity 400ms ease-in",t.style.opacity="1");return}for(let t=0;t<2;t++)this.spawnHintLeaf(t)}}spawnHintLeaf(t){const n=document.createElement("div");n.className="hint-leaf",n.style.cssText=`
      position: absolute;
      top: ${20+t*10}%;
      left: ${30+t*20}%;
      width: 12px;
      height: 12px;
      background: rgba(139, 195, 74, 0.6);
      border-radius: 50% 0;
      transform: translateY(-20px) rotate(45deg);
      opacity: 0;
      transition: all 200ms ease-out;
      pointer-events: none;
    `,this.container.appendChild(n),requestAnimationFrame(()=>{n.style.transform="translateY(12px) rotate(65deg)",n.style.opacity="0.7"}),setTimeout(()=>{n.style.opacity="0",setTimeout(()=>n.remove(),200)},1500)}}class ma{constructor(t){this.container=t,this.prefersReducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.throttleTimer=null,this.init()}init(){this.container&&this.container.addEventListener("mousemove",t=>{this.throttleTimer||(this.throttleTimer=setTimeout(()=>{this.onMouseMove(t),this.throttleTimer=null},100))})}onMouseMove(t){const n=this.container.querySelectorAll('.bubble, circle[data-type="bubble"]');if(!n.length)return;const i=t.clientX,r=t.clientY,s=Array.from(n).map(a=>{const c=a.getBoundingClientRect(),l=c.left+c.width/2,u=c.top+c.height/2,d=Math.hypot(l-i,u-r);return{bubble:a,distance:d}});s.sort((a,c)=>a.distance-c.distance);const o=s.slice(0,3);this.prefersReducedMotion?o.forEach(({bubble:a})=>{const c=a.getAttribute("stroke")||"#00FFE0";a.style.transition="stroke 150ms ease-out",a.setAttribute("stroke","#FFFFFF"),setTimeout(()=>{a.setAttribute("stroke",c)},150)}):o.forEach(({bubble:a})=>{n.forEach(c=>{c.style.transition="transform 150ms ease-out",c.style.transform="scale(1)"}),a.style.transform="scale(1.03)",setTimeout(()=>{a.style.transform="scale(1)"},150)})}}function ga(){const e=document.querySelector("#viz-planets");if(e){const a=new ha(e);e.addEventListener("click",()=>{a.spawn()}),e.addEventListener("artist-highlight",()=>{a.spawn()}),console.log("[MicroInteraction] Planets comet ready - click anywhere in viz")}const t=document.querySelector(".audio-tray"),n=document.querySelector("#viz-community");t&&n&&(new fa(t,n),console.log("[MicroInteraction] Audio tray effects ready"));const i=document.querySelector("#section-fade"),r=document.querySelector("#viz-ranking");if(i&&r){const a=new pa(i),c=new IntersectionObserver(l=>{l.forEach(u=>{u.isIntersecting&&(a.trigger(),c.disconnect(),console.log("[MicroInteraction] Ranking leaf hint triggered"))})},{threshold:.3});c.observe(i),r.addEventListener("click",()=>{const l=i.querySelector(".detail-panel");l&&l.getAttribute("aria-hidden")==="true"&&(l.setAttribute("aria-hidden","false"),l.style.opacity="1",console.log("[MicroInteraction] Ranking detail panel opened"))},{once:!0})}const s=document.querySelector("#section-takeaway"),o=document.querySelector("#viz-emotion");if(s&&o){new ma(o);const a=new IntersectionObserver(c=>{c.forEach(l=>{l.isIntersecting&&(setTimeout(()=>{const u=o.querySelectorAll('.bubble, circle[data-type="bubble"], circle'),d=Array.from(u).slice(0,3);if(d.length>0){const h=window.matchMedia("(prefers-reduced-motion: reduce)").matches;d.forEach(p=>{if(h){const m=p.getAttribute("stroke")||"#00FFE0";p.style.transition="stroke 300ms ease-out",p.setAttribute("stroke","#FFFFFF"),setTimeout(()=>{p.setAttribute("stroke",m)},300)}else p.style.transition="transform 300ms ease-out",p.style.transform="scale(1.05)",setTimeout(()=>{p.style.transform="scale(1)"},300)}),console.log("[MicroInteraction] Emotion bubble breathe pulse triggered")}},500),a.disconnect())})},{threshold:.4});a.observe(s)}}const k="http://www.w3.org/2000/svg";function ya(){const e=document.createElementNS(k,"svg");e.setAttribute("viewBox","0 0 1440 400"),e.setAttribute("class","illu illu-forest"),e.setAttribute("aria-hidden","true");const t=document.createElementNS(k,"defs"),n=document.createElementNS(k,"linearGradient");n.setAttribute("id","trunkGradient"),n.setAttribute("x1","0%"),n.setAttribute("y1","0%"),n.setAttribute("x2","100%"),n.setAttribute("y2","0%");const i=document.createElementNS(k,"stop");i.setAttribute("offset","0%"),i.setAttribute("stop-color","#3d2817");const r=document.createElementNS(k,"stop");r.setAttribute("offset","50%"),r.setAttribute("stop-color","#5a3d26");const s=document.createElementNS(k,"stop");s.setAttribute("offset","100%"),s.setAttribute("stop-color","#2d1f12"),n.append(i,r,s),t.appendChild(n);const o=document.createElementNS(k,"linearGradient");o.setAttribute("id","leafGradient"),o.setAttribute("x1","0%"),o.setAttribute("y1","0%"),o.setAttribute("x2","0%"),o.setAttribute("y2","100%");const a=document.createElementNS(k,"stop");a.setAttribute("offset","0%"),a.setAttribute("stop-color","#4a8c5a");const c=document.createElementNS(k,"stop");c.setAttribute("offset","50%"),c.setAttribute("stop-color","#3a7549");const l=document.createElementNS(k,"stop");l.setAttribute("offset","100%"),l.setAttribute("stop-color","#2d5d38"),o.append(a,c,l),t.appendChild(o);const u=document.createElementNS(k,"radialGradient");u.setAttribute("id","cloudGradient"),u.setAttribute("cx","40%"),u.setAttribute("cy","30%");const d=document.createElementNS(k,"stop");d.setAttribute("offset","0%"),d.setAttribute("stop-color","#d8e8e0"),d.setAttribute("stop-opacity","0.5");const h=document.createElementNS(k,"stop");h.setAttribute("offset","60%"),h.setAttribute("stop-color","#c0d5d0"),h.setAttribute("stop-opacity","0.4");const p=document.createElementNS(k,"stop");p.setAttribute("offset","100%"),p.setAttribute("stop-color","#a8c068"),p.setAttribute("stop-opacity","0.3"),u.append(d,h,p),t.appendChild(u);const m=document.createElementNS(k,"linearGradient");m.setAttribute("id","mountainGradient"),m.setAttribute("x1","0%"),m.setAttribute("y1","0%"),m.setAttribute("x2","0%"),m.setAttribute("y2","100%");const g=document.createElementNS(k,"stop");g.setAttribute("offset","0%"),g.setAttribute("stop-color","#2d5540");const b=document.createElementNS(k,"stop");b.setAttribute("offset","100%"),b.setAttribute("stop-color","#1f3d2e"),m.append(g,b),t.appendChild(m);const f=document.createElementNS(k,"linearGradient");f.setAttribute("id","ridgeGradient"),f.setAttribute("x1","0%"),f.setAttribute("y1","0%"),f.setAttribute("x2","0%"),f.setAttribute("y2","100%");const y=document.createElementNS(k,"stop");y.setAttribute("offset","0%"),y.setAttribute("stop-color","#3a5d48");const v=document.createElementNS(k,"stop");v.setAttribute("offset","100%"),v.setAttribute("stop-color","#284535"),f.append(y,v),t.appendChild(f);const M=document.createElementNS(k,"linearGradient");M.setAttribute("id","groundGradient"),M.setAttribute("x1","0%"),M.setAttribute("y1","0%"),M.setAttribute("x2","0%"),M.setAttribute("y2","100%");const w=document.createElementNS(k,"stop");w.setAttribute("offset","0%"),w.setAttribute("stop-color","#3d6048");const A=document.createElementNS(k,"stop");A.setAttribute("offset","100%"),A.setAttribute("stop-color","#2a4535"),M.append(w,A),t.appendChild(M);const x=document.createElementNS(k,"radialGradient");x.setAttribute("id","bushGradient");const C=document.createElementNS(k,"stop");C.setAttribute("offset","0%"),C.setAttribute("stop-color","#4a7555");const q=document.createElementNS(k,"stop");q.setAttribute("offset","100%"),q.setAttribute("stop-color","#2f5038"),x.append(C,q),t.appendChild(x);const R=document.createElementNS(k,"filter");R.setAttribute("id","dropShadow"),R.setAttribute("x","-50%"),R.setAttribute("y","-50%"),R.setAttribute("width","200%"),R.setAttribute("height","200%");const E=document.createElementNS(k,"feGaussianBlur");E.setAttribute("in","SourceAlpha"),E.setAttribute("stdDeviation","2");const P=document.createElementNS(k,"feOffset");P.setAttribute("dx","2"),P.setAttribute("dy","3"),P.setAttribute("result","offsetblur");const z=document.createElementNS(k,"feFlood");z.setAttribute("flood-color","#000000"),z.setAttribute("flood-opacity","0.3");const X=document.createElementNS(k,"feComposite");X.setAttribute("in2","offsetblur"),X.setAttribute("operator","in");const K=document.createElementNS(k,"feMerge"),W=document.createElementNS(k,"feMergeNode"),U=document.createElementNS(k,"feMergeNode");U.setAttribute("in","SourceGraphic"),K.append(W,U),R.append(E,P,z,X,K),t.appendChild(R),e.appendChild(t);function I(_,$,L=1){const D=document.createElementNS(k,"g");D.setAttribute("class","forest-cloud"),D.style.opacity=String(.3+Math.random()*.2),D.setAttribute("filter","url(#dropShadow)");const O=document.createElementNS(k,"ellipse");O.setAttribute("cx",String(_)),O.setAttribute("cy",String($)),O.setAttribute("rx",String(40*L)),O.setAttribute("ry",String(20*L)),O.setAttribute("fill","url(#cloudGradient)");const H=document.createElementNS(k,"ellipse");H.setAttribute("cx",String(_-25*L)),H.setAttribute("cy",String($+5*L)),H.setAttribute("rx",String(30*L)),H.setAttribute("ry",String(18*L)),H.setAttribute("fill","url(#cloudGradient)");const J=document.createElementNS(k,"ellipse");return J.setAttribute("cx",String(_+28*L)),J.setAttribute("cy",String($+3*L)),J.setAttribute("rx",String(35*L)),J.setAttribute("ry",String(22*L)),J.setAttribute("fill","url(#cloudGradient)"),D.append(O,H,J),D}e.appendChild(I(200,80,1.2)),e.appendChild(I(600,120,.9)),e.appendChild(I(950,60,1.1)),e.appendChild(I(1300,100,.8));function S(_,$,L){const D=document.createElementNS(k,"path");return D.setAttribute("d",`M${_} ${$} q-8 -6 -12 0 q8 -5 12 0 q4 -5 12 0 q-8 6 -12 0`),D.setAttribute("class","forest-bird"),D.style.animationDelay=`${L}s`,D}for(let _=0;_<12;_++){const $=150+_*110,L=80+_%3*30+Math.random()*20;e.appendChild(S($,L,_*.5))}const G=document.createElementNS(k,"path");G.setAttribute("d","M0 240 L180 180 L280 200 L420 150 L560 170 L720 130 L880 160 L1040 140 L1200 170 L1360 150 L1440 180 L1440 400 L0 400 Z"),G.setAttribute("class","forest-mountains"),G.setAttribute("fill","url(#mountainGradient)"),G.setAttribute("filter","url(#dropShadow)"),e.appendChild(G);const B=document.createElementNS(k,"path");B.setAttribute("d","M0,260 C180,220 320,240 520,230 C760,215 980,250 1200,230 C1320,220 1440,240 1440,400 L0,400 Z"),B.setAttribute("class","forest-ridge"),B.setAttribute("fill","url(#ridgeGradient)"),B.setAttribute("filter","url(#dropShadow)"),e.appendChild(B);const F=document.createElementNS(k,"rect");F.setAttribute("x","0"),F.setAttribute("y","300"),F.setAttribute("width","1440"),F.setAttribute("height","100"),F.setAttribute("class","forest-ground"),F.setAttribute("fill","url(#groundGradient)"),e.appendChild(F);for(let _=0;_<1440;_+=80){const $=document.createElementNS(k,"ellipse");$.setAttribute("cx",String(_+20+Math.random()*40)),$.setAttribute("cy","300"),$.setAttribute("rx",String(25+Math.random()*15)),$.setAttribute("ry",String(12+Math.random()*8)),$.setAttribute("class","forest-bush"),$.setAttribute("fill","url(#bushGradient)"),$.setAttribute("filter","url(#dropShadow)"),e.appendChild($)}function V(_,$,L,D=1){const O=document.createElementNS(k,"g");O.setAttribute("class","pine sway"),O.style.opacity=String(D),O.setAttribute("filter","url(#dropShadow)");const H=document.createElementNS(k,"rect");H.setAttribute("x",String(_-5)),H.setAttribute("y",String($-L*.2)),H.setAttribute("width","10"),H.setAttribute("height",String(L*.25)),H.setAttribute("rx","2"),H.setAttribute("class","trunk"),H.setAttribute("fill","url(#trunkGradient)");const J=document.createElementNS(k,"polygon");J.setAttribute("points",`${_},${$-L} ${_-18},${$-L*.65} ${_+18},${$-L*.65}`),J.setAttribute("class","leaf"),J.setAttribute("fill","url(#leafGradient)");const Lt=document.createElementNS(k,"polygon");Lt.setAttribute("points",`${_},${$-L*.75} ${_-26},${$-L*.45} ${_+26},${$-L*.45}`),Lt.setAttribute("class","leaf"),Lt.setAttribute("fill","url(#leafGradient)");const Rt=document.createElementNS(k,"polygon");return Rt.setAttribute("points",`${_},${$-L*.5} ${_-32},${$-L*.2} ${_+32},${$-L*.2}`),Rt.setAttribute("class","leaf"),Rt.setAttribute("fill","url(#leafGradient)"),O.append(H,J,Lt,Rt),O}for(let _=30;_<1440;_+=35){const $=80+_*7%30;e.appendChild(V(_,280,$,.4))}for(let _=50;_<1440;_+=60){const $=110+_*13%40;e.appendChild(V(_,310,$,.7))}for(let _=25;_<1440;_+=90){const $=140+_*17%35;e.appendChild(V(_+15,340,$,.95))}return e}const Y="http://www.w3.org/2000/svg";function ba(){const e=document.createElementNS(Y,"svg");e.setAttribute("viewBox","0 0 1440 360"),e.setAttribute("class","illu illu-city"),e.setAttribute("aria-hidden","true");const t=document.createElementNS(Y,"circle");t.setAttribute("cx","1320"),t.setAttribute("cy","80"),t.setAttribute("r","35"),t.setAttribute("class","city-moon"),e.appendChild(t);const n=document.createElementNS(Y,"circle");n.setAttribute("cx","1320"),n.setAttribute("cy","80"),n.setAttribute("r","50"),n.setAttribute("class","city-moon-glow"),e.appendChild(n);const i=document.createElementNS(Y,"path");i.setAttribute("d","M0 200 L120 180 L180 190 L280 160 L380 175 L480 155 L600 170 L720 145 L840 165 L960 150 L1080 170 L1200 155 L1320 175 L1440 165 L1440 360 L0 360 Z"),i.setAttribute("class","city-distant"),e.appendChild(i);for(let o=0;o<1440;o+=52){const a=200+o*37%120,c=document.createElementNS(Y,"rect");if(c.setAttribute("x",String(o+6)),c.setAttribute("y",String(360-a)),c.setAttribute("width","40"),c.setAttribute("height",String(a)),c.setAttribute("rx","2"),c.setAttribute("class","bldg"),e.appendChild(c),a>280&&o%208===0){const l=document.createElementNS(Y,"line");l.setAttribute("x1",String(o+26)),l.setAttribute("y1",String(360-a)),l.setAttribute("x2",String(o+26)),l.setAttribute("y2",String(360-a-40)),l.setAttribute("class","city-antenna"),e.appendChild(l);const u=document.createElementNS(Y,"circle");u.setAttribute("cx",String(o+26)),u.setAttribute("cy",String(360-a-40)),u.setAttribute("r","3"),u.setAttribute("class","city-antenna-light"),e.appendChild(u)}if(a>250&&o%156===0){const l=document.createElementNS(Y,"rect");l.setAttribute("x",String(o+14)),l.setAttribute("y",String(360-a+20)),l.setAttribute("width","18"),l.setAttribute("height","14"),l.setAttribute("class","city-neon"),l.style.animationDelay=`${o%5/10}s`,e.appendChild(l)}for(let l=360-a+18;l<342;l+=20){if((l+o)%3!==0)continue;const u=document.createElementNS(Y,"rect");u.setAttribute("x",String(o+14)),u.setAttribute("y",String(l)),u.setAttribute("width","6"),u.setAttribute("height","8"),u.setAttribute("class","win twinkle"),u.style.animationDelay=`${(o+l)%7/10}s`,e.appendChild(u)}}for(let o=80;o<1440;o+=160){const a=document.createElementNS(Y,"rect");a.setAttribute("x",String(o-2)),a.setAttribute("y","320"),a.setAttribute("width","4"),a.setAttribute("height","40"),a.setAttribute("class","city-lamp-post"),e.appendChild(a);const c=document.createElementNS(Y,"ellipse");c.setAttribute("cx",String(o)),c.setAttribute("cy","318"),c.setAttribute("rx","10"),c.setAttribute("ry","6"),c.setAttribute("class","city-lamp"),e.appendChild(c);const l=document.createElementNS(Y,"ellipse");l.setAttribute("cx",String(o)),l.setAttribute("cy","325"),l.setAttribute("rx","20"),l.setAttribute("ry","15"),l.setAttribute("class","city-lamp-glow"),e.appendChild(l)}const r=document.createElementNS(Y,"rect");r.setAttribute("x","0"),r.setAttribute("y","356"),r.setAttribute("width","1440"),r.setAttribute("height","4"),r.setAttribute("class","city-ground"),e.appendChild(r);for(let o=0;o<3;o++){const a=document.createElementNS(Y,"ellipse");a.setAttribute("cx",String(200+o*450)),a.setAttribute("cy","340"),a.setAttribute("rx",String(350+o*50)),a.setAttribute("ry",String(30+o*10)),a.setAttribute("class","city-fog"),a.style.opacity=String(.08-o*.02),a.style.animationDelay=`${o*1.5}s`,e.appendChild(a)}function s(o,a,c){const l=document.createElementNS(Y,"g");l.setAttribute("class","city-meteor"),l.style.animationDelay=`${c}s`;const u=document.createElementNS(Y,"line");u.setAttribute("x1",String(o)),u.setAttribute("y1",String(a)),u.setAttribute("x2",String(o+120)),u.setAttribute("y2",String(a+70)),u.setAttribute("stroke","#ffffff"),u.setAttribute("stroke-width","4"),u.setAttribute("stroke-linecap","round"),u.setAttribute("opacity","0.95"),l.appendChild(u);const d=document.createElementNS(Y,"circle");d.setAttribute("cx",String(o)),d.setAttribute("cy",String(a)),d.setAttribute("r","5"),d.setAttribute("fill","#ffffff"),d.setAttribute("class","meteor-head-sparkle"),l.appendChild(d);const h=document.createElementNS(Y,"circle");h.setAttribute("cx",String(o)),h.setAttribute("cy",String(a)),h.setAttribute("r","18"),h.setAttribute("fill","rgba(255, 255, 255, 0.6)"),h.setAttribute("class","meteor-glow-sparkle"),l.appendChild(h);for(let p=0;p<5;p++){const m=document.createElementNS(Y,"circle");m.setAttribute("cx",String(o+20+p*20)),m.setAttribute("cy",String(a+12+p*12)),m.setAttribute("r","2.5"),m.setAttribute("fill","#ffffff"),m.setAttribute("class","meteor-trail-sparkle"),m.style.animationDelay=`${p*.15}s`,l.appendChild(m)}return l}return e.appendChild(s(350,15,0)),e.appendChild(s(750,10,2.5)),e.appendChild(s(1100,20,4)),e}const T="http://www.w3.org/2000/svg";function va(){const e=document.createElementNS(T,"svg");e.setAttribute("viewBox","0 0 1440 360"),e.setAttribute("class","illu illu-lab"),e.setAttribute("aria-hidden","true");const t=document.createElementNS(T,"defs"),n=document.createElementNS(T,"pattern");n.setAttribute("id","greenStripes"),n.setAttribute("patternUnits","userSpaceOnUse"),n.setAttribute("width","8"),n.setAttribute("height","360");for(let I=0;I<360;I+=30){const S=document.createElementNS(T,"rect");S.setAttribute("x","0"),S.setAttribute("y",String(I)),S.setAttribute("width","8"),S.setAttribute("height","20"),S.setAttribute("fill","rgba(0, 255, 180, 0.15)"),S.setAttribute("class","lab-stripe"),S.style.animationDelay=`${I*.01}s`,n.appendChild(S)}t.appendChild(n);const i=document.createElementNS(T,"filter");i.setAttribute("id","labGlow");const r=document.createElementNS(T,"feGaussianBlur");r.setAttribute("stdDeviation","4"),r.setAttribute("result","coloredBlur");const s=document.createElementNS(T,"feMerge"),o=document.createElementNS(T,"feMergeNode");o.setAttribute("in","coloredBlur");const a=document.createElementNS(T,"feMergeNode");a.setAttribute("in","SourceGraphic"),s.append(o,a),i.append(r,s),t.appendChild(i);const c=document.createElementNS(T,"linearGradient");c.setAttribute("id","liquidGradient"),c.setAttribute("x1","0%"),c.setAttribute("y1","0%"),c.setAttribute("x2","0%"),c.setAttribute("y2","100%");const l=document.createElementNS(T,"stop");l.setAttribute("offset","0%"),l.setAttribute("stop-color","#00ffcc");const u=document.createElementNS(T,"stop");u.setAttribute("offset","100%"),u.setAttribute("stop-color","#00ccff"),c.append(l,u),t.appendChild(c);const d=document.createElementNS(T,"linearGradient");d.setAttribute("id","benchGradient"),d.setAttribute("x1","0%"),d.setAttribute("y1","0%"),d.setAttribute("x2","0%"),d.setAttribute("y2","100%");const h=document.createElementNS(T,"stop");h.setAttribute("offset","0%"),h.setAttribute("stop-color","#1a2530");const p=document.createElementNS(T,"stop");p.setAttribute("offset","50%"),p.setAttribute("stop-color","#0b1116");const m=document.createElementNS(T,"stop");m.setAttribute("offset","100%"),m.setAttribute("stop-color","#060a0d"),d.append(h,p,m),t.appendChild(d),e.appendChild(t);const g=document.createElementNS(T,"rect");g.setAttribute("x","0"),g.setAttribute("y","0"),g.setAttribute("width","1440"),g.setAttribute("height","360"),g.setAttribute("fill","url(#greenStripes)"),g.setAttribute("opacity","0.8"),e.appendChild(g);const b=document.createElementNS(T,"g");b.setAttribute("transform","translate(620, 80)"),b.setAttribute("filter","url(#labGlow)");const f=document.createElementNS(T,"path");f.setAttribute("d","M40 10 L160 10 L160 15 L155 15 L150 185 L145 195 L55 195 L50 185 L45 15 L40 15 Z"),f.setAttribute("fill","rgba(77, 255, 255, 0.05)"),f.setAttribute("stroke","#4dffff"),f.setAttribute("stroke-width","4"),f.setAttribute("opacity","1"),b.appendChild(f);const y=document.createElementNS(T,"rect");y.setAttribute("x","40"),y.setAttribute("y","10"),y.setAttribute("width","120"),y.setAttribute("height","5"),y.setAttribute("fill","rgba(77, 255, 255, 0.4)"),y.setAttribute("rx","2"),b.appendChild(y);const v=document.createElementNS(T,"rect");v.setAttribute("x","48"),v.setAttribute("y","120"),v.setAttribute("width","106"),v.setAttribute("height","75"),v.setAttribute("rx","8"),v.setAttribute("fill","url(#liquidGradient)"),v.setAttribute("opacity","0.7"),v.setAttribute("class","lab-liquid-glow"),b.appendChild(v);for(let I=0;I<12;I++){const S=document.createElementNS(T,"circle");S.setAttribute("cx",String(70+Math.random()*60)),S.setAttribute("cy",String(190)),S.setAttribute("r",String(3+Math.random()*4)),S.setAttribute("fill","rgba(100, 255, 255, 0.8)"),S.setAttribute("class","lab-bubble"),S.setAttribute("filter","url(#labGlow)"),S.style.animationDelay=`${I*.2}s`,b.appendChild(S)}e.appendChild(b);function M(I,S,G,B){const F=document.createElementNS(T,"g");F.setAttribute("class","lab-molecule"),F.setAttribute("filter","url(#labGlow)"),F.style.animationDelay=`${B}s`;const V=document.createElementNS(T,"circle");return V.setAttribute("cx",String(I)),V.setAttribute("cy",String(S)),V.setAttribute("r","12"),V.setAttribute("fill",G),V.setAttribute("opacity","0.9"),F.appendChild(V),[0,120,240].forEach(_=>{const $=_*Math.PI/180,L=I+Math.cos($)*35,D=S+Math.sin($)*35,O=document.createElementNS(T,"line");O.setAttribute("x1",String(I)),O.setAttribute("y1",String(S)),O.setAttribute("x2",String(L)),O.setAttribute("y2",String(D)),O.setAttribute("stroke",G),O.setAttribute("stroke-width","2"),O.setAttribute("opacity","0.6"),F.appendChild(O);const H=document.createElementNS(T,"circle");H.setAttribute("cx",String(L)),H.setAttribute("cy",String(D)),H.setAttribute("r","8"),H.setAttribute("fill",G),H.setAttribute("opacity","0.85"),F.appendChild(H)}),F}e.appendChild(M(180,100,"#ff66ff",0)),e.appendChild(M(1260,120,"#66ffff",1.5)),e.appendChild(M(300,220,"#ffff66",.8));function w(I,S,G){const B=document.createElementNS(T,"g");B.setAttribute("class","lab-dna"),B.setAttribute("filter","url(#labGlow)");for(let F=0;F<8;F++){const V=S+F*18,_=Math.sin(F*.6)*15,$=document.createElementNS(T,"circle");$.setAttribute("cx",String(I+_)),$.setAttribute("cy",String(V)),$.setAttribute("r","4"),$.setAttribute("fill",G),$.setAttribute("opacity","0.9"),B.appendChild($);const L=document.createElementNS(T,"circle");L.setAttribute("cx",String(I-_)),L.setAttribute("cy",String(V)),L.setAttribute("r","4"),L.setAttribute("fill",G),L.setAttribute("opacity","0.9"),B.appendChild(L);const D=document.createElementNS(T,"line");D.setAttribute("x1",String(I+_)),D.setAttribute("y1",String(V)),D.setAttribute("x2",String(I-_)),D.setAttribute("y2",String(V)),D.setAttribute("stroke",G),D.setAttribute("stroke-width","2"),D.setAttribute("opacity","0.7"),B.appendChild(D)}return B}e.appendChild(w(450,60,"#ff6699")),e.appendChild(w(990,80,"#66ff99"));const A=document.createElementNS(T,"g");A.setAttribute("transform","translate(1080, 180)"),A.setAttribute("filter","url(#labGlow)");const x=document.createElementNS(T,"ellipse");x.setAttribute("cx","50"),x.setAttribute("cy","115"),x.setAttribute("rx","45"),x.setAttribute("ry","8"),x.setAttribute("fill","#555"),A.appendChild(x);const C=document.createElementNS(T,"rect");C.setAttribute("x","45"),C.setAttribute("y","35"),C.setAttribute("width","10"),C.setAttribute("height","80"),C.setAttribute("fill","#666"),A.appendChild(C);const q=document.createElementNS(T,"rect");q.setAttribute("x","25"),q.setAttribute("y","70"),q.setAttribute("width","50"),q.setAttribute("height","5"),q.setAttribute("fill","#777"),A.appendChild(q);const R=document.createElementNS(T,"rect");R.setAttribute("x","42"),R.setAttribute("y","10"),R.setAttribute("width","16"),R.setAttribute("height","30"),R.setAttribute("fill","#555"),R.setAttribute("rx","2"),A.appendChild(R);const E=document.createElementNS(T,"circle");E.setAttribute("cx","50"),E.setAttribute("cy","8"),E.setAttribute("r","6"),E.setAttribute("fill","#333"),E.setAttribute("stroke","#66ffff"),E.setAttribute("stroke-width","2"),A.appendChild(E);const P=document.createElementNS(T,"circle");P.setAttribute("cx","50"),P.setAttribute("cy","42"),P.setAttribute("r","7"),P.setAttribute("fill","#444"),P.setAttribute("stroke","#ff66ff"),P.setAttribute("stroke-width","2"),A.appendChild(P);const z=document.createElementNS(T,"polygon");z.setAttribute("points","45,75 55,75 60,90 40,90"),z.setAttribute("fill","rgba(255, 235, 150, 0.5)"),z.setAttribute("class","lab-micro-light"),A.appendChild(z),e.appendChild(A);for(let I=0;I<20;I++){const S=document.createElementNS(T,"circle");S.setAttribute("cx",String(50+Math.random()*1340)),S.setAttribute("cy",String(20+Math.random()*280)),S.setAttribute("r",String(3+Math.random()*3));const G=["#ff66ff","#66ffff","#ffff66","#ff6699","#66ff99"];S.setAttribute("fill",G[Math.floor(Math.random()*G.length)]),S.setAttribute("class","lab-particle"),S.setAttribute("filter","url(#labGlow)"),S.style.animationDelay=`${Math.random()*4}s`,e.appendChild(S)}const X=document.createElementNS(T,"g"),K=document.createElementNS(T,"rect");K.setAttribute("x","0"),K.setAttribute("y","330"),K.setAttribute("width","1440"),K.setAttribute("height","50"),K.setAttribute("fill","url(#benchGradient)"),K.setAttribute("opacity","0.95"),X.appendChild(K);const W=document.createElementNS(T,"rect");W.setAttribute("x","0"),W.setAttribute("y","330"),W.setAttribute("width","1440"),W.setAttribute("height","3"),W.setAttribute("fill","rgba(100, 150, 180, 0.3)"),X.appendChild(W);const U=document.createElementNS(T,"rect");return U.setAttribute("x","0"),U.setAttribute("y","375"),U.setAttribute("width","1440"),U.setAttribute("height","12"),U.setAttribute("fill","rgba(0, 0, 0, 0.6)"),X.appendChild(U),e.appendChild(X),e}const gt="http://www.w3.org/2000/svg",Je={forest:{hostId:"section-fade",factory:ya},city:{hostId:"section-spillover",factory:ba},lab:{hostId:"section-ingredients",factory:va}};let at={node:null};function wa(){console.log("[Illustrations] Installing illustration system..."),Aa(),console.log("[Illustrations] Setting up MutationObserver for body[data-scene]"),new MutationObserver(()=>{console.log("[Illustrations] Scene attribute changed"),tn()}).observe(document.body,{attributes:!0,attributeFilter:["data-scene"]}),console.log("[Illustrations] Initial render..."),tn()}function Aa(){console.log("[Illustrations] Ensuring illustration hosts (sections)..."),["section-fade","section-spillover","section-takeaway","section-ingredients"].forEach(e=>{const t=document.getElementById(e);if(!t){console.warn(`[Illustrations] Section #${e} not found!`);return}if(console.log(`[Illustrations] Found section #${e}`),t.style.position=t.style.position||"relative",t.querySelector(".scene-illustration"))console.log(`[Illustrations] .scene-illustration already exists in section #${e}`);else{const n=document.createElement("div");n.className="scene-illustration",n.setAttribute("aria-hidden","true"),n.style.cssText="position:absolute;inset:0;pointer-events:none;z-index:0;overflow:visible;",t.prepend(n),console.log(`[Illustrations] Created .scene-illustration in section #${e}`)}})}function tn(){const e=document.body.dataset.scene;if(console.log(`[Illustrations] renderIllustration called, scene=${e}`),!e||!Je[e]){console.log(`[Illustrations] No mount for scene "${e}", unmounting`),en();return}const{hostId:t,factory:n}=Je[e];console.log(`[Illustrations] Rendering ${e} in section #${t}`);const i=document.getElementById(t);if(!i){console.error(`[Illustrations] Could not find section #${t}`);return}let r=i.querySelector(".scene-illustration");r||(console.log(`[Illustrations] Container missing, recreating in section #${t}`),r=document.createElement("div"),r.className="scene-illustration",r.setAttribute("aria-hidden","true"),r.style.cssText="position:absolute;inset:0;pointer-events:none;z-index:0;overflow:visible;",i.style.position=i.style.position||"relative",i.prepend(r)),at.node&&(console.log("[Illustrations] Unmounting previous illustration"),en()),console.log(`[Illustrations] Creating SVG for ${e}...`),at={scene:e,node:n()},r.appendChild(at.node),console.log("[Illustrations] SVG appended to container"),xa(e,at.node)}function en(){var e;(e=at.node)!=null&&e.parentNode&&at.node.parentNode.removeChild(at.node),at={scene:null,node:null}}function xa(e,t){const n=window.matchMedia("(prefers-reduced-motion: reduce)").matches;if(e==="forest"){const i=document.createElementNS(gt,"rect");i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width","1440"),i.setAttribute("height","300"),i.setAttribute("fill","transparent"),i.style.pointerEvents="auto",i.style.cursor="pointer",t.appendChild(i),i.addEventListener("click",r=>{const s=t.getBoundingClientRect(),o=(r.clientX-s.left)/s.width*1440,a=(r.clientY-s.top)/s.height*400;if(a>300)return;const c=document.createElementNS(gt,"path");c.setAttribute("d",`M${o},${a} q-5,-10 0,-15 q5,5 0,15 z`),c.setAttribute("fill","#2a8a5f"),c.style.opacity="0.8",c.style.transformOrigin="50% 50%",n?c.style.animation="leafFadeOnly 1.5s ease-out forwards":c.style.animation="leafFall 2s ease-out forwards",t.appendChild(c),setTimeout(()=>c.remove(),2e3)})}if(e==="city"){const i=document.createElementNS(gt,"rect");i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("width","1440"),i.setAttribute("height","360"),i.setAttribute("fill","transparent"),i.style.pointerEvents="auto",t.appendChild(i);const r=t.querySelectorAll(".bldg");i.addEventListener("mouseenter",()=>{Array.from(r).sort(()=>Math.random()-.5).slice(0,2).forEach(o=>{const a=parseFloat(o.getAttribute("x"))+20,c=parseFloat(o.getAttribute("y"))-5,l=document.createElementNS(gt,"circle");l.setAttribute("cx",String(a)),l.setAttribute("cy",String(c)),l.setAttribute("r","8"),l.setAttribute("fill","rgba(255, 230, 150, 0.6)"),l.setAttribute("class","city-beacon"),l.style.animation="beaconPulse 600ms ease-in-out forwards",t.appendChild(l),setTimeout(()=>l.remove(),600)})})}if(e==="lab"){const i=document.createElementNS(gt,"rect");i.setAttribute("x","650"),i.setAttribute("y","50"),i.setAttribute("width","140"),i.setAttribute("height","250"),i.setAttribute("fill","transparent"),i.style.pointerEvents="auto",i.style.cursor="pointer",t.appendChild(i);const r=t.querySelector(".lab-liquid");i.addEventListener("click",()=>{if(n){if(r){r.style.transition="fill 300ms ease";const s=r.getAttribute("fill");r.setAttribute("fill","rgba(100, 255, 240, 0.6)"),setTimeout(()=>{r.setAttribute("fill",s||"rgba(0,255,224,.25)")},300)}}else for(let s=0;s<3;s++){const o=document.createElementNS(gt,"circle");o.setAttribute("cx",String(690+Math.random()*60)),o.setAttribute("cy",String(250)),o.setAttribute("r",String(5+Math.random()*4)),o.setAttribute("fill","rgba(160, 210, 255, 0.9)"),o.style.animation="rise 1s ease-in forwards",o.style.animationDelay=`${s*.15}s`,t.appendChild(o),setTimeout(()=>o.remove(),1e3+s*150)}})}}const nn={"#section-landing":"cosmos","#section-ignite":"dawn","#section-surge":"orbit","#section-spillover":"city","#section-fade":"forest","#section-takeaway":"air","#section-ingredients":"lab"},Sa=["cosmos","dawn","orbit","city","forest","air","lab"];function Ea(e,t=150){let n;return(...i)=>{clearTimeout(n),n=setTimeout(()=>e(...i),t)}}function _a(){if(document.documentElement.dataset.env==="prod")return;const t=document.createElement("div");t.id="scene-chip",t.style.cssText=`
    position: fixed;
    bottom: 8px;
    left: 8px;
    padding: 4px 8px;
    background: rgba(0, 0, 0, 0.7);
    color: #00FFE0;
    font-family: 'JetBrains Mono', monospace;
    font-size: 11px;
    border-radius: 4px;
    opacity: 0.5;
    z-index: 10000;
    pointer-events: none;
    user-select: none;
  `,t.textContent="scene: none",document.body.appendChild(t),new MutationObserver(()=>{const i=document.body.dataset.scene||"none";t.textContent=`scene: ${i}`}).observe(document.body,{attributes:!0,attributeFilter:["data-scene"]})}function ka(){document.documentElement.dataset.env!=="prod"&&document.addEventListener("keydown",t=>{const n=parseInt(t.key);if(n>=1&&n<=7){const i=Sa[n-1];document.body.dataset.scene=i,console.log(`[QA] Force scene: ${i}`)}})}function Ca(){Object.entries({"section-landing":"scene--stars","section-surge":"scene--orbits","section-spillover":"scene--grid","section-fade":"scene--canopy","section-takeaway":"scene--bubbles"}).forEach(([t,n])=>{const i=document.getElementById(t);if(i&&!i.querySelector(`.scene-layer.${n}`)){const r=document.createElement("div");r.className=`scene-layer ${n}`,r.setAttribute("aria-hidden","true"),i.appendChild(r),console.log(`[SceneLayer] Injected ${n} into #${t}`)}})}class Ma{constructor(){this.vizControllers={},this.currentSection=null,this.motion=new Hn,this.liveRegion=document.querySelector('[role="status"]'),this.audioMuted=!0,this.sectionMeta={"section-landing":{bg:"bg-cosmos",name:"Landing"},"section-ignite":{bg:"bg-dawn",name:"Ignite"},"section-surge":{bg:"bg-cosmos-deep",name:"Surge"},"section-spillover":{bg:"bg-city",name:"Spillover"},"section-fade":{bg:"bg-forest",name:"Fade/Revival"},"section-takeaway":{bg:"bg-neutral",name:"The Formula"},"section-ingredients":{bg:"bg-lab",name:"Recipe Builder"},"section-conveyor":{bg:"bg-lab",name:"Conveyor Belt"}},this._stopwatchResize=null,this.init()}async init(){await this.initVisualizations(),this.installSceneObserver(),this.setupScrollObserver(),this.setupNavigation(),this.setupProgressBar(),this.setupKeyboardNav(),this.setupReducedMotion(),this.setupAudioControls(),this.initStarfield(),ga(),this.announce("TikTok Tides loaded and ready")}installSceneObserver(){const t=new IntersectionObserver(n=>{const i=n.filter(r=>r.isIntersecting&&r.intersectionRatio>.5).sort((r,s)=>s.intersectionRatio-r.intersectionRatio);if(i.length>0){const r=i[0],s="#"+r.target.id,o=nn[s];o&&document.body.dataset.scene!==o&&(document.body.dataset.scene=o,console.log("Scene changed to:",o,"(ratio:",r.intersectionRatio.toFixed(2),")"))}},{root:null,rootMargin:"0px",threshold:.5});Object.keys(nn).forEach(n=>{const i=document.querySelector(n);i&&t.observe(i)})}async initVisualizations(){var t;this.vizControllers.stopwatch=new On,this.vizControllers.planets=new Gn,this.vizControllers.community=new Bn,this.vizControllers.ranking=new Vn,this.vizControllers.emotion=new Wn,this.vizControllers.ingredients=new Zn,this.vizControllers.recordPlayer=new ua,this.vizControllers.conveyor=new da;for(const[n,i]of Object.entries(this.vizControllers))try{const r=n==="stopwatch"?"#chart":n==="recordPlayer"?".record-player-section":`#viz-${n==="planets"?"planets":n}`;if(await i.init(r,{reducedMotion:this.prefersReducedMotion(),animationSpeed:1,colorScheme:"default"}),n==="stopwatch"){i.mount(),i.mounted=!0,this._stopwatchResize=Ea(()=>{const o=document.getElementById("chart");if(!o)return;const{width:a,height:c}=o.getBoundingClientRect(),l=Math.max(320,Math.min(a,c||a));i.resize(l,l)},150),window.addEventListener("resize",this._stopwatchResize),this._stopwatchResize();const s=document.getElementById("section-ignite");s&&"IntersectionObserver"in window&&new IntersectionObserver(a=>{a.forEach(c=>{c.isIntersecting&&c.intersectionRatio>.5&&(i.update(1),setTimeout(()=>i.update(2),1600))})},{threshold:.5}).observe(s)}n==="recordPlayer"&&((t=i.mount)==null||t.call(i),i.mounted=!0),this.setupVizEvents(n,i)}catch(r){console.warn(`Failed to init ${n}:`,r)}}setupVizEvents(t,n){t==="community"&&n.on("onHoverAudio",i=>{this.audioMuted||this.previewAudio(i.soundId,2e3)}),t==="ranking"&&n.on("onLeafReveal",i=>{this.showDetailPanel(i)}),t==="emotion"&&n.on("bubbleClick",i=>{this.openEmotionDrawer(i)}),t==="ingredients"&&n.on("quizOpened",i=>{this.announce(`Testing ${i.ingredient} impact`)})}setupScrollObserver(){const t={root:null,rootMargin:"0px",threshold:[0,.25,.5,.75,1]};this.observer=new IntersectionObserver(n=>{n.forEach(i=>{if(i.isIntersecting&&i.intersectionRatio>.5&&this.handleSectionEnter(i.target),i.target.classList.contains("scroll-step")&&i.isIntersecting){const r=parseInt(i.target.dataset.step);this.handleStepUpdate(r,i.target)}})},t),document.querySelectorAll(".section").forEach(n=>{this.observer.observe(n)}),document.querySelectorAll(".scroll-step").forEach(n=>{this.observer.observe(n)})}handleSectionEnter(t){var a;const n=t.id;if(this.currentSection===n)return;const i=this.currentSection;this.currentSection=n,this.updateNavigation(n),this.updateBackground(n),this.transitionSections(i,n);const r=t.querySelector(".viz-container");if(r){const c=r.dataset.viz,l=this.vizControllers[c];l&&!l.mounted&&(l.mount(),l.mounted=!0)}if(n==="section-ignite"){const c=this.vizControllers.stopwatch;c&&!c.mounted&&(c.mount(),c.mounted=!0),c==null||c.update(1),setTimeout(()=>c==null?void 0:c.update(2),1600),(a=this._stopwatchResize)==null||a.call(this)}const s=this.sectionMeta[n],o=document.body.dataset.scene;if(s){const c=o?` - ${o} scene`:"";this.announce(`${s.name} section entered${c}`),console.log(`[Section] Entered: ${s.name}${c}`)}this.animateKPIs(t)}updateBackground(t){const n=this.sectionMeta[t];n&&(Object.values(this.sectionMeta).forEach(i=>{document.body.classList.remove(i.bg)}),document.body.classList.add(n.bg),document.body.style.transition="background 600ms cubic-bezier(0.4, 0.0, 0.2, 1)")}handleStepUpdate(t,n){const i=n.closest(".section"),r=i==null?void 0:i.querySelector(".viz-container");if(r){const o=r.dataset.viz,a=this.vizControllers[o];a&&a.update(t,{transition:{duration:400,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}})}else if((i==null?void 0:i.id)==="section-ignite"){const o=this.vizControllers.stopwatch;o==null||o.update(t,{transition:{duration:400,easing:"cubic-bezier(0.4, 0.0, 0.2, 1)"}})}const s=i==null?void 0:i.querySelector(".annotation");s&&this.updateAnnotation(s,t)}transitionSections(t,n){var i,r;if(t&&n){const s=t.replace("section-",""),o=n.replace("section-",""),a=this.vizControllers[s],c=this.vizControllers[o];(i=a==null?void 0:a.onTransitionOut)==null||i.call(a),(r=c==null?void 0:c.onTransitionIn)==null||r.call(c)}}updateAnnotation(t,n){const i={1:"Optimal duration: 15-30 seconds",2:"First hour engagement crucial",3:"Top artists dominate the soundscape",4:"2022 saw the most diverse trends",5:"BookTok drives publishing industry",6:"Sound trends last 6-12 weeks",7:"Engagement varies by community",8:"30% of trends see revival",9:"Positive emotions drive shares",10:"Anger surprisingly viral",11:"Key ingredients identified",12:"Your recipe ready to test"};i[n]&&(t.textContent=i[n])}updateNavigation(t){document.querySelectorAll(".nav-links a").forEach(n=>{const i=n.getAttribute("href").substring(1),r=i==="section-ignite"?"section-ignite":i==="section-surge"?"section-surge":i==="section-spillover"?"section-spillover":i==="section-fade"?"section-fade":i==="section-takeaway"?"section-takeaway":i==="section-ingredients"?"section-ingredients":i==="section-conveyor"?"section-conveyor":i;n.setAttribute("aria-current",r===t?"true":"false")})}setupNavigation(){document.querySelectorAll(".nav-links a").forEach(t=>{t.addEventListener("click",n=>{n.preventDefault();const i=document.querySelector(t.getAttribute("href"));i&&i.scrollIntoView({behavior:this.prefersReducedMotion()?"auto":"smooth",block:"start"})})})}setupProgressBar(){const t=document.querySelector(".progress-bar"),n=()=>{const r=window.innerHeight,s=document.documentElement.scrollHeight-r,a=window.scrollY/s*100;t.style.width=`${a}%`};let i=!1;window.addEventListener("scroll",()=>{i||(requestAnimationFrame(()=>{n(),i=!1}),i=!0)})}setupKeyboardNav(){document.addEventListener("keydown",t=>{if(t.key>="1"&&t.key<="7"){const i=["section-ignite","section-surge","section-spillover","section-fade","section-takeaway","section-ingredients","section-conveyor"][parseInt(t.key)-1],r=document.getElementById(i);r&&r.scrollIntoView({behavior:"smooth",block:"start"})}t.key==="Escape"&&this.closeAllOverlays(),t.key==="?"&&this.showKeyboardHelp()})}setupReducedMotion(){const t=window.matchMedia("(prefers-reduced-motion: reduce)");t.matches&&document.body.classList.add("reduced-motion"),t.addEventListener("change",n=>{n.matches?document.body.classList.add("reduced-motion"):document.body.classList.remove("reduced-motion"),Object.values(this.vizControllers).forEach(i=>{var r;(r=i.setState)==null||r.call(i,{reducedMotion:n.matches})})})}setupAudioControls(){const t=document.querySelector(".audio-mute-toggle");t&&t.addEventListener("click",()=>{this.audioMuted=!this.audioMuted;const n=t.querySelector(".mute-icon"),i=t.querySelector(".unmute-icon");this.audioMuted?(n.style.display="inline",i.style.display="none"):(n.style.display="none",i.style.display="inline"),this.announce(this.audioMuted?"Audio muted":"Audio unmuted")}),document.querySelectorAll(".audio-item").forEach(n=>{n.addEventListener("mouseenter",()=>{if(!this.audioMuted){const i=n.dataset.sound;this.previewAudio(i,2e3)}})})}previewAudio(t,n){console.log(`Playing 2s preview of ${t}`);const i=document.querySelector(`[data-sound="${t}"]`);i&&(i.classList.add("playing"),setTimeout(()=>{i.classList.remove("playing")},n))}setupPlayerIntro(){const t=document.querySelector("[data-player-start]");if(!t)return;const n=document.querySelector(".record-player-wrapper"),i=()=>{n==null||n.removeAttribute("data-player-locked"),t.style.display="none"};t.addEventListener("click",i)}showDetailPanel(t){const n=document.querySelector(".detail-panel");if(n){const i=n.querySelector(".detail-content");i.innerHTML=`
        <h5>${t.community}</h5>
        <ul>${t.topics.map(r=>`<li>${r}</li>`).join("")}</ul>
      `,n.setAttribute("aria-hidden","false"),this.prefersReducedMotion()||(n.style.transition="all 400ms cubic-bezier(0.4, 0.0, 0.2, 1)",n.style.transform="translateX(0)",n.style.opacity="1")}}openEmotionDrawer(t){const n=document.querySelector(".detail-drawer");if(n){const i=n.querySelector(".sparkline-container"),r=n.querySelector(".example-phrases");i.innerHTML='<canvas width="200" height="50"></canvas>',r.innerHTML=`<p>Example: "${t.word}" in context</p>`,n.setAttribute("aria-hidden","false"),n.querySelector(".drawer-close").focus()}}animateKPIs(t){t.querySelectorAll(".kpi-value").forEach((i,r)=>{const s=parseFloat(i.dataset.target);if(isNaN(s))return;const o=1e3,a=r*100;setTimeout(()=>{this.animateNumber(i,0,s,o)},a)})}animateNumber(t,n,i,r){const s=Date.now(),o=i%1!==0,a=()=>{const c=Date.now()-s,l=Math.min(c/r,1),u=this.easeOutCubic(l),d=n+(i-n)*u;t.textContent=o?d.toFixed(1):Math.round(d),l<1&&requestAnimationFrame(a)};a()}easeOutCubic(t){return 1-Math.pow(1-t,3)}initStarfield(){const t=document.querySelector(".starfield");if(!t)return;const n=100;for(let i=0;i<n;i++){const r=document.createElement("div");r.className="star",r.style.left=`${Math.random()*100}%`,r.style.top=`${Math.random()*100}%`,r.style.animationDelay=`${Math.random()*5}s`;const s=Math.random()*3+1;r.style.width=`${s}px`,r.style.height=`${s}px`,t.appendChild(r)}}closeAllOverlays(){const t=document.querySelector(".detail-drawer");t&&t.setAttribute("aria-hidden","true");const n=document.querySelector(".quiz-modal");n&&(n.classList.remove("active"),n.setAttribute("aria-hidden","true"));const i=document.querySelector(".detail-panel");i&&i.setAttribute("aria-hidden","true")}showKeyboardHelp(){console.log("Keyboard shortcuts:"),console.log("1-7: Jump to sections"),console.log("Esc: Close overlays"),console.log("?: Show this help"),console.log("Tab: Navigate interactive elements"),console.log("Enter: Activate buttons/links")}announce(t){this.liveRegion&&(this.liveRegion.textContent=t)}prefersReducedMotion(){return window.matchMedia("(prefers-reduced-motion: reduce)").matches}}document.addEventListener("DOMContentLoaded",()=>{_a(),ka(),Ca(),wa(),window.app=new Ma,window.app.setupPlayerIntro()});
